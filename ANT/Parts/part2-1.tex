\chapter{Algebraic Integers}
  Elementary number theory is done over $\Q$. The associated set of integers $\Z$ is a ring inside $\Q$. Moreover, the fundamental theorem of arithmetic tells us that prime factorization exists in $\Z$. That is, every integer is uniquely a product of primes (up to reordering of the factors). The study of number fields is concerned with finite extensions of $\Q$ where there might no longer be prime factorization. In the following, we introduce the primary tools in algebraic number theory. Namely, integrality, traces and norms, Dedekind domains, ramification, localization, and the discriminant and different.
  \section{Integrality}
    Let $A$ and $B$ be rings with $A \subseteq B$. We say that $b \in B$ is \textbf{integral}\index{integral} over $A$ if $\b$ is the root of a monic polynomial $f(x) \in A[x]$. In other words, $\b$ satisfies
    \[
      \b^{n}+\a_{n-1}\b^{n-1}+\cdots+\a_{0} = 0,
    \]
    for some $n \ge 1$ and $\a_{i} \in A$ for $0 \le i \le n-1$. We say that $B$ is \textbf{integral}\index{integral} over $A$ if every element of $B$ is integral over $A$. The following proposition shows that integral elements form a ring:

    \begin{proposition}\label{prop:integral_if_finitely_generated}
      Let $A$ and $B$ be rings with $A \subseteq B$. Then the finitely many elements $\b_{1},\ldots,\b_{n} \in B$ are all integral over $A$ if and only if $A[\b_{1},\ldots,\b_{n}]$ is a finitely generated $A$-module. In particular, the elements of $B$ that are integral over $A$ form a ring.
    \end{proposition}
    \begin{proof}
      First suppose $\b \in B$ is integral over $A$. Then there exists a monic polynomial $f(x) \in A[x]$, of say degree $n \ge 1$, such that $f(\b) = 0$. Now for any $g(x) \in A[x]$, Euclidean division implies
      \[
        g(x) = q(x)f(x)+r(x),
      \]
      with $q(x),r(x) \in A[x]$ and $\deg(r(x)) < n$. Letting
      \[
        r(x) = \a_{n-1}x^{n-1}+\cdots+\a_{1}x+a_{0},
      \]
      with $\a_{i} \in \Z$ for $0 \le i \le n-1$, it follows that
      \[
        g(\b) = r(\b) = \a_{n-1}\b^{n-1}+\cdots+\a_{1}\b+\a_{0}.
      \]
      As $g(x)$ was arbitrary, we see that $1,\b,\ldots,\b^{n-1}$ generates $A[\b]$ as a $A$-module. Now suppose $\b_{1},\ldots,\b_{n} \in B$ are all integral over $A$. We will prove that $A[\b_{1},\ldots,\b_{n}]$ is finitely generated as an $A$-module by induction. Our previous work implies the base case. So assume by induction that $R = A[\b_{1},\ldots,\b_{n-1}]$ is a finitely generated $A$-module. Then $R[\b_{n}] = A[\b_{1},\ldots,\b_{n}]$ is a finitely generated $R$-module and hence a finitely generated $\Z$-module as well by our induction hypothesis. This proves the forward implication of the first statement. For the reverse implication, suppose $A[\b_{1},\ldots,\b_{n}]$ is a finitely generated $A$-module. Let $\w_{1},\ldots,\w_{r}$ be a basis of $A[\b_{1},\ldots,\b_{n}]$. Then for any $\b \in A[\b_{1},\ldots,\b_{n}]$, we have
      \[
        \b\w_{i} = \sum_{1 \le j \le r}\a_{i,j}\w_{j},
      \]
      with $\a_{i,j} \in A$ for $1 \le i,j \le r$. We can rewrite this as
      \[
        (\b-\a_{i,i})\w_{i}-\sum_{\substack{1 \le j \le r \\ j \neq i}}\a_{i,j}\w_{j} = 0,
      \]
      for all $i$. These $r$ equations are equivalent to the identity
      \[
        \begin{pmatrix} \b-\a_{1,1} & \a_{1,2} & \cdots & -\a_{1,r} \\ -\a_{2,1} & \b-\a_{2,2} & & \\ \vdots & & \ddots & \\ -\a_{r,1} & & & \b-\a_{r,r} \end{pmatrix}\begin{pmatrix} \w_{1} \\ \w_{2} \\ \vdots \\ \w_{r} \end{pmatrix} = \mathbf{0}.
      \]
      Thus the determinant of the matrix on the left-hand side must be zero. This shows that $\b$ is the root of the characteristic polynomial $\det(xI-(\a_{i,j})_{i,j})$ which is a monic polynomial with coefficients in $A$. Hence $\b$ is integral over $A$. As $\b$ was arbitrary, this shows that the elements $\b_{1},\ldots,\b_{n}$ are all integral over $A$ and that the sum and product of elements that are integral over $A$ are also integral over $A$. This proves the reverse implication and the second statement completing the proof.
    \end{proof}

    Integrality is also transitive via the following statement:

    \begin{proposition}\label{prop:integrality_is_transitive}
      Suppose $A$, $B$, and $C$ are rings with $A \subseteq B \subseteq C$. If $C$ is integral over $B$ and $B$ is integral over $A$, then $C$ is integral over $A$.
    \end{proposition}
    \begin{proof}
      Let $\g \in C$. Since $C$ is integral over $B$, we have
      \[
        \g^{n}+\b_{n-1}\g^{n-1}+\cdots+\b_{0} = 0,
      \]
      for some $n \ge 1$ and $\b_{i} \in B$ for $0 \le i \le n-1$. Set $R = A[\b_{0},\ldots,\b_{n-1}]$. Then $R[\g]$ is a finitely generated $R$-module and since $B$ is integral over $A$, \cref{prop:integral_if_finitely_generated} implies that $R[\g]$ is also a finitely generated $A$-module. Thus $\g$ is integral over $A$ by \cref{prop:integral_if_finitely_generated} again. As $\g$ was arbitrary, $C$ is integral over $A$.
    \end{proof}

    In light of \cref{prop:integrality_is_transitive}, we define the \textbf{integral closure}\index{integral closure} $\overline{A}$ of $A$ in $B$ by
    \[
      \overline{A} = \{\b \in B:\textbf{$\b$ is integral over $A$}\}.
    \]
    Clearly $A \subseteq \overline{A}$. Moreover, we say that $A$ is \textbf{integrally closed}\index{integrally closed} in $B$ if $A = \overline{A}$. As $A \subseteq \overline{A} \subseteq \overline{\overline{A}}$, \cref{prop:integrality_is_transitive} implies that $\overline{A}$ is automatically integrally closed in $B$. Now suppose $A$ is an integral domain with field of fractions $K$. Then we call the integral closure $\overline{A}$ of $A$ in $K$ the \textbf{normalization}\index{normalization} of $A$ and simply say that $A$ is \textbf{integrally closed}\index{integrally closed} if $A$ is equal to its normalization. It turns out that every unique factorization domain is integrally closed:

    \begin{lemma}\label{lemma:unique_factorization_domains_are_integrally_closed}
      Let $A$ be a unique factorization domain with field of fractions $K$. Then $A$ is integrally closed. In particular, every principal ideal domain is integrally closed.
    \end{lemma}
    \begin{proof}
      Since every principal ideal domain is a unique factorization domain, the second statement follows immediately from the first. To prove the first statement, let $\k \in K$ be such that
      \[
        \k^{n}+\a_{n-1}\k^{n-1}+\cdots+\a_{0} = 0,
      \]
      for some $n \ge 1$ and $\a_{i} \in A$ for $0 \le i \le n-1$. Since $A$ is a unique factorization domain, we may write $\k = \frac{\a}{\b}$ for $\a,\b \in A$ with $\b$ nonzero and $(\a,\b) = 1$. Multiplying by $\b^{n}$ and isolating the leading term shows that
      \[
        \a^{n} = -(\a_{n-1}\b\a^{n-1}+\cdots+\a_{0}\b^{n}).
      \] 
      As $\b$ divides the right-hand side it divides the left-hand side as well. But then $\b \mid \a$ and hence $\b$ is a unit in $A$ because $(\a,\b) = 1$. This means $\k \in A$ and so $A$ is integrally closed.
    \end{proof}
    
    Despite \cref{lemma:unique_factorization_domains_are_integrally_closed}, we will often consider the following more general setting: $A$ is an integrally closed integral domain with field of fractions $K$, $L/K$ is a finite separable extension, and $B$ is the integral closure of $A$ in $L$. In this setting, the field of fractions of $B$ has a simple description:

    \begin{proposition}\label{prop:field_of_fractions_AKBL}
      Let $A$ be an integrally closed integral domain with field of fractions $K$, $L/K$ be a finite separable extension, and $B$ be the integral closure of $A$ in $L$. Then every $\l \in L$ is of the form
      \[
        \l = \frac{\b}{\a},
      \]
      for some $\b \in B$ and nonzero $\a \in A$. In particular, $L$ is the field of fractions of $B$. Moreover, $\l \in L$ is integral over $A$ if and only if the minimal polynomial $m_{\l}(x)$ of $\l$ has coefficients in $A$.
    \end{proposition}
    \begin{proof}
      As $L/K$ is finite, it is necessarily algebraic so that any $\l \in L$ satisfies
      \[
        \a\l^{n}+\a_{n-1}\l^{n-1}+\cdots+\a_{0} = 0,
      \]
      with $\a_{i} \in A$ for $0 \le i \le n-1$ and nonzero $\a \in A$. We claim that $\a\l$ is integral over $A$. Indeed, multiplying the previous identity by $\a^{n-1}$ yields
      \[
        (\a\l)^{n}+\a'_{n-1}(\a\l)^{n-1}+\cdots+\a'_{0} = 0,
      \]
      where $\a'_{i} = \a_{i}\a^{n-1-i}$ for $0 \le i \le n-1$, and so $\a\l$ is the root of a monic polynomial with coefficients in $A$. Then $\a\l \in B$ and so $\a\l = \b$ for some $\b \in B$ which is equivalent to $\l = \frac{\b}{\a}$. As $A \subseteq B$, this also implies that $L$ is the field of fractions of $B$. For the last statement, suppose $\l \in L$. If the minimal polynomial $m_{\l}(x)$ of $\l$ has coefficients in $A$ then $\l$ is automatically integral over $A$ (since the minimal polynomial is monic). So suppose $\l$ is an integral over $A$ so that $\l$ is a root of a monic polynomial $f(x) \in A[x]$. Then $m_{\l}(x)$ divides $f(x)$ and thus all of the roots of $m_{\l}(x)$ are integral over $A$ too. By Vieta's formulas, the coefficients of $m_{\k}(x)$ integral over $A$ as well. But then $m_{\k}(x) \in A[x]$. This completes the proof.
    \end{proof}

    We are now ready to introduce number fields. A \textbf{number field}\index{number field} $K$ is a finite extension of $\Q$. That is, $K$ is a finite dimensional vector space over $\Q$. In particular, $K/\Q$ is a finite separable extension (since $\Q$ is perfect) so that the primitive element theorem applies and is Galois if and only if $K/\Q$ is normal. We say that the \textbf{degree}\index{degree} of $K$ is $[K:\Q]$ which is simply the degree of $K$ as a vector space over $\Q$. If $K$ is of degree $2$, $3$, etc. then we say it is \textbf{quadratic}\index{quadratic}, \textbf{cubic}\index{cubic}, etc. Any $\k \in K$ is called an \textbf{algebraic number}\index{algebraic number}. We define the \textbf{ring of integers}\index{ring of integers} $\mc{O}_{K}$ of $K$ to be the integral closure of $\Z$ in $K$. In other words,
    \[
      \mc{O}_{K} = \{\k \in K:\text{$\k$ is integral over $\Z$}\}.
    \]
    Any $\a \in \mc{O}_{K}$ is called an \textbf{algebraic integer}\index{algebraic integer}. Then $\a$ is an algebraic integer if and only if it is the root of a monic polynomial $f(x) \in \Z[x]$.

    \begin{remark}\label{rem:integers_are_integrally_closed}
      By \cref{lemma:unique_factorization_domains_are_integrally_closed}, $\Z$ is integrally closed and therefore the ring of integers for the number field $\Q$ is exactly $\Z$.
    \end{remark}

    Let $K$ be a number field of degree $n$. It follows from \cref{prop:field_of_fractions_AKBL} that $K$ is the field of fractions of $\mc{O}_{K}$ and every $\k \in K$ is of the form
    \[
      \k = \frac{\a}{a},
    \]
    for some $\a \in \mc{O}_{K}$ and nonzero $a \in \Z$. Moreover, $\k \in K$ is an algebraic integers if and only if the minimal polynomial $m_{\k}(x)$ of $\k$ has coefficients in $\Z$.
  \section{Traces \& Norms}
    We will now introduce norms and traces of free modules. Let $A$ and $B$ be rings such that $A \subseteq B$ and where $B$ is a free $A$-module of rank $n$. Then the \textbf{trace}\index{trace} and \textbf{norm}\index{norm} of $B$ over $A$, denoted $\Trace_{B/A}$ and $\Norm_{B/A}$ respectively, are defined by
    \[
      \Trace_{B/A}(\b) = \tr(T_{\b}) \quad \text{and} \quad \Norm_{B/A}(\b) = \det(T_{\b}),
    \]
    for any $\b \in B$, where $T_{\b}:B \to B$ is the linear operator defined by
    \[
      T_{\b}(x) = \b x,
    \]
    for all $x \in B$. That is, $T_{\b}$ is the multiplication by $\b$ map. Letting $f_{\b}(x)$ denote the characteristic polynomial of $T_{\b}$, we have
    \[
      f_{\b}(x) = \det(xI-T_{\b}) = x^{n}-\a_{n-1}x^{n-1}+\cdots+(-1)^{n}\det(T_{\b}),
    \]
    with $\a_{i} \in A$ for $0 \le i \le n-1$. Then the trace and the norm are given by
    \begin{equation}\label{equ:trace_and_norm_characteristic_polynomial}
      \Trace_{B/A}(\b) = \a_{n-1} \quad \text{and} \quad \Norm_{B/A}(\b) = \det(T_{\b}),
    \end{equation}
    and therefore take values in $A$. Moreover, we have
    \[
      \Trace_{B/A}(\a\b) = \a\Trace_{B/A}(\b) \quad \text{and} \quad \Norm_{B/A}(\a\b) = \a^{n}\Norm_{B/A}(\b),
    \]
    for all $\a \in A$ because $T_{\a\l} = \a T_{\l}$. Also note that $T_{\b+\g} = T_{\b}+T_{\g}$ and $T_{\b\g} = T_{\b}T_{\g}$ for all $\b,\g \in B$. In the case of a degree $n$ extension $L/K$, we call $\Trace_{L/K}$ and $\Norm_{L/K}$ the \textbf{trace}\index{trace} and \textbf{norm}\index{norm} of $L/K$. Moreover, $\Norm_{L/K}(\l) = 0$ if and only if $\l = 0$ because otherwise $T_{\l}$ has inverse $T_{\l^{-1}}$ and hence nonzero determinant. Therefore we obtain homomorphisms
    \[
      \Trace_{L/K}:L \to K \quad \text{and} \quad \Norm_{L/K}:L^{\ast} \to K^{\ast}.
    \]
    When $L/K$ is also separable, we can derive alternative descriptions of the trace and norm of $L/K$. This additional assumption is weak because we are mostly interested in finite extensions of $\Q$ and $\F_{p}$ which are always separable (because both $\Q$ and $\F_{p}$ are perfect). In any case, to do this we need to work in the algebraic closure $\conj{K}$ of $K$. As $L/K$ is a degree $n$ separable extension, there are exactly $n$ distinct $K$-embeddings $\s_{1},\ldots,\s_{n}$ of $L$ into $\conj{K}$ (each given by letting $\t$ be a primitive element for $L$ so that $L = K[\t]$ and sending $\t$ to one of its conjugate roots in the minimal polynomial $m_{\t}(x)$ of $\t$). Moreover, we prove the following proposition:

    \begin{proposition}\label{prop:formulas_for_trace_and_norm}
      Let $L/K$ be a degree $n$ separable extension and let $\s$ run over all $K$-embeddings $\s$ of $L$ into $\conj{K}$. For any $\l \in L$, the characteristic polynomial $f_{\l}(x)$ of $T_{\l}$ is a power of the minimal polynomial $m_{\l}(x)$ of $\l$ and satisfies
      \[
        f_{\l}(x) = \prod_{\s}(x-\s(\l)).
      \]
      In particular,
      \[
        \Trace_{L/K}(\l) = \sum_{\s}\s(\l) \quad \text{and} \quad \Norm_{L/K}(\l) = \prod_{\s}\s(\l).
      \]
    \end{proposition}
    \begin{proof}
      Let
      \[
        m_{\l}(x) = x^{m}+\k_{m-1}x^{m-1}+\cdots+\k_{0},
      \]
      with $\k_{i} \in K$ for $0 \le i \le n-1$, be the minimal polynomial of $\l$ (necessarily $m$ is the degree of $K(\l)/K$). Let $d$ be the degree of $L/K(\l)$. We first show that $f_{\l}(x)$ is a power of $m_{\l}(x)$, and more precisely that
      \[
        f_{\l}(x) = m_{\l}(x)^{d}.
      \]
      To see this, recall that $1,\l,\ldots,\l^{n-1}$ is a basis of $K(\l)/K$. If $\a_{1},\ldots,\a_{d}$ is a basis for $L/K(\l)$, then
      \[
        \a_{1},\a_{1}\l,\ldots,\a_{1}\l^{m-1},\ldots,\a_{d},\a_{d}\l,\ldots,\a_{d}\l^{m-1},
      \]
      is a basis for $L/K$. Because the minimal polynomial $m_{\l}(x)$ gives the linear relation
      \[
        \l^{m} = -\k_{0}-k_{1}\l-\cdots-\k_{m-1}\l^{m-1},
      \]
      the matrix of $T_{\l}$ is block diagonal with $d$ blocks each of the form
      \[
        \begin{pmatrix} & 1 & & \\ & & \ddots & \\ & & & 1 \\ -\k_{0} & -\k_{1} & \cdots & -\k_{m-1} \\ \end{pmatrix}.
      \]
      This is the companion matrix to $m_{\l}(x)$ and hence the characteristic polynomial is $m_{\l}(x)$ as well. Our claim follows since the matrix of $T_{\l}$ is block diagonal. Since $\l$ is algebraic over $K$ of degree $m$, $K(\l)$ is the splitting field of $m_{\l}(x)$ and there are $m$ distinct $K$-embeddings of $K(\l)$ into $\conj{K}$. Let $\tau$ be such a $K$-embedding. Then the $K$-embeddings $\s$ are partitioned into $m$ many equivalence classes each of size $d$ (because $L/K(\l)$ is degree $d$) where $\s$ and $\s'$ are in the same class if and only if $\s(\l) = \s'(\l)$. In particular, a complete set of representatives is given by the $\tau$. But then
      \[
        f_{\l}(x) = m_{\l}(x)^{d} = \left(\prod_{\tau}(x-\tau(\l))\right)^{d} = \prod_{\s}(x-\s(\l)),
      \]
      which proves the first statement. The formulas for the trace and norm follow from Vieta's formulas and \cref{equ:trace_and_norm_characteristic_polynomial}.
    \end{proof}

    As an application of \cref{prop:formulas_for_trace_and_norm}, we can show how the field trace and field norm act when $A$ is an integrally closed integral domain with field of fractions $K$, $L/K$ is a finite separable extension, and $B$ is the integral closure of $A$ in $L$:

    \begin{proposition}\label{prop:norm_and_trace_AKBL}
      Let $A$ be an integrally closed integral domain with field of fractions $K$, $L/K$ be a finite separable extension, and $B$ be the integral closure of $A$ in $L$. If $\l \in L$ is integral over $A$, then $\Trace_{L/K}(\l)$ and $\Norm_{L/K}(\l)$ are in $A$.
    \end{proposition}
    \begin{proof}
      By \cref{prop:field_of_fractions_AKBL}, if $\l \in L$ is integral over $A$ then its minimal polynomial $m_{\l}(x)$ has coefficients in $A$. By \cref{prop:formulas_for_trace_and_norm}, the characteristic polynomial $f_{\l}(x)$ is a power of $m_{\l}(x)$ and hence $f_{\l}(x)$ has coefficients in $A$ too. From \cref{equ:trace_and_norm_characteristic_polynomial} we conclude that $\Trace_{L/K}(\l)$ and $\Norm_{L/K}(\l)$ are in $A$.
    \end{proof}

    We can also classify the units of $B$ in terms of the units of $A$:

    \begin{proposition}\label{prop:unit_if_and_only_if_AKBL}
      Let $A$ be an integrally closed integral domain with field of fractions $K$, $L/K$ be a finite separable extension, and $B$ be the integral closure of $A$ in $L$. Then $\b \in B$ is a unit if and only if $\Norm_{L/K}(\l) \in A$ is a unit.
    \end{proposition}
    \begin{proof}
      First suppose $\b \in B$ is a unit. Then $\frac{1}{\b} \in B$ and so
      \[
        \Norm_{L/K}(\b)\Norm_{L/K}\left(\frac{1}{\b}\right) = \Norm_{L/K}(1) = 1.
      \]
      By \cref{prop:norm_and_trace_AKBL}, $\Norm_{L/K}(\b),\Norm_{L/K}\left(\frac{1}{\b}\right) \in A$ and hence $\Norm_{L/K}(\b)$ is a unit. Now suppose $\Norm_{L/K}(\b) \in A$ is a unit. By \cref{prop:field_of_fractions_AKBL}, the minimal polynomial $m_{\b}(x)$ of $\b$ has coefficients in $A$. Moreover, \cref{equ:trace_and_norm_characteristic_polynomial,prop:formulas_for_trace_and_norm} together imply that the constant term is a unit because $\Norm_{L/K}(\b)$ is. Letting the degree of $m_{\b}(x)$ be $m$, we have shown that
      \[
        m_{\b}(x) = x^{m}+\a_{m-1}x^{m-1}+\cdots+\a,
      \]
      with $\a_{i} \in A$ for $1 \le i \le m-1$ and $\a \in A$ a unit. Dividing $m_{\b}(\b)$ by $\b^{m}$, we find that $\frac{1}{\b}$ is a root of the polynomial
      \[
        f(x) = \a x^{m}+\a_{1}x^{m-1}+\cdots+1.
      \]
      Multiplying by $\frac{1}{\a}$, it follows that $\frac{1}{\b}$ is a root of a monic polynomial with coefficients in $A$. Hence $\frac{1}{\b} \in B$ and thus $\b$ is a unit.
    \end{proof}

    Having introduced traces and norms, we discuss discriminants of free modules. Let $A$ and $B$ be rings such that $A \subseteq B$ and where $B$ is a free $A$-module of rank $n$. If $\b_{1},\ldots,\b_{n}$ is a basis for $B$, we define its \textbf{discriminant}\index{discriminant} $d_{B/A}(\b_{1},\ldots,\b_{n})$ by
    \[
      d_{B/A}(\b_{1},\ldots,\b_{n}) = \det((\Trace_{B/A}(\b_{i}\b_{j}))_{i,j}).
    \]
    In particular, the discriminant $d_{B/A}(\b_{1},\ldots,\b_{n})$ is an element of $A$. It is also independent of the choice of basis up to elements of $(A^{\ast})^{2}$. For if $\b'_{1},\ldots,\b'_{n}$ is another basis, we have
    \[
      \b'_{i} = \sum_{1 \le j \le m}\a_{i,j}\b_{j},
    \]
    with $\a_{i,j} \in A$ for $1 \le i,j \le n$. Then $(\a_{i,j})_{i,j}$ is the base change matrix from $\b_{1},\ldots,\b_{n}$ to $\b'_{1},\ldots,\b'_{n}$ and so has nonzero determinant. Thus $\det((\a_{i,j})_{i,j}) \in A^{\ast}$. Moreover,
    \[
      (\Trace_{B/A}(\b'_{i}\b'_{j}))_{i,j} = (\a_{i,j})_{i,j}(\Trace_{B/A}(\b_{i}\b_{j}))_{i,j}(\a_{i,j})_{i,j}^{t},
    \]
    which, upon taking the determinant, shows that
    \begin{equation}\label{equ:discriminant_base_change}
      d_{B/A}(\b'_{1},\ldots,\b'_{n}) = \det((\a_{i,j})_{i,j})^{2}d_{B/A}(\b_{1},\ldots,\b_{n}),
    \end{equation}
    as claimed. The discriminant is also multiplicative with respect to direct sums:

    \begin{proposition}\label{prop:discriminant_and_direct_sums}
      Let $A$ and $B$ be rings such that $A \subseteq B$ and where $B$ is a free $A$-module of rank $n$. Suppose we have a direct sum decomposition
      \[
        B = B_{1} \op B_{2},
      \]
      for free $A$-modules $B_{1}$ and $B_{2}$ of ranks $n_{1}$ and $n_{2}$ respectively. Also let $\g_{1},\ldots,\g_{n_{1}}$ and $\d_{1},\ldots,\d_{n_{2}}$ be bases of $B_{1}$ and $B_{2}$ respectively. Then
      \[
        d_{B/A}(\g_{1},\ldots,\g_{n_{1}},\d_{1},\ldots,\d_{n_{2}}) = d_{B_{1}/A}(\g_{1},\ldots,\g_{n_{1}})d_{B_{1}/A}(\d_{1},\ldots,\d_{n_{2}}).
      \]
    \end{proposition}
    \begin{proof}
      As $B$ is the direct sum of $B_{1}$ and $B_{2}$ as $A$-modules, we have $\g_{i}\d_{k} = 0$ for all $1 \le i \le n_{1}$ and $1 \le k \le n_{2}$. It follows that $d_{B/A}(\g_{1},\ldots,\g_{n_{1}},\d_{1},\ldots,\d_{n_{2}})$ is the determinant of the block diagonal matrix
      \[
        \begin{pmatrix} (\Trace_{B/A}(\g_{i}\g_{j}))_{i,j} & \\ & (\Trace_{B/A}(\d_{k}\d_{\ell}))_{k,\ell} \end{pmatrix}.
      \]
      Moreover, we have
      \[
        \Trace_{B/A}(\b_{1}) = \Trace_{B_{1}/A}(\b_{1}) \quad \text{and} \quad \Trace_{B/A}(\b_{2}) = \Trace_{B_{1}/A}(\b_{2})
      \]
      for any $\b_{1} \in B_{1}$ and $\b_{2} \in B_{2}$ since multiplication by $\b_{1}$ and $\b_{2}$ annihilate $B_{2}$ and $B_{1}$ respectively. But then the block diagonal matrix above is equal to
      \[
        \begin{pmatrix} (\Trace_{B_{1}/A}(\g_{i}\g_{j}))_{i,j} & \\ & (\Trace_{B_{1}/A}(\d_{k}\d_{\ell}))_{k,\ell} \end{pmatrix}.
      \]
      The determinant of this matrix is $d_{B/A}(\g_{1},\ldots,\g_{n_{1}})d_{R}(\d_{1},\ldots,\d_{n_{2}})$ which completes the proof.
    \end{proof}
    
    We now specialize to the setting of a degree $n$ separable extension $L/K$. In this case, it turns out that the discriminant of a basis is nonzero. To see this, we require a lemma:

    \begin{lemma}\label{lem:trace_is_nondegenerate}
      Let $L/K$ be a finite separable extension. Then the map
      \[
        \Trace_{L/K}:L \x L \to K \qquad (\l,\eta) \mapsto \Trace_{L/K}(\l\eta),
      \]
      is a nondegenerate symmetric bilinear form.
    \end{lemma}
    \begin{proof}
      From the definition of the trace, it is clear that the map is a symmetric bilinear form. To see that is is nondegenerate, suppose $L/K$ is degree $n$. Then for any nonzero $\l \in L$, \cref{prop:formulas_for_trace_and_norm} implies that
      \[
        \Trace_{L/K}(\l\l^{-1}) = \Trace_{L/K}(1) = n.
      \]
      Hence the symmetric bilinear form is nondegenerate.
    \end{proof}

    We can now show that the discriminant of any basis for $L/K$ never vanishes:

    \begin{proposition}\label{prop:discriminant_not_zero}
      Let $L/K$ be a degree $n$ separable extension and let $\l_{1},\ldots,\l_{n}$ be a basis for $L/K$. Then $d_{L/K}(\l_{1},\ldots,\l_{n}) \neq 0$.
    \end{proposition}
    \begin{proof}
      Suppose by contradiction that $d_{L/K}(\l_{1},\ldots,\l_{n}) = 0$. Then the matrix $(\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}$ is not invertible. Hence there exists a nonzero column vector $(\k_{1},\ldots,\k_{n})^{t}$ with $\k_{i} \in K$ for $1 \le i \le n$ such that
      \[
        (\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}(\k_{1},\ldots,\k_{n})^{t} = \mathbf{0}.
      \]
      This is equivalent to the $n$ equations
      \[
        \sum_{1 \le j \le n}\k_{j}\Trace_{L/K}(\l_{i}\l_{j}) = 0,
      \]
      for all $i$. Setting
      \[
        \l = \sum_{1 \le j \le n}\k_{j}\l_{j},
      \]
      linearity of the trace implies that these $n$ equations are equivalent to the fact that $\Trace_{L/K}(\l\l_{i}) = 0$ for all $i$. As $\l_{1},\ldots,\l_{n}$ is a basis for $L/K$, it follows that $\l \in L$ is a nonzero element for which $\Trace_{L/K}(\l\eta) = 0$ for all $\eta \in L$. This is impossible by \cref{lem:trace_is_nondegenerate}. Hence $d_{L/K}(\l_{1},\ldots,\l_{n}) \neq 0$ as desired.
    \end{proof}

    In addition to the discriminant $d_{L/K}(\l_{1},\ldots,\l_{n})$ never vanishing, we can also write it in an alternative form. To do this, we define the \textbf{embedding matrix}\index{embedding matrix} $M(\l_{1},\ldots,\l_{n})$ of the basis $\l_{1},\ldots,\l_{n}$ by
    \[
      M(\l_{1},\ldots,\l_{n}) = \begin{pmatrix} \s_{1}(\l_{1}) & \cdots & \s_{1}(\l_{n}) \\ \vdots & & \vdots \\ \s_{n}(\l_{1}) & \cdots & \s_{n}(\l_{n}) \end{pmatrix},
    \]
    where $\s_{1},\ldots,\s_{n}$ are the $n$ distinct $K$-embeddings of $L$ into $\conj{K}$. Then we have the following result:

    \begin{proposition}\label{disc_as_square_of_embedding_matrix}
      Let $L/K$ be a degree $n$ separable extension. Then for any basis $\l_{1},\ldots,\l_{n}$ of $L$, we have
      \[
        d_{L/K}(\l_{1},\ldots,\l_{n}) = \det(M(\l_{1},\ldots,\l_{n}))^{2}.
      \]
    \end{proposition}
    \begin{proof}
      Recalling that the $(i,j)$-entry of $M(\l_{1},\ldots,\l_{n})^{t}M(\l_{1},\ldots,\l_{n})$ is the dot product of the $i$-th and $j$-th columns of $M(\l_{1},\ldots,\l_{n})$, we compute
      \begin{align*}
        \det(M(\l_{1},\ldots,\l_{n}))^{2} &= \det(M(\l_{1},\ldots,\l_{n})^{t}M(\l_{1},\ldots,\l_{n})) \\
        &= \det\left(\left(\sum_{\s}\s(\l_{i})\s(\l_{j})\right)_{i,j}\right) \\
        &= \det\left(\left(\sum_{\s}\s(\l_{i}\l_{j})\right)_{i,j}\right) \\
        &= \det((\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}) \\
        &= d_{L/K}(\l_{1},\ldots,\l_{n}),
      \end{align*}
      where the sums run over all $K$-embeddings $\s$ of $L$ into $\conj{K}$ and the second to last equality follows by \cref{prop:formulas_for_trace_and_norm}, as desired.
    \end{proof}

    Discriminants of bases are useful because of the following lemma:

    \begin{lemma}\label{lem:lemma_for_integral_basis_AKBL}
      Let $A$ be an integrally closed integral domain with field of fractions $K$, $L/K$ be a degree $n$ separable extension, and $B$ be the integral closure of $A$ in $L$. If $\l_{1},\ldots,\l_{n}$ is a basis for $L/K$ that is contained in $B$, then
      \[
        d_{L/K}(\l_{1},\ldots,\l_{n})B \subseteq A\l_{1}+\cdots+A\l_{n}.
      \]
    \end{lemma}
    \begin{proof}
      Since $\l_{1},\ldots,\l_{n}$ is a basis, we may write $\b = \k_{1}\l_{1}+\cdots+\k_{n}\l_{n}$ for any $\b \in B$. Linearity of the trace implies
      \[
        \sum_{1 \le j \le n}\k_{j}\Trace_{L/K}(\l_{i}\l_{j}) = \Trace_{L/K}(\l_{i}\b),
      \]
      for $1 \le i \le n$. These $n$ equations are equivalent to the identity
      \[
        (\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}(\k_{1},\ldots,\k_{n})^{t} = (\Trace_{L/K}(\b\l_{1}),\ldots,\Trace_{L/K}(\b\l_{n}))^{t}.
      \]
      Multiplying on the left by the adjugate of $(\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}$ and recalling that a matrix times its adjugate is its determinant times the identity, we see that
      \[
        \k_{i} = \frac{\Trace_{L/K}(\b\l_{i})}{d_{L/K}(\l_{1},\ldots,\l_{n})},
      \]
      for all $i$ since $d_{L/K}(\l_{1},\ldots,\l_{n})$ is nonzero by \cref{prop:discriminant_not_zero}. From \cref{prop:norm_and_trace_AKBL}, $\Trace_{L/K}(\b\l_{i}) \in A$ for all $i$ and therefore $d_{L/K}(\l_{1},\ldots,\l_{n})\k_{i} \in A$ for all $i$. But then
      \[
        d_{L/K}(\l_{1},\ldots,\l_{n})B \subseteq A\l_{1}+\cdots+A\l_{n},
      \]
      as desired.
    \end{proof}

    Again suppose $A$ is an integrally closed integral domain with field of fractions $K$, $L/K$ is a degree $n$ separable extension, and $B$ is the integral closure of $A$ in $L$. We say that $\b_{1},\ldots,\b_{n}$ is an \textbf{integral basis}\index{integral basis} for $B$ over $A$ if $\b_{1},\ldots,\b_{n}$ is such that
    \[
      B = A\b_{1}+\cdots+A\b_{n}.
    \]
    Equivalently, $B$ is a free $A$-module of rank $n$. An integral basis is necessarily a basis for $L/K$ by \cref{prop:field_of_fractions_AKBL}. However, an integral basis need not always exist. For if $\l_{1},\ldots,\l_{n}$ is a basis of $L/K$, \cref{prop:field_of_fractions_AKBL} implies that we can multiply by a nonzero element of $A$ to ensure that this basis lies in $B$. However, $\l_{1},\ldots,\l_{n}$ need not also be a basis of $B$ as an $A$-module. Nevertheless, if $A$ is a principal ideal domain then we can ensure the existence of an integral basis:
    
    \begin{theorem}\label{thm:integral_basis_AKBL}
      Let $A$ be a principal ideal domain with field of fractions $K$, let $L/K$ be a degree $n$ separable extension, and let $B$ be the integral closure of $A$ in $L$. Then $B$ admits an integral basis over $A$. Moreover, every finitely generated nonzero $B$-submodule of $L$ is a free $A$-module of rank $n$.
    \end{theorem}
    \begin{proof}
      $A$ is integrally closed by \cref{lemma:unique_factorization_domains_are_integrally_closed}. Let $\l_{1},\ldots,\l_{n}$ be a basis for $L/K$. By \cref{prop:field_of_fractions_AKBL} we may multiply by a nonzero element of $A$, if necessary, to ensure that this basis belongs to $B$. Then \cref{lem:lemma_for_integral_basis_AKBL} implies
      \[
        d_{L/K}(\l_{1},\ldots,\l_{n})B \subseteq A\l_{1}+\cdots+A\l_{n}.
      \]
      Since $A\l_{1}+\cdots+A\l_{n}$ is a free $A$-module of rank $n$ and $A$ is a principal ideal domain, it follows from the structure theorem of finitely generated modules over principal ideal domains that $B$ is also a free $A$-module of rank at most $n$. But any basis for $B$ as an $A$-module must also be a basis for $L/K$ by \cref{prop:field_of_fractions_AKBL}. Hence the rank is exactly $n$ and $B$ admits an integral basis over $A$ which proves the first statement. Now suppose $M$ is a nonzero $B$-submodule of $L$ and let $\w_{1},\ldots,\w_{r}$ be generators. By \cref{prop:field_of_fractions_AKBL} again we may multiply by a nonzero element of $A$, if necessary, to ensure that these generators belong to $B$. But then
      \[
        d_{L/K}(\w_{1},\ldots,\w_{n})M \subseteq d_{L/K}(\w_{1},\ldots,\w_{n})B.
      \]
      By the structure theorem of finitely generated modules over principal ideal domains again, $M$ is a free $A$-module of rank at most $n$. To see that the rank is at least $n$, let $\a \in M$ be nonzero and, as before, let $\l_{1},\ldots,\l_{n}$ be a basis for $L/K$ that is contained in $B$. Then $\a\l_{1},\ldots,\a\l_{n}$ is a basis for $L/K$ contained in $M$. Thus the rank of $M$ is at least $n$, and in particular it must be $n$. This completes the proof.
    \end{proof}

    We now turn to the case of a number field $K$ of degree $n$. We write $\Trace_{K} = \Trace_{K/\Q}$ and $\Norm_{K} = \Norm_{K/\Q}$ and call these the \textbf{field trace}\index{field trace} and \textbf{field norm}\index{field norm} of $K$ respectively. Moreover, for any $\k \in K$ we call $\Trace_{K}(\k)$ and $\Norm_{K}(\k)$ the \textbf{trace}\index{trace} and \textbf{norm}\index{norm} of $\k$ respectively. Then from \cref{prop:norm_and_trace_AKBL,prop:unit_if_and_only_if_AKBL} we see that the trace and norm of algebraic integers are themselves integers and $\k \in \mc{O}_{K}$ is a unit if and only if $\Norm_{K}(\k) = \pm 1$ (as these are the only units in $\Z$). Moreover, since $\Z$ is a principal ideal domain \cref{thm:integral_basis_AKBL} implies that $\mc{O}_{K}$ admits an integral basis over $\Z$ of degree $n$. That is, $\mc{O}_{K}$ is a free abelian group of rank $n$. Accordingly, we say that $\a_{1},\ldots,\a_{n}$ is an \textbf{integral basis}\index{integral basis} for $K$ if it is an integral basis of $\mc{O}_{K}$ over $\Z$. It is generally difficult to write down an explicit integral basis of a number field. However, there is one particular case of interest where it is possible to produce an explicit one. If $\mc{O}_{K} = \Z[\a]$ for some $\a \in \mc{O}_{K}$, we say that $K$ is \textbf{monogenic}\index{monogenic}. Then $1,\a,\ldots,\a^{n-1}$ is automatically an integral basis for $K$ since $\mc{O}_{K}$ is a free abelian group of rank $n$.
  \section{Dedekind Domains}
    We say that a ring is a \textbf{Dedekind domain}\index{Dedekind domain} if it satisfies the following properties:
    \begin{enumerate}[label=(\roman*)]
      \item It is an integrally closed integral domain.
      \item It is noetherian.
      \item Every nonzero prime ideal is maximal.
    \end{enumerate}
    Let $\smc{O}$ be a Dedekind domain and denote its field of fractions by $K$. Any nonzero ideal $\mf{a}$ of $\smc{O}$ is said to be an \textbf{integral ideal}\index{integral ideal} of $\smc{O}$. We call any prime integral ideal $\mf{p}$ of $\smc{O}$ a \textbf{prime}\index{prime} of $\smc{O}$ and if $\mf{p}$ is principal with $\mf{p} = \a\smc{O}$, with $\a \in K$ nonzero, we will simply refer to $\a$ as the prime instead of $\mf{p}$.
    
    \begin{remark}
      $\Z$ is an integrally closed integral domain by \cref{lemma:unique_factorization_domains_are_integrally_closed}. It is also noetherian since $\Z$ is a principal ideal domain. Every prime is of the form $p\Z$ for some prime $p$ and therefore is maximal because $\Z/p\Z$ is a field. It follows that $\Z$ is a Dedekind domain and the primes of $\Z$ are exactly the primes $p$.
    \end{remark}
    
    With this setup, property (ii) can be rephrased as saying that every integral ideal is finitely generated while property (iii) is equivalent to the fact that every prime is maximal. One should think of Dedekind domains as generalizations of $\Z$. Note that we have not assumed $\smc{O}$ is a principal ideal domain. In fact, the most interesting Dedekind domains are not principal ideal domains. Our primary concern regarding Dedekind domains will be to show that, while there need not be prime factorization of elements, prime factorization of integral ideals holds (actually we will prove something more general). We first show containment in one direction:

    \begin{lemma}\label{lem:integral_ideal_prime_containment}
      Let $\smc{O}$ be a Dedekind domain. For every integral ideal $\mf{a}$, there exist primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ such that
      \[
        \mf{p}_{1}\cdots\mf{p}_{k} \subseteq \mf{a}.
      \]
    \end{lemma}
    \begin{proof}
      Let $\mc{S}$ be the set of integral ideals which do not contain a product of prime integral. Then it suffices to show $\mc{S}$ is empty. Assuming otherwise and ordering $\mc{S}$ by inclusion, the fact that $\smc{O}$ is noetherian implies that there exists a maximal integral ideal $\mf{a} \in \mc{S}$. Moreover $\mf{a}$ cannot be prime for otherwise $\mf{a}$ contains a product of primes (namely itself). Since $\mf{a}$ is not prime, there exist $\a_{1},\a_{2} \in \smc{O}$ with $\a_{1}\a_{2} \in \mf{a}$ and such that $\a_{1},\a_{2} \notin \mf{a}$. Now define integral ideals
      \[
        \mf{b}_{1} = \mf{a}+\a_{1}\smc{O} \quad \text{and} \quad \mf{b}_{2} = \mf{a}+\a_{2}\smc{O}.
      \]
      Note that $\mf{b}_{1}$ and $\mf{b}_{2}$ strictly contain $\mf{a}$ because $\a_{1},\a_{2} \notin \mf{a}$. Moreover, $\mf{b}_{1}\mf{b}_{2} \subseteq \mf{a}$ because
      \[
        \mf{b}_{1}\mf{b}_{2} = (\mf{a}+\a_{1}\smc{O})(\mf{a}+\a_{2}\smc{O}) = \mf{a}^{2}+\a_{1}\smc{O}+\a_{2}\smc{O}+\a_{1}\a_{2}\smc{O},
      \]
      and $\a_{1}\a_{2} \in \mf{a}$. Maximality of $\mf{a}$ implies that there exist primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ and $\mf{q}_{1},\ldots,\mf{q}_{\ell}$ such that
      \[
        \mf{p}_{1}\cdots\mf{p}_{k} \subseteq \mf{b}_{1} \quad \text{and} \quad \mf{q}_{1}\cdots\mf{q}_{\ell} \subseteq \mf{b}_{2}.
      \]
      But then
      \[
        \mf{p}_{1}\cdots\mf{p}_{k}\mf{q}_{1}\cdots\mf{q}_{\ell} \subseteq \b_{1}\b_{2} \subseteq \mf{a},
      \]
      which contradicts the fact that $\mf{a} \in \mc{S}$. Hence $\mc{S}$ is empty as desired.
    \end{proof}

    In order to obtain the reverse containment in \cref{lem:integral_ideal_prime_containment}, we need to do more work. Precisely, we want to show that every integral ideal factors into a product of primes. To accomplish this, we will need to work in a slightly more general setting. First observe that an integral ideal $\mf{a}$ is just a $\smc{O}$-submodule of $\smc{O}$. Moreover, it is finitely generated since $\smc{O}$ is noetherian and is therefore a finitely generated $\smc{O}$-submodule of $K$. Accordingly, we say $\mf{f}$ is a \textbf{fractional ideal}\index{fractional ideal} of $\smc{O}$ if $\mf{f}$ a nonzero finitely generated $\smc{O}$-submodule of $K$. Moreover, we say that a fractional ideal is \textbf{principal}\index{principal} if it is generated by a single element. That is, if $\mf{f} = \k\smc{O}$ for some nonzero $\k \in K$. In particular, all integral ideals are fractional ideals and all principal integral ideals are principal fractional ideals. Now let $\k_{1},\ldots,\k_{r} \in K$ be generators for the fractional ideal $\mf{f}$. Since $K$ is the field of fractions of $\smc{O}$, $\k_{i} = \frac{\a_{i}}{\d_{i}}$ with $\a_{i},\d_{i} \in \smc{O}$ and where $\d_{i}$ is nonzero for $1 \le i \le r$. Setting $\d = \d_{1} \cdots \d_{r}$, we have that $\d\k_{i} \in \smc{O}$ for all $i$ and hence $\d\mf{f}$ is an integral ideal. Conversely, if there exists some nonzero $\d \in \smc{O}$ such that $\d\mf{f} = \mf{a}$ is an integral ideal then $\mf{f}$ is a fractional ideal because $\mf{a}$ is a finitely generated $\smc{O}$-submodule of $K$ and hence $\mf{f}$ is too. Thus for any fractional ideal $\mf{f}$, there exists a nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ such that
    \[
      \mf{f} = \frac{1}{\d}\mf{a}.
    \]
    Every fractional ideal is of this form, and integral ideals are precisely those for which $\d = 1$, and fractional ideals need not be a subgroup of $\smc{O}$. Now let $\mf{p}$ be a prime. We define $\mf{p}^{-1}$ by
    \[
      \mf{p}^{-1} = \{\k \in K:\k\mf{p} \subseteq \smc{O}\}.
    \]
    It turns out that $\mf{p}^{-1}$ is a fractional ideal. Indeed, since $\mf{p}$ is an integral ideal there exists a nonzero $\a \in \mf{p}$. By definition of $\mf{p}^{-1}$, we have that $\a\mf{p}^{-1} \subseteq \smc{O}$. Hence $\a\mf{p}^{-1}$ is an integral ideal and therefore $\mf{p}^{-1}$ is a fractional ideal. Unlike integral ideals, $1 \in \mf{p}^{-1}$ so that $\mf{p}^{-1}$ contains units. The following proposition proves a stronger version of this and more:

    \begin{lemma}\label{lem:inverse_for_prime_ideals}
      Let $\smc{O}$ be a Dedekind domain and $\mf{p}$ be a prime. Then the following hold:
      \begin{enumerate}[label=(\roman*)]
        \item
        \[
          \smc{O} \subset \mf{p}^{-1}.
        \]
        \item
        \[
          \mf{p}^{-1}\mf{p} = \smc{O}.
        \]
      \end{enumerate}
    \end{lemma}
    \begin{proof}
      We will prove the latter two statement separately:
      \begin{enumerate}[label=(\roman*)]
        \item Clearly $\smc{O} \subseteq \mf{p}^{-1}$ so it suffices to show that $\mf{p}^{-1}-\smc{O}$ is nonempty. To this end, let $\a \in \mf{p}$ be nonzero. By \cref{lem:integral_ideal_prime_containment} let $k \ge 1$ be the minimal integer such that there exist primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ with
        \[
          \mf{p}_{1} \cdots \mf{p}_{k} \subseteq \a\smc{O}.
        \]
        As $\a \in \mf{p}$, we have $\a\smc{O} \subseteq \mf{p}$. Since $\mf{p}$ is prime, there must be some $i$ with $1 \le i \le k$ such that $\mf{p}_{i} \subseteq \mf{p}$. Without loss of generality, we may assume $\mf{p}_{1} \subseteq \mf{p}$. As primes are maximal since $\smc{O}$ is noetherian, we conclude $\mf{p}_{1} = \mf{p}$. Moreover, since $k$ is minimal we must have
        \[
          \mf{p}_{2} \cdots \mf{p}_{k} \not\subseteq \a\smc{O}.
        \]
        Hence there exists $\b \in \mf{p}_{2} \cdots \mf{p}_{k}$ with $\b \notin \a\smc{O}$. We will now show that $\b\a^{-1}$ is an element in $\mf{p}^{-1}-\smc{O}$. Since $\mf{p}_{1} = \mf{p}$, what we have previously shown implies $\b\mf{p} \subseteq \a\smc{O}$ and hence $\b\a^{-1}\mf{p} \in \smc{O}$ which means $\b\a^{-1} \in \mf{p}^{-1}$. But as $\b \notin \a\smc{O}$, we also have $\b\a^{-1} \notin \smc{O}$. Hence $\b\a^{-1} \in \mf{p}^{-1}-\smc{O}$ which proves (i).
        \item By (i) and the definition of $\mf{p}^{-1}$, we have $\mf{p} \subseteq \mf{p}^{-1}\mf{p} \subseteq \smc{O}$. Since $\mf{p}$ is maximal because $\smc{O}$ is noetherian, it follows that $\mf{p}^{-1}\mf{p}$ is either $\mf{p}$ or $\smc{O}$. So it suffices to show that the first case cannot hold. Assume by contradiction that $\mf{p}^{-1}\mf{p} = \mf{p}$. Let $\w_{1},\ldots,\w_{r}$ generate $\mf{p}$ and let $\a \in \mf{p}^{-1}-\smc{O}$ which exists by (i). Then $\a\w_{i} \in \mf{p}^{-1}\mf{p}$ for $1 \le i \le r$ and hence $\a\mf{p} \subseteq \mf{p}^{-1}\mf{p}$. By our assumption, this further implies that $\a\mf{p} \subseteq \mf{p}$. But then
        \[
          \a\w_{i} = \sum_{1 \le j \le r}\a_{i,j}\w_{j},
        \]
        with $\a_{i,j} \in \smc{O}$ for $1 \le i,j \le r$. We can rewrite this as,
        \[
          (\a-\a_{i,i})\w_{i}-\sum_{\substack{1 \le j \le r \\ j \neq i}}\a_{i,j}\w_{j} = 0,
        \]
        for all $i$. These $r$ equations are equivalent to the identity
        \[
          \begin{pmatrix} \a-\a_{1,1} & \a_{1,2} & \cdots & -\a_{1,r} \\ -\a_{2,1} & \a-\a_{2,2} & & \\ \vdots & & \ddots & \\ -\a_{r,1} & & & \a-\a_{r,r} \end{pmatrix}\begin{pmatrix} \w_{1} \\ \w_{2} \\ \vdots \\ \w_{r} \end{pmatrix} = \mathbf{0}.
        \]
        Thus the determinant of the matrix on the left-hand side must be zero. But this means $\a$ is a root of the characteristic polynomial $\det(xI-(\a_{i,j}))$ which is a monic polynomial with coefficients $\smc{O}$. As $\smc{O}$ is integrally closed, $\a \in \smc{O}$ which is a contraction. Thus $\mf{p}^{-1}\mf{p} = \smc{O}$ proving (ii).
      \end{enumerate}
    \end{proof}

    We can now show that every integral ideal factors uniquely into a product of primes (up to reordering of the factors):

    \begin{theorem}\label{thm:unique_product_prime_ideals}
      Let $\smc{O}$ be a Dedekind domain. Then for every integral ideal $\mf{a}$ there exist primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ such that $\mf{a}$ factors as
      \[
        \mf{a} = \mf{p}_{1} \cdots \mf{p}_{k}.
      \]
      Moreover, this factorization is unique up to reordering of the factors.
    \end{theorem}
    \begin{proof}
      We first prove existence and then uniqueness. For existence, let $\mc{S}$ be the set of integral ideals that are not a product of primes. We will show that $\mc{S}$ is empty. Assuming otherwise and ordering $\mc{S}$ by inclusion, the fact that $\smc{O}$ is noetherian implies that there exists a maximal integral ideal $\mf{a} \in \mc{S}$. Necessarily $\mf{a}$ is not prime and since primes are maximal in $\smc{O}$, there is some prime $\mf{p}_{1}$ for which $\mf{a} \subset \mf{p}_{1}$. Then by \cref{lem:inverse_for_prime_ideals} (ii), we have $\mf{p}_{1}^{-1}\mf{a} \subset \smc{O}$ so that $\mf{p}_{1}^{-1}\mf{a}$ is also an integral ideal. Also, \cref{lem:inverse_for_prime_ideals} (i) implies that $\mf{a} \subset \mf{a}\mf{p}_{1}^{-1}$. By maximality of $\mf{a}$, $\mf{a}\mf{p}_{1}^{-1}$ factors into a product of primes. That is, there exist primes $\mf{p}_{2},\ldots,\mf{p}_{k}$ such that
      \[
        \mf{a}\mf{p}_{1}^{-1} = \mf{p}_{2},\ldots,\mf{p}_{k}.
      \]
      Hence
      \[
        \mf{a} = \mf{p}_{1},\ldots,\mf{p}_{k},
      \]
      so that $\mf{a}$ factors into a product of primes which contradicts the fact that $\mf{a} \in \mc{S}$. Hence $\mc{S}$ is empty thus proving the existence of such a factorization. Now we prove uniqueness. Suppose that $\mf{a}$ admits factorizations
      \[
        \mf{a} = \mf{p}_{1},\ldots,\mf{p}_{k} \quad \text{and} \quad \mf{a} = \mf{q}_{1},\ldots,\mf{q}_{\ell},
      \]
      for primes $\mf{p}_{i}$ and $\mf{q}_{j}$ with $1 \le i \le k$ and $1 \le j \le \ell$. Since $\mf{p}_{1}$ is prime, there is some $j$ for which $\mf{q}_{j} \subseteq \mf{p}_{1}$. Without loss of generality, we may assume $\mf{q}_{1} \subseteq \mf{p}_{1}$ and since primes are maximal in $\smc{O}$ we have $\mf{q}_{1} = \mf{p}_{1}$. Then
      \[
        \mf{p}_{2},\ldots,\mf{p}_{k} = \mf{q}_{2},\ldots,\mf{q}_{\ell}.
      \]
      Repeating this process, we see that $k = \ell$ and $\mf{q}_{i} = \mf{p}_{i}$ for all $i$. This proves uniqueness of the factorization.
    \end{proof}

    As a near immediate corollary of \cref{thm:unique_product_prime_ideals}, all fractional ideal admits a factorization into a product of primes and their inverses (up to reordering of the factors):

    \begin{corollary}\label{cor:fractional_ideal_prime_factorization}
      Let $\smc{O}$ be a Dedekind domain. Then for every fractional ideal $\mf{f}$ there exist primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ and $\mf{q}_{1},\ldots,\mf{q}_{\ell}$ such that $\mf{f}$ factors as
      \[
        \mf{f} = \mf{p}_{1} \cdots \mf{p}_{k}\mf{q}_{1}^{-1},\ldots,\mf{q}_{\ell}^{-1}.
      \]
      Moreover, this factorization is unique up to reordering of the factors.
    \end{corollary}
    \begin{proof}
      If $\mf{f}$ is a fractional ideal, then there exists a nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ such that $\mf{f} = \frac{1}{\d}\mf{a}$. In particular, $\mf{a}$ and $\d\smc{O}$ are integral ideals such that $\d\smc{O}\mf{f} = \mf{a}$. By \cref{thm:unique_product_prime_ideals}, $\mf{a}$ and $\d\smc{O}$ admit unique factorizations
      \[
        \mf{a} = \mf{p}_{1} \cdots \mf{p}_{k} \quad \text{and} \quad \d\smc{O} = \mf{q}_{1},\ldots,\mf{q}_{\ell},
      \]
      for some primes $\mf{p}_{1},\ldots,\mf{p}_{k}$ and $\mf{q}_{1},\ldots,\mf{q}_{\ell}$ up to reordering of the factors. Hence
      \[
        \mf{q}_{1},\ldots,\mf{q}_{\ell}\mf{f} = \mf{p}_{1} \cdots \mf{p}_{k},
      \]
      which is equivalent to the factorization for $\mf{f}$.
    \end{proof}

    By \cref{cor:fractional_ideal_prime_factorization}, for any fractional ideal $\mf{f}$ there exist distinct prime $\mf{p}_{1},\ldots,\mf{p}_{r}$ such that $\mf{f}$ admits a factorization
    \[
      \mf{f} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}},
    \]
    with $e_{i} \in \Z-\{0\}$ for all $i$, called the \textbf{prime factorization}\index{prime factorization} of $\mf{f}$ with \textbf{prime factors}\index{prime factors} $\mf{p}_{1},\ldots,\mf{p}_{r}$. In particular, the prime factorization of an integral ideal $\mf{a}$ is of the form
    \[
      \mf{a} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}},
    \]
    with $e_{i} \ge 1$ for all $i$. Accordingly, for any two integral ideal $\mf{a}$ and $\mf{b}$ we say that $\mf{a}$ \textbf{divides}\index{divides} $\mf{b}$ and write $\mf{a} \mid \mf{b}$ if $\mf{b} \subseteq \mf{a}$. By the prime factorization of fractional ideals, this is equivalent to the fact that every prime power factor of $\mf{a}$ appears in the prime factorization of $\mf{b}$. We also say that $\mf{a}$ \textbf{exactly divides}\index{exactly divides} $\mf{b}$ and write $\mf{a} \mid\mid \mf{b}$ if $\mf{a}$ divides $\mf{b}$ but no power of $\mf{a}$ divides $\mf{b}$. This is equivalent to the fact that every prime power factor of $\mf{a}$ appears in the prime factorization of $\mf{b}$ but not for any power of $\mf{a}$.
    
    \begin{remark}
      In the case of a prime $\mf{p}$ and an integral ideal $\mf{a}$, $\mf{p} \mid \mf{a}$ if and only if $\mf{p}$ is a prime factor of $\mf{a}$. Also, $\mf{p}^{e} \mid\mid \mf{a}$ for some $e \ge 1$ if and only if $\mf{p}^{e}$ is exactly the power of $\mf{p}$ appearing in the prime factorization of $\mf{a}$.
    \end{remark}
  
     Moreover, $\mf{a}$ and $\mf{b}$ are relatively prime if and only if their prime factorizations contain distinct primes. For if $\mf{a}$ and $\mf{b}$ have a prime factor $\mf{p}$ in common, the primality of $\mf{p}$ implies $\mf{a} \subseteq \mf{p}$ and $\mf{b} \subseteq \mf{p}$. Hence $\mf{a}+\mf{b} \subseteq \mf{p}$ so that $\mf{a}$ and $\mf{b}$ are not relatively prime. Conversely, if $\mf{a}+\mf{b} \neq \smc{O}$, then $\mf{a}+\mf{b} \subseteq \mf{p}$ for some prime $\mf{p}$ because primes are maximal in Dedekind domains. But then $\mf{a} \subseteq \mf{p}$ and $\mf{b} \subseteq \mf{p}$ and therefore $\mf{a}$ and $\mf{b}$ both have $\mf{p}$ as a prime factor. In particular, distinct primes and their powers are relatively prime. Just as it is common to suppress the fundamental theorem of arithmetic and just state the prime factorization of an integer, we suppress referencing \cref{thm:unique_product_prime_ideals} and simply state the prime factorization of a fractional ideal. We can now show that for a Dedekind domain, being a principal ideal domain is equivalent to being a unique factorization domain:

    \begin{proposition}\label{prop:UDF_PID_equivalence_for_Dedekind}
      Let $\smc{O}$ be a Dedekind domain. Then $\smc{O}$ is a principal ideal domain if and only if it is a unique factorization domain.
    \end{proposition}
    \begin{proof}
      The forward implication is trivial since every principal ideal domain is a unique factorization domain. For the reverse implication, suppose $\smc{O}$ is a unique factorization domain. Since every integral ideal factors into a product of primes by \cref{thm:unique_product_prime_ideals} and the product of principal integral ideals is principal, it suffices to show that primes are principal. So let $\mf{p}$ be a prime. Then there exists nonzero $\a \in \mf{p}$ and $\a$ is not a unit since $\mf{p}$ is prime (prime ideals are by definition proper). Since $\smc{O}$ is a unique factorization domain, we may write
      \[
        \a = \mu\rho_{1}^{e_{1}} \cdots \rho_{r}^{e_{r}},
      \]
      for some unit $\mu$ and primes $\rho_{i} \in \smc{O}$ and integers $e_{i} \ge 1$ for $1 \le i \le r$ with $r \ge 1$. Since $\mf{p}$ is prime, it follows that there is some $i$ such that $\rho_{i} \in \mf{p}$. Without loss of generality, we may assume $\rho_{1} \in \mf{p}$. Then the integral ideal $\rho_{1}\smc{O}$ satisfies $\rho_{1}\smc{O} \subseteq \mf{p}$. As $\rho_{1}$ is prime and $\smc{O}$ is a unique factorization domain, $\rho_{1}\smc{O}$ is a prime and hence maximal since $\smc{O}$ is also a Dedekind domain. Thus $\rho_{1}\smc{O} = \mf{p}$ and hence $\mf{p}$ is principal completing the proof.
    \end{proof}

    With the prime factorization in hand, we will discuss the group structure of the fractional ideals of $\smc{O}$. Let $I_{\smc{O}}$ denote the set of fractional ideals of $\smc{O}$. We call $I_{\smc{O}}$ the \textbf{ideal group}\index{ideal group} of $\smc{O}$. The following theorem shows that $I_{\smc{O}}$ is indeed a group:

    \begin{theorem}\label{thm:ideal_group_is_a_group}
      Let $\smc{O}$ be a Dedekind domain with field of fractions $K$. Then $I_{\smc{O}}$ is an abelian group with identity $\smc{O}$.
    \end{theorem}
    \begin{proof}
      It is clear that the product of fractional ideals is a fractional ideal. Associativity and commutativity of $I_{\smc{O}}$ are also obvious. The identity is $\smc{O}$ because every fractional ideal is a finitely generated $\smc{O}$-submodule of $K$. It follows that $\mf{p}^{-1}$ is the inverse of any prime $\mf{p}$ by \cref{lem:inverse_for_prime_ideals} (ii). Therefore every prime is invertible. If $\mf{a}$ is a integral ideal then it admits a prime factorization $\mf{a} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}}$ and then $\mf{b} = \mf{p}_{1}^{-e_{1}} \cdots \mf{p}_{r}^{-e_{r}}$ is its inverse. Hence every integral ideal is invertible. If $\mf{f}$ is a fractional ideal, there exists a nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ such that $\mf{f} = \frac{1}{\d}\mf{a}$ and hence $\mf{f}$ is invertible because $\d$ and $\mf{a}$ are. It follows that every fractional ideal is invertible which completes the proof.
    \end{proof}

    Now that we have proved that the ideal group $I_{\smc{O}}$ of $K$ is indeed a group, we can also deduce the explicit form for the inverse $\mf{f}^{-1}$ of any fractional ideal $\mf{f}$:

    \begin{proposition}\label{prop:explicit_inverse_ideal}
      Let $\smc{O}$ be a Dedekind domain with field of fractions $K$ and let $\mf{f}$ be a fractional ideal. Then
      \[
        \mf{f}^{-1} = \{\k \in K:\k\mf{f} \subseteq \smc{O}\}.
      \]
      In particular, $\smc{O} \subseteq \mf{f}$ if and only if $\mf{f}^{-1}$ is an integral ideal.
    \end{proposition}
    \begin{proof}
      Let $\mf{f}$ be a fractional ideal. Then the inverse $\mf{f}^{-1}$ exists by \cref{thm:ideal_group_is_a_group}. In the case of an integral ideal $\mf{a}$, we have
      \[
        \mf{a}^{-1} = \{\k \in K:\k\mf{a} \subseteq \smc{O}\},
      \]
      by the prime factorization of $\mf{a}$ and the definition of the inverse of a prime. If $\mf{f}$ is a fractional ideal, there exists a nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ such that $\mf{f} = \frac{1}{\d}\mf{a}$. But then $\d\mf{f} = \mf{a}$ so that
      \[
        \frac{1}{\d}\mf{f}^{-1} = \{\k \in K:\k\d\mf{f} \subseteq \smc{O}\},
      \]
      which is equivalent to the first statement. For the second statement, if $\smc{O} \subseteq \mf{f}$ then multiplying by $\mf{f}^{-1}$ shows $\mf{f}^{-1} \subseteq \smc{O}$ and hence $\mf{f}^{-1}$ is an integral ideal. Running this argument backwards by multiplying by $\mf{f}$ proves the converse.
    \end{proof}

    We will now discuss applications of the Chinese remainder theorem in the context of integral ideals. With it we can prove some interesting results. First, we recall a useful fact. Suppose $\mf{a}$ is an integral ideal with prime factorization
    \[
      \mf{a} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}}.
    \]
    As powers of distinct primes are relatively prime, the integral ideals $\mf{p}_{1}^{e_{1}},\ldots,\mf{p}_{r}^{e_{r}}$ are pairwise relatively prime so that the Chinese remainder theorem gives an isomorphism
    \[
      \smc{O}/\mf{a} \cong \bigop_{1 \le i \le r}\smc{O}/\mf{p}_{i}^{e_{i}}.
    \]
    In particular, for any $\a_{i} \in \smc{O}$ for all $i$, there exists a unique $\a \in \smc{O}$ such that
    \[
      \a \equiv \a_{i} \pmod{\mf{p}_{i}^{e_{i}}},
    \]
    for all $i$. We will use the Chinese remainder theorem to prove a few useful facts about Dedekind domains. The first of which is regarding the quotient of a Dedekind domain by a prime:

    \begin{proposition}\label{prop:isomorphism_of_quotient_by_prime_integral_ideals}
      Let $\smc{O}$ be a Dedekind domain. Then for any prime $\mf{p}$ and $n \ge 0$, we have an isomorphism
      \[
        \smc{O}/\mf{p} \cong \mf{p}^{n}/\mf{p}^{n+1}.
      \]
    \end{proposition}
    \begin{proof}
      By the prime factorization of fractional ideals, there exists $\b \in \mf{p}^{n}-\mf{p}^{n+1}$. Now consider the homomorphism
      \[
        \phi:\smc{O} \to \mf{p}^{n}/\mf{p}^{n+1} \qquad \a \mapsto \a\b \pmod{\mf{p}^{n+1}}.
      \]
      By the first isomorphism theorem, it suffices to show $\ker\phi = \mf{p}$ and that $\phi$ is surjective. Let us first show $\ker\phi = \mf{p}$. As $\b \in \mf{p}^{n}$, it is obvious that $\mf{p} \subseteq \ker\phi$. Conversely, suppose $\a \in \smc{O}$ is such that $\phi(\a) = 0$. Then $\a\b \in \mf{p}^{n+1}$ and as $\b \in \mf{p}^{n}-\mf{p}^{n+1}$, we must have $\a \in \mf{p}$. It follows that $\ker\phi = \mf{p}$. We now show that $\phi$ is surjective. Let $\g \in \mf{p}^{n}$ be a representative of a class in $\mf{p}^{n}/\mf{p}^{n+1}$. As $\b \in \mf{p}^{n}$, we have $\b\smc{O} \subseteq \mf{p}^{n}$. But since $\b \notin \mf{p}^{n+1}$, we see that $\b\smc{O}\mf{p}^{-n}$ is necessarily an integral ideal relatively prime to $\mf{p}^{n+1}$. As $\mf{p}^{n+1}$ and $\b\smc{O}\mf{p}^{-n}$ are relatively prime, the Chinese remainder theorem implies that we can find a unique $\a \in \smc{O}$ such that
      \[
        \a \equiv \g \pmod{\mf{p}^{n+1}} \quad \text{and} \quad \a \equiv 0 \tmod{\b\smc{O}\mf{p}^{-n}}.
      \]
      The second condition implies $\a \in \b\smc{O}\mf{p}^{-n}$. As $\g \in \mf{p}^{n}$ and $\a$ and $\g$ differ by an element in $\mf{p}^{n+1} \subset \mf{p}^{n}$, we have that $\a \in \b\smc{O}\mf{p}^{-n} \cap \mf{p}^{n} = \b\smc{O}$ where the equality holds because the intersection of ideals is equal to their product provided the ideals are relatively prime. Thus $\a\b^{-1} \in \smc{O}$ and hence
      \[
        \phi(\a\b^{-1}) = \a \equiv \g \tmod{\mf{p}^{n+1}}.
      \]
      This shows $\phi$ is surjective completing the proof.
    \end{proof}

    Our second fact is that if a Dedekind domain contains only finitely many primes then it must be a principal ideal domain:

    \begin{proposition}\label{prop:Dedekind_with_finite_primes_is_PID}
      Let $\smc{O}$ be a Dedekind domain. If there are only finitely many primes of $\smc{O}$, then $\smc{O}$ is a principal ideal domain.
    \end{proposition}
    \begin{proof}
      Let $\mf{p}_{1},\ldots,\mf{p}_{r}$ be the primes of $\smc{O}$. Then for any integral ideal $\mf{a}$, the prime factorization is
      \[
        \mf{a} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}},
      \]
      with $e_{i} \ge 0$ for $1 \le i \le r$. By the prime factorization of fractional ideals, there exists $\a_{i} \in \mf{p}_{i}^{e_{i}}-\mf{p}_{i}^{e_{i}+1}$ for all $i$. Since $\mf{p}_{1}^{e_{1}+1},\ldots,\mf{p}_{r}^{e_{r}+1}$ are pairwise relatively prime, the Chinese remainder theorem implies that there exists $\a \in \smc{O}$ with 
      \[
        \a \equiv \a_{i} \tmod{\mf{p}_{i}^{e_{i}+1}},
      \]
      for all $i$. As $\a_{i} \in \mf{p}_{i}^{e_{i}}$ for all $i$, we have that $\a \in \mf{a}$ and hence $\a\smc{O} \subseteq \mf{a}$. But as $\a \notin \mf{p}_{i}^{e_{i}+1}$ for all $i$, we see that $\a\smc{O}\mf{a}^{-1}$ is necessarily an integral ideal relatively prime to all primes of $\smc{O}$. This means $\a\smc{O}\mf{a}^{-1} = \smc{O}$ and hence $\mf{a} = \a\smc{O}$ so that $\mf{a}$ is principal. As $\mf{a}$ was arbitrary, $\smc{O}$ is a principal ideal domain.
    \end{proof}
    
    We now show that any fractional ideal is generated by at most two elements:

    \begin{proposition}\label{prop:fractional_ideal_generated_by_two_elements}
      Let $\smc{O}$ be a Dedekind domain. Then any fractional ideal is generated by at most two elements.
    \end{proposition}
    \begin{proof}
      We first prove the claim for an integral ideal $\mf{a}$. Let $\a \in \mf{a}$ be nonzero and let $\mf{p}_{1},\ldots,\mf{p}_{r}$ be the prime factors of $\a\smc{O}$. As $\a\smc{O} \subseteq \mf{a}$, the prime factorization of $\mf{a}$ is
      \[
        \mf{a} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}},
      \]
      with $e_{i} \ge 0$ for $1 \le i \le r$. By the prime factorization of fractional ideals, there exists $\b_{i} \in \mf{p}_{i}^{e_{i}}-\mf{p}_{i}^{e_{i}+1}$ for all $i$. Since $\mf{p}_{1}^{e_{1}+1},\ldots,\mf{p}_{r}^{e_{r}+1}$ are pairwise relatively prime, the Chinese remainder theorem implies that there exists $\b \in \smc{O}$ with 
      \[
        \b \equiv \b_{i} \tmod{\mf{p}_{i}^{e_{i}+1}},
      \]
      for all $i$. As $\b_{i} \in \mf{p}_{i}^{e_{i}}$ for all $i$, we have that $\b \in \mf{a}$ and hence $\b\smc{O} \subseteq \mf{a}$. But as $\b \notin \mf{p}_{i}^{e_{i}+1}$ for all $i$, we see that $\b\smc{O}\mf{a}^{-1}$ is necessarily an integral ideal relatively prime to $\mf{p}_{1},\ldots,\mf{p}_{r}$ and hence to $\a\smc{O}$. This means
      \[
        \b\smc{O}\mf{a}^{-1}+\a\smc{O} = \smc{O},
      \]
      and hence
      \[
        \b\smc{O}+\a\mf{a} = \mf{a}.
      \]
      But as $\a,\b \in \mf{a}$, we have $\b\smc{O}+\a\mf{a} \subseteq \b\smc{O}+\a\smc{O} \subseteq \mf{a}$ and so
      \[
        \b\smc{O}+\a\smc{O} = \mf{a}.
      \]
      This shows that $\mf{a}$ is generated by at most two elements. Now suppose $\mf{f}$ is a fractional ideal. Then there exists a nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ such that $\mf{f} = \frac{1}{\d}\mf{a}$. Since $\mf{a}$ is generated by at most two elements, say $\a$ and $\b$, we have
      \[
        \mf{f} = \frac{\a}{\d}\smc{O}+\frac{\b}{\d}\smc{O},
      \]
      and so $\mf{f}$ is also generated by at most two elements as well.
    \end{proof}

    \cref{prop:fractional_ideal_generated_by_two_elements} shows that while a Dedekind domain $\smc{O}$ may not be a principal ideal domain, it is not far off from one since every integral ideal needs at most two generators. We can give a more refined interpretation of this using the ideal group $I_{\smc{O}}$. Let $P_{\smc{O}}$ denote the subgroup of principal fractional ideals of $I_{\smc{O}}$. Since $I_{\smc{O}}$ is abelian by \cref{thm:ideal_group_is_a_group}, $P_{\smc{O}}$ is normal. The \textbf{ideal class group}\index{ideal class group} $\Cl(\smc{O})$ of $\smc{O}$ is defined to be the quotient group
    \[
      \Cl(\smc{O}) = I_{\smc{O}}/P_{\smc{O}},
    \]
    We call an element of $\Cl(\smc{O})$ an \textbf{ideal class}\index{ideal class} of $\smc{O}$. As every fractional ideal $\mf{f}$ can be expressed as $\mf{f} = \frac{1}{\d}\mf{a}$ for some nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$, we have $\d\mf{f} = \mf{a}$ and hence every ideal class can be represented by an integral ideal $\mf{a}$. The \textbf{class number}\index{class number} $h_{\smc{O}}$ of $\smc{O}$ is defined by
    \[
      h_{\smc{O}} = |\Cl(\smc{O})|.
    \]
    The ideal class group is an object which encodes how much $\smc{O}$ fails to be a principal ideal domain (equivalently a unique factorization domain by \cref{prop:UDF_PID_equivalence_for_Dedekind}) while the class number $h_{\smc{O}}$ is a measure of the degree of failure. For example, $\smc{O}$ is a principal ideal domain if and only if $h_{\smc{O}} = 1$. Indeed, if $\smc{O}$ is a principal ideal domain then every integral ideal is principal and hence every fractional ideal is too (because every fractional ideal is of the form $\frac{1}{\d}\mf{a}$ for some nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$). But then $\Cl(\smc{O})$ is the trivial group and hence $h_{\smc{O}} = 1$. Conversely, if $h_{\smc{O}} = 1$ then every integral ideal is principal so that $\smc{O}$ is a principal ideal domain.

    \begin{remark}\label{rem:general_class_number_not_finite}
      The class number $h_{\smc{O}}$ need not be finite for a general Dedekind domain $\smc{O}$.
    \end{remark}
    
    The \textbf{unit group}\index{unit group} of $\smc{O}$ is defined to be $\smc{O}^{\ast}$. That is, the unit group is the group of units in $\smc{O}$. The ideal class group and the unit group of $\smc{O}$ are related via the following exact sequence:

    \begin{proposition}\label{prop:ideal_class_group_exact_sequence}
      Let $\smc{O}$ be a Dedekind domain with field of fractions $K$. Then the sequence

      \begin{center}
        \begin{tikzcd}[row sep=large, column sep=large]
          1 \arrow{r} & \smc{O}^{\ast} \arrow{r} & K^{\ast} \arrow{r}{\smc{O}} & I_{\smc{O}} \arrow{r} & \Cl(\smc{O}) \arrow{r} & 1,
        \end{tikzcd}
      \end{center}

      where the middle map takes any $\k \in K^{\ast}$ to its associated principal fractional ideal $\k\smc{O}$, is exact.
    \end{proposition}
    \begin{proof}
      The sequence is exact at $\smc{O}^{\ast}$ because the second map is injective. For exactness at $K^{\ast}$, the image of the second map is contained in the kernel of the third map since $\smc{O}$ is the identity in $I_{\smc{O}}$ by \cref{thm:ideal_group_is_a_group}. So suppose $\k \in K^{\ast}$ is contained in the kernel of the third map. Then $\k\smc{O} = \smc{O}$ which implies $\k \in \smc{O}^{\ast}$ because $1 \in \smc{O}$. This proves exactness at $K^{\ast}$. Exactness at $I_{\smc{O}}$ follows by the definition of $\Cl(\smc{O})$. Lastly, the sequence is exact at $\Cl(\smc{O})$ since the fourth map is surjective which completes the proof.
    \end{proof}

    Thinking of the third map in \cref{prop:ideal_class_group_exact_sequence} as passing from numbers in $K^{\ast}$ to fractional ideals in $I_{\smc{O}}$, exactness means that unit group is measuring the contraction (how many numbers are annihilated) taking place during this process while the class group is measuring the expansion (how many fractional ideal are created).
    
    \begin{remark}
      The class number $h_{\smc{O}}$ and the unit group $\smc{O}^{\ast}$ of $\smc{O}$ are generally two of the most difficult pieces of algebraic data of $\smc{O}$ to compute.
    \end{remark}
    
    We now turn to the case of a number field $K$ for which our developments so far can be refined. However, in order to apply our results on Dedekind domains, we need to show that $\mc{O}_{K}$ is one:

    \begin{theorem}\label{thm:ring_of_integers_is_Dedekind}
      Let $K$ be a number field. Then $\mc{O}_{K}$ is a Dedekind domain.
    \end{theorem}
    \begin{proof}
      Since $\mc{O}_{K}$ is the integral closure of $\Z$ in $K$, $\mc{O}_{K}$ is automatically an integrally closed integral domain. As $\mc{O}_{K}$ is a free abelian group of finite rank, any ideal is a finitely generated $\Z$-module and hence a finitely generated $\mc{O}_{K}$-module. This proves that $\mc{O}_{K}$ is noetherian. It remains to prove that every nonzero prime ideal of $\mc{O}_{K}$ is maximal. Letting $\mf{p}$ be a nonzero prime ideal, it suffices to show $\mc{O}_{K}/\mf{p}$ is a field. To this end, consider the homomorphism
      \[
        \phi:\Z \to \mc{O}_{K}/\mf{p} \qquad \a \mapsto \a \tmod{\mf{p}}.
      \]
      Then $\ker\phi = \mf{p} \cap \Z$ and we claim $\mf{p} \cap \Z$ is a nonzero prime ideal of $\Z$. It is obviously an ideal of $\Z$ and is prime because $\mf{p}$ is. To see that it is nonzero, let $\a \in \mf{p}$ be nonzero. As $\a$ is an algebraic integer, we have
      \[
        \a^{n}+a_{n-1}\a^{n-1}+\cdots+a_{0} = 0,
      \]
      for some $n \ge 1$ and $a_{i} \in \Z$ for $0 \le i \le n-1$. Taking $n$ minimal, we have $a_{0} \neq 0$. Isolating $a_{0}$ shows that $a_{0} \in \mf{p}$ and hence $a_{0} \in \mf{p} \cap \Z$. Therefore $\mf{p} \cap \Z = p\Z$ for some prime $p$. Hence $\ker\phi = p\Z$ and by the first isomorphism theorem, $\phi$ induces an injection $\phi:\F_{p} \to \mc{O}_{K}/\mf{p}$. As $\mc{O}_{K}$ is the integral closure of $\Z$ in $K$, it is obtained from $\Z$ by forming a polynomial ring with algebraic elements. The latter injection then shows that $\mc{O}_{K}/\mf{p}$ is obtained from $\F_{p}$ by adjoining the images of these algebraic elements modulo $\mf{p}$. These images are still algebraic over $\F_{p}$ by reducing their minimal polynomials modulo $\mf{p}$. Hence $\mc{O}_{K}/\mf{p}$ is obtained from $\F_{p}$ by adjoining algebraic elements to $\F_{p}$ (since $\F_{p}[\a] = \F_{p}(\a)$ if $\a$ is algebraic over $\F_{p}$) and is therefore a field.
    \end{proof}

    In view of the fact that $\mc{O}_{K}$ is a Dedekind domain by \cref{thm:ring_of_integers_is_Dedekind}, we simplify some terminology. An \textbf{integral ideal}\index{integral ideal} of $K$ is simply an integral ideal of $\mc{O}_{K}$, a \textbf{prime}\index{prime} of $K$ is a prime of $\mc{O}_{K}$, and a \textbf{fractional ideal}\index{fractional ideal} of $K$ is a fractional ideal of $\mc{O}_{K}$. The \textbf{ideal group}\index{ideal group} $I_{K}$ of $K$ is the ideal group of $\mc{O}_{K}$, we write $P_{K}$ for the subgroup of principal fractional ideals of $K$, and the \textbf{ideal class group}\index{ideal class group} $\Cl(K)$ of $K$ is the ideal class group of $\mc{O}_{K}$. In particular,
    \[
      \Cl(K) = I_{K}/P_{K}.
    \]
    The \textbf{class number}\index{class number} $h_{K}$ of $K$ is the class number of $\mc{O}_{K}$ and so
    \[
      h_{K} = |\Cl(K)|.
    \]
    The \textbf{unit group}\index{unit group} of $K$ is the unit group of $\mc{O}_{K}$ and we call any element of $\mc{O}_{K}^{\ast}$ a \textbf{unit}\index{unit} of $K$ (with the understanding that every element of $K$ is invertible in $K$). It follows from \cref{thm:ring_of_integers_is_Dedekind,thm:unique_product_prime_ideals} that integral ideals $\mf{a}$ of $K$ admit prime factorizations. One of our core investigations will be to understand how the principal integral ideal $p\mc{O}_{K}$ factors into a product of primes of $K$ for any prime $p$. Moreover, we will be able to leverage geometric tools to show that the class number $h_{K}$ is finite and completely describe the unit group $\mc{O}_{K}^{\ast}$.
  \section{Localization}
    Let $\smc{O}$ be an integral domain with field of fractions $K$. If $D \subseteq \smc{O}-\{0\}$ is multiplicative (recall that necessarily $1 \in D$), then the \textbf{localization}\index{localization} $\smc{O}D^{-1}$ of $\smc{O}$ at $D$ is defined by
    \[
      \smc{O}D^{-1} = \left\{\frac{\a}{\d} \in K:\text{$\a \in \smc{O}$ and $\d \in D$}\right\}.
    \]
    This is clearly a subring of $K$. In particular, localizing $\smc{O}$ at $\smc{O}-\{0\}$ gives $K$. As one might expect, localizing generally preserves prime ideals as the following proposition shows:

    \begin{proposition}\label{prop:localization_prime_bijection}
      Let $\smc{O}$ be an integral domain and $D \subseteq \smc{O}-\{0\}$ be multiplicative. Then the maps
      \[
        \mf{q} \mapsto \mf{q}\smc{O}D^{-1} \quad \text{and} \quad \mf{Q} \mapsto \mf{Q} \cap \smc{O}.
      \]
      are inverse inclusion-preserving bijections between the set of ideals $\mf{q}$ of $\smc{O}$ disjoint from $D$ and set of ideals $\mf{Q}$ of $\smc{O}D^{-1}$.
    \end{proposition}
    \begin{proof}
      First suppose $\mf{q}$ is a prime ideal of $\smc{O}$ that is disjoint from $D$. We claim that
      \[
        \mf{q}\smc{O}D^{-1} = \left\{\frac{\a}{\d}:\a \in \mf{q} \text{ and } \d \in D\right\},
      \]
      is a prime ideal of $\smc{O}D^{-1}$. It is clearly an ideal of $\smc{O}D^{-1}$. To see that it is prime, suppose $\frac{\a}{\d},\frac{\b}{\g} \in \smc{O}D^{-1}$ are such that $\frac{\a\b}{\d\g} \in \mf{q}\smc{O}D^{-1}$. Then $\a\b \in \mf{q}$ and thus $\a \in \mf{q}$ or $\b \in \mf{q}$ because $\mf{q}$ is prime. Hence $\frac{\a}{\d} \in \mf{q}\smc{O}D^{-1}$ or $\frac{\b}{\g} \in \mf{q}\smc{O}D^{-1}$ as desired. Also, the prime ideal $\mf{q}\smc{O}D^{-1}$ satisfies
      \[
        \mf{q} = \mf{q}\smc{O}D^{-1} \cap \smc{O}.
      \]
      The forward inclusion is obvious. For the reverse inclusion, if $\frac{\a}{\d} \in \mf{q}\smc{O}D^{-1} \cap \smc{O}$ then $\a \in \mf{q}$ and hence $\frac{\a}{\d} \in \mf{q}$ because $\mf{q}$ is prime and $\d \notin \mf{q}$ as $\mf{q}$ is disjoint from $D$. Now suppose $\mf{Q}$ is a prime ideal of $\smc{O}D^{-1}$. We claim that $\mf{Q} \cap \smc{O}$ is a prime ideal of $\smc{O}$ that is disjoint from $D$. It is clearly an ideal of $\smc{O}$ and is prime because $\mf{Q}$ is. To see that it is disjoint from $D$, if $\d \in \mf{Q} \cap \smc{O}$ with $\d \in D$ then $1 \in \mf{Q} \cap \smc{O}$ because $\frac{1}{\d} \in \smc{O}D^{-1}$ and $\mf{Q}$ is an ideal of $\smc{O}D^{-1}$. This is impossible since $\mf{Q} \cap \smc{O}$ is prime (and hence a proper ideal). Moreover, the prime ideal $\mf{Q} \cap \smc{O}$ satisfies
      \[
        \mf{Q} = (\mf{Q} \cap \smc{O})D^{-1}.
      \]
      The reverse inclusion is obvious since $1 \in D$. For the forward inclusion, if $\frac{\a}{\d} \in \mf{Q}$, then $\a \in \mf{Q} \cap \smc{O}$ and thus $\frac{\a}{\d} \in (\mf{Q} \cap \smc{O})D^{-1}$. All of this together shows that the mappings
      \[
        \mf{q} \mapsto \mf{q}\smc{O}D^{-1} \quad \text{and} \quad \mf{Q} \mapsto \mf{Q} \cap \smc{O}.
      \]
      are inverse bijections between the set of prime ideals $\mf{q}$ of $\smc{O}$ disjoint from $D$ and set of the prime ideals $\mf{Q}$ of $\smc{O}D^{-1}$. They are clearly inclusion-preserving.
    \end{proof}

    Localization is most useful when we localize at the compliment of a prime ideal or collection of prime ideals. If $\mf{p}$ is a prime ideal of $\smc{O}$, then $\smc{O}-\mf{p} \subset \smc{O}-\{0\}$ is multiplicative. Indeed, the inclusion is obvious, $1 \in \smc{O}-\mf{p}$ because $\mf{p}$ is proper and thus does not contain units, and if $\a,\b \in \smc{O}-\mf{p}$ then $\a\b \notin \mf{p}$ because $\mf{p}$ is prime so that $\a\b \in \smc{O}-\mf{p}$ and thus $\smc{O}-\mf{p}$ is closed under multiplication. We define the \textbf{localization}\index{localization} $\smc{O}_{\mf{p}}$ of $\smc{O}$ at $\mf{p}$ by
    \[
      \smc{O}_{\mf{p}} = \smc{O}(\smc{O}-\mf{p})^{-1}.
    \]
    In other words,
    \[
      \smc{O}_{\mf{p}} = \left\{\frac{\a}{\d} \in K:\text{$\a,\d \in \smc{O}$ with $\d \not\equiv 0 \tmod{\mf{p}}$}\right\},
    \]
    Then \cref{prop:localization_prime_bijection} gives an explicit bijection between the prime ideals of $\smc{O}$ contained in $\mf{p}$ and the prime ideals of $\smc{O}_{\mf{p}}$. Essentially, localizing at a prime ideal $\mf{p}$ removes all of the algebraic information about $\smc{O}$ that has nothing to do with the prime ideal $\mf{p}$. More generally, let $X$ be a set of prime ideals in $\smc{O}$ and consider
    \[
      \smc{O}-\bigcup_{\mf{p} \in X}\mf{p}.
    \]
    Then $\smc{O}-\bigcup_{\mf{p} \in X}\mf{p} \subseteq \smc{O}-\{0\}$ is multiplicative because
    \[
      \smc{O}-\bigcup_{\mf{p} \in X}\mf{p} = \bigcap_{\mf{p} \in X}(\smc{O}-\mf{p}),
    \]
    and the $\smc{O}-\mf{p}$ are. We define the \textbf{localization}\index{localization} $\smc{O}(X)$ of $\smc{O}$ at $X$ by
    \[
      \smc{O}(X) = \smc{O}\left(\smc{O}-\bigcup_{\mf{p} \in X}\mf{p}\right)^{-1}.
    \]
    Equivalently,
    \[
      \smc{O}(X) = \left\{\frac{\a}{\d} \in K:\text{$\a,\d \in \smc{O}$ with $\d \not\equiv 0 \tmod{\mf{p}}$ for some $\mf{p} \in X$}\right\}.
    \]
    Note that if $X = \{\mf{p}\}$, then $\smc{O}(X) = \smc{O}_{\mf{p}}$. In any case, localizing is a useful tool in algebraic investigations and we quickly collect some useful properties. For example, localization behaves well with respect to taking inverses of ideals:
    
    \begin{proposition}\label{prop:localization_of_inverse_is_inverse_of_localization}
      Let $\smc{O}$ be an integral domain with field of fractions $K$ and $D \subseteq \smc{O}-\{0\}$ be multiplicative. Then for any fractional ideal $\mf{f}$, we have
      \[
        \mf{f}^{-1}\smc{O}D^{-1} = (\mf{f}\smc{O}D^{-1})^{-1}.
      \]
    \end{proposition}
    \begin{proof}
      In light of the fact that every fractional ideal $\mf{f}$ is of the form $\mf{f} = \frac{1}{\d}\mf{a}$ for some nonzero $\d \in \smc{O}$ and integral ideal $\mf{a}$ and $\mf{f}^{-1} = \d\mf{a}^{-1}$, it suffices to prove the claim for integral ideals. So we will show $\mf{a}^{-1}\smc{O}D^{-1} = (\mf{a}\smc{O}D^{-1})^{-1}$. For the forward inclusion, let $\a \in \mf{a}^{-1}$ and $\frac{\b}{\d} \in \smc{O}D^{-1}$. Then by \cref{prop:explicit_inverse_ideal} we have $\a\mf{a} \subseteq \smc{O}$ and thus $\a\frac{\b}{\d} \subseteq \smc{O}D^{-1}$. But then $\a\frac{\b}{\d}\mf{a}\smc{O}D^{-1} \subseteq \smc{O}D^{-1}$ which proves the forward inclusion. For the reverse inclusion, suppose $\k \in (\mf{a}\smc{O}D^{-1})^{-1}$. By \cref{prop:explicit_inverse_ideal}, $\k\mf{a}\smc{O}D^{-1} \subseteq \smc{O}D^{-1}$ and multiplying by $\mf{a}^{-1}$ shows $\k \in \mf{a}^{-1}\smc{O}D^{-1}$. This proves the reverse inclusion.
    \end{proof}
    
    ALso, localization behaves well with respect to integral closure:

    \begin{proposition}\label{prop:localization_of_integral_closure_is_integral_closure}
      Let $\smc{O}$ be an integral domain with field of fractions $K$, $L/K$ be a finite extension, and $\mc{O}$ be the integral closure of $\smc{O}$ in $L$. Then for any multiplicative set $D \subseteq \smc{O}-\{0\}$, $\mc{O}D^{-1}$ is the integral closure of $\smc{O}D^{-1}$ in $L$.
    \end{proposition}
    \begin{proof}
      We need to show that $\mc{O}D^{-1} = \conj{\smc{O}D^{-1}}$. For the forward inclusion, let $\frac{\a}{\d} \in \mc{O}D^{-1}$. As $\mc{O}$ is the integral closure of $\smc{O}$ in $L$, $\a$ is integral over $\smc{O}$ so that
      \[
        \a^{n}+a_{n-1}\a^{n-1}+\cdots+a_{0} = 0,
      \]
      for some $n \ge 1$ and $a_{i} \in \smc{O}$ for $0 \le i \le n-1$. Diving by $\d^{n}$, we obtain
      \[
        \left(\frac{\a}{\d}\right)^{n}+\frac{a_{n-1}}{\d}\left(\frac{\a}{\d}\right)^{n-1}+\cdots+\frac{a_{0}}{\d^{n}} = 0.
      \]
      Thus $\frac{\a}{\d}$ is the root of a monic polynomial with coefficients in $\smc{O}D^{-1}$. Therefore the forward inclusion holds. For the reverse inclusion, suppose $\l \in \conj{\smc{O}D^{-1}}$. Then
      \[
        \l^{n}+\frac{a_{n-1}}{\d_{n-1}}\l^{n-1}+\cdots+\frac{a_{0}}{\d_{0}} = 0,
      \]
      for some $n \ge 1$ and $\frac{a_{i}}{\d_{i}} \in \smc{O}D^{-1}$ for $0 \le i \le n-1$. Letting $\d = \d_{0}\cdots\d_{n-1}$ and multiplying by $\d^{n}$, we obtain
      \[
        (\l\d)^{n}+\frac{a_{n-1}\d}{\d_{n-1}}(\l\d)^{n-1}+\cdots+\frac{a_{0}\d^{n}}{\d_{0}} = 0.
      \]
      It follows that $\l\d$ is the root of a monic polynomial with coefficients in $\smc{O}$. As $\mc{O}$ is the integral closure of $\smc{O}$ in $L$, we have $\l\d \in \smc{O}$ and thus $\l \in \smc{O}D^{-1}$. This proves the reverse inclusion which means $\mc{O}D^{-1}$ is the integral closure of $\smc{O}D^{-1}$ in $L$.
    \end{proof}

    Lastly, and perhaps most importantly, intersections of localizations behave with respect to ideals and units:

    \begin{proposition}\label{prop:ring_is_intersection_of_all_localizations}
      Let $\smc{O}$ be a noetherian integral domain. Then for every fractional ideal $\mf{f}$ of $\smc{O}$, we have
      \[
        \mf{f} = \bigcap_{\text{$\mf{p}$ nonzero prime}}\mf{f}\smc{O}_{\mf{p}}.
      \]
      In particular,
      \[
        \smc{O} = \bigcap_{\text{$\mf{p}$ nonzero prime}}\smc{O}_{\mf{p}} \quad \text{and} \quad \smc{O}^{\ast} = \bigcap_{\text{$\mf{p}$ nonzero prime}}\smc{O}_{\mf{p}}^{\ast}.
      \]
    \end{proposition}
    \begin{proof}
      The first identity follows from the second by multiplying by a fractional ideal $\mf{f}$ of $\smc{O}$. As for the second identity, the forward containment is obvious. For the reverse containment, suppose $\frac{\a}{\b} \in \bigcap_{\text{$\mf{p}$ nonzero prime}}\smc{O}_{\mf{p}}$ and set
      \[
        \mf{a} = \{\g \in \smc{O}:\a\g \in \b\smc{O}\}.
      \]
      Then $\mf{a}$ is clearly an ideal of $\smc{O}$ with $\b \in \mf{a}$. It also cannot be contained in any nonzero prime ideal $\mf{p}$. Indeed, since $\frac{\a}{\b} \in \smc{O}_{\mf{p}}$ we have $\b \notin \mf{p}$ and so $\b \in \mf{a}-\mf{p}$. As $\smc{O}$ is noetherian (which we recall is equivalent to every nonempty collection of ideals having a maximal element), there exists a maximal and necessarily prime ideal $\mf{m}$. As $\mf{a}$ is not contained in any nonzero prime ideal $\mf{p}$, we see that $\mf{a}$ is not contained in $\mf{m}$ and thus $\mf{a} = \smc{O}$. But then $1 \in \mf{a}$ and so $\a \in \b\smc{O}$ implying $\frac{\a}{\b} \in \smc{O}$ which proves the reverse containment and the second identity follows. For the third identity, the forward containment is clear. For the reverse containment, suppose $\frac{\a}{\b} \in \bigcap_{\text{$\mf{p}$ nonzero prime}}\smc{O}_{\mf{p}}^{\ast}$. We already have showed $\frac{\a}{\b} \in smc{O}$ so it suffices to show $\frac{\a}{\b}$ is a unit. As $\b \notin \mf{p}$ for any nonzero prime ideal $\mf{p}$, it is necessarily not in any maximal ideal. Therefore $\b \in \smc{O}^{\ast}$ because the complement of the union of all maximal ideals in a ring is exactly the set of units. Interchanging the roles of $\a$ and $\b$ shows that $\a \in \smc{O}^{\ast}$ as well. Hence $\frac{\a}{\b} \in \smc{O}^{\ast}$ which proves the reverse containment and the third equality follows.
    \end{proof}

    A ring is said to be \textbf{local}\index{local} if it has a unique maximal ideal. As we might expect, localizing at a prime ideal will produce a local ring and hence justifies the term localization. For the localization $\smc{O}_{\mf{p}}$ of $\smc{O}$ at $\mf{p}$, set $\mf{m}_{\mf{p}} = \mf{p}\smc{O}_{\mf{p}}$. Then $\smc{O}_{\mf{p}}$ is a local ring with maximal ideal $\mf{m}_{\mf{p}}$. Indeed, it is clear that $\mf{m}_{\mf{p}}$ is an ideal of $\smc{O}_{\mf{p}}$. By \cref{prop:localization_prime_bijection}, the map
    \[
      \mf{q} \to \mf{q}\smc{O}_{\mf{p}},
    \]
    is a bijection between the set of prime ideals of $\smc{O}$ contained in $\mf{p}$ and the prime ideals of $\smc{O}_{\mf{p}}$. As maximal ideals are necessarily prime, $\mf{m}_{\mf{p}}$ is the unique maximal ideal of $\smc{O}_{\mf{p}}$. This implies
    \[
      \smc{O}_{\mf{p}}^{\ast} = \smc{O}_{\mf{p}}-\mf{m}_{\mf{p}},
    \]
    because the complement of the union of all maximal ideals in a ring is exactly the set of units and $\mf{m}_{\mf{p}}$ is the only maximal ideal. It follows that $\smc{O}_{\mf{p}}^{\ast}+\mf{m}_{\mf{p}} = \smc{O}_{\mf{p}}^{\ast}$. Indeed, the the reverse containment is trivial and the forward containment follows since otherwise $\smc{O}_{\mf{p}}^{\ast}+\mf{m}_{\mf{p}} \subseteq \mf{m}_{\mf{p}}$ which would imply $\smc{O}_{\mf{p}}^{\ast} \subseteq \mf{m}_{\mf{p}}$ and this is impossible because $\mf{m}_{\mf{p}}$ is maximal (and hence a proper ideal). In other words, the sum of a unit of $\smc{O}_{\mf{p}}$ and an element of $\mf{m}_{\mf{p}}$ is a unit of $\smc{O}_{\mf{p}}$. Also, if $\mf{p}$ itself is maximal we can say more:

    \begin{proposition}\label{prop:localization_at_prime_is_local}
      Let $\smc{O}$ be an integral domain and $\mf{p}$ be a prime ideal. Then there is an embedding
      \[
        \smc{O}/\mf{p} \to \smc{O}_{\mf{p}}/\mf{m}_{\mf{p}},
      \]
      identifying $\smc{O}_{\mf{p}}/\mf{m}_{\mf{p}}$ with the field of fractions of $\smc{O}/\mf{p}$. In particular, if $\mf{p}$ is maximal we have
      \[
        \smc{O}/\mf{p}^{n} \cong \smc{O}_{\mf{p}}/\mf{m}_{\mf{p}}^{n},
      \]
      for all $n \ge 1$.
    \end{proposition}
    \begin{proof}
      Let $n \ge 1$ and consider the homomorphism
      \[
        \phi:\smc{O}/\mf{p}^{n} \to \smc{O}_{\mf{p}}/\mf{m}_{\mf{p}}^{n} \qquad \a \tmod{\mf{p}^{n}} \mapsto \a \tmod{\mf{m}_{\mf{p}}^{n}}.
      \]
      By \cref{prop:localization_prime_bijection}, $\mf{p} = \mf{m}_{\mf{p}} \cap \smc{O}$ and therefore this map is an embedding when $n = 1$. As $\mf{m}_{\mf{p}}$ is maximal, $\smc{O}_{\mf{p}}/\mf{m}_{\mf{p}}$ is a field and thus must be the field of fractions of $\smc{O}/\mf{p}$ under this embedding. It remains to prove the last statement so suppose $\mf{p}$ is maximal. We will show $\phi$ is both injective and surjective which will finish the proof. For injectivity, it suffices to prove $\ker\phi = 0$. So let $\a \in \smc{O}$ be a representative of a class in $\smc{O}/\mf{p}$ such that such that $\a \in \mf{m}_{\mf{p}}^{n}$. Then $\a = \frac{\b}{\d}$ with $\b \in \mf{p}^{n}$ and $\d \notin \mf{p}$. Thus $\b$ is a representative of the zero class in $\smc{O}/\mf{p}^{n}$ and so $\a$ must be too which implies $\ker\phi = 0$ and injectivity follows. For surjectivity, we first claim that the image of every $\d \in \smc{O}-\mf{p}$ is a unit in $\smc{O}/\mf{p}^{n}$ which equivalent to the fact that $\mf{p}^{n}+\d\smc{O} = \smc{O}$ since there is then a $\g \in \smc{O}$ such that $\d-\g \in \mf{p}^{n}$. For $n = 1$, maximality of $\mf{p}$ implies $\mf{p}+\d\smc{O} = \smc{O}$. We now argue by induction, so suppose the claim holds for $\smc{O}/\mf{p}^{n-1}$. Then $\mf{p}^{n-1}+\d\smc{O} = \smc{O}$ whence $\mf{p}^{n}+\d\mf{p} = \mf{p}$ and therefore $\mf{p}^{n}+\d\mc{O} = \mc{O}$ by the primality of $\mf{p}$. Now let $\frac{\a}{\d} \in \smc{O}_{\mf{p}}$ be a representative of a class in $\smc{O}_{\mf{p}}/\mf{m}_{\mf{p}}^{n}$. As $\d \notin \mf{p}$, what we have just proved shows that the represented by $\d$ in $\smc{O}/\mf{p}^{n}$ is invertible. Hence $\frac{\a}{\d}$ represents a class in $\smc{O}/\mf{p^{n}}$ which proves surjectivity.
    \end{proof}
    
    We now turn to a particularly simple instance of local rings. A \textbf{discrete valuation ring}\index{discrete valuation ring} is a principal ideal domain with a unique maximal ideal. In other words, a discrete valuation ring is a local principal ideal domain and is a particularly simple example of a local ring. If $\smc{O}$ is a discrete valuation ring and $\mf{p}$ is its maximal ideal, then $\mf{p}$ is of the form $\mf{p} = \pi\smc{O}$ for some prime $\pi \in \smc{O}$. We call $\pi$ a \textbf{uniformizer}\index{uniformizer} of $\smc{O}$ and it is uniquely defined up to multiplication by units of $\smc{O}$. As every element not in $\mf{p}$ is a unit (since $\smc{O}$ is a local ring) and $\smc{O}$ is a unique factorization domain (because it is a principal ideal domain), it follows that every $\a \in \smc{O}$ is of the form $\a = \e\pi^{n}$ for some $\e \in \smc{O}^{\ast}$ and $n \ge 0$. In particular, $\pi$ is the only prime of $\smc{O}$ up to multiplication by units and every proper ideal of $\smc{O}$ is of the form $\mf{p}^{n}$ for some $n \ge 1$. As $\smc{O}$ is a principal ideal domain, it follows that $\mf{p}$ is also the only nonzero prime ideal of $\smc{O}$. Thus $\mf{p}$ is the unique maximal ideal and the unique nonzero prime ideal of $\smc{O}$. Moreover, if $K$ is the field of fractions of $\smc{O}$ then every nonzero $\k \in K$ can be uniquely expressed as
    \[
      \k = \e\pi^{n},
    \]
    for some $\e \in \smc{O}^{\ast}$ and $n \in \Z$. The \textbf{valuation}\index{valuation} $v$ associated to $\smc{O}$ on $K$ is the function defined by
    \[
      v:K \to \Z \cup \{\infty\} \qquad \k \mapsto v(\k) = \begin{cases} n & \text{if $\k = \e\pi^{n}$}, \\ \infty & \text{if $\k = 0$}. \end{cases}
    \]
    We call $v(\k)$ the \textbf{valuation}\index{valuation} of $\k$ with respect to $\smc{O}$. Note that $v(\k) = 0$ if and only if $\k$ is a unit in $\smc{O}$. If $\k \neq 0$, then the $v(\k)$ is characterized by the equation
    \begin{equation}\label{equ:valuation_characterization}
      \k\smc{O} = \mf{p}^{v(\k)},
    \end{equation}
    since $\k = \e\pi^{v(\k)}$. Moreover, if $\k = \e\pi^{n}$ and $\eta = \d\pi^{m}$, we have
    \[
      \k\eta = \e\d\pi^{n+m} \quad \text{and} \quad \k+\eta = (\e\pi^{n-\min(n,m)}+\d\pi^{m-\min(n,m)})\pi^{\min(n,m)},
    \]
    where $\e\pi^{n-\min(n,m)}+\d\pi^{m-\min(n,m)}$ is a unit of $\smc{O}$ because one of the exponents of $\pi$ is zero so this is a sum of a unit of $\smc{O}$ and an element of $\mf{p}$ (and hence a unit of $\smc{O}$ itself as we have seen). Therefore $v$ satisfies the properties
    \begin{equation}\label{equ:valuation_properties}
      v(\k\eta) = v(\k)+v(\eta) \quad \text{and} \quad v(\k+\eta) \ge \min(v(\k),v(\eta)).
    \end{equation}
    In view of the first identity in \cref{equ:valuation_properties}, $v$ restricted to $K^{\ast}$ is a surjective homomorphism. Discrete valuation rings, and hence valuation themselves, arise as as localizations of Dedekind domains. To deduce this we first need to show that the localization of a Dedekind domain is again a Dedekind domain:

    \begin{proposition}\label{prop:localization_of_Dedekind_is_Dedekind}
      Let $\smc{O}$ be a Dedekind domain and $D \subseteq \smc{O}-\{0\}$ be multiplicative. Then $\smc{O}D^{-1}$ is a Dedekind domain.
    \end{proposition}
    \begin{proof}
      Clearly $\smc{O}D^{-1}$ is an integral domain because it is a subring of $K$. To see that it is integrally closed, suppose $\k \in K$ is such that
      \[
        \k^{n}+\frac{\a_{n-1}}{\d_{n-1}}\k^{n-1}+\cdots+\frac{\a_{0}}{\d_{0}} = 0,
      \]
      for some $n \ge 1$ and $\frac{\a_{i}}{\d_{i}} \in \smc{O}D^{-1}$ for $0 \le i \le n-1$. Setting $\d = \d_{0} \cdots \d_{n-1}$ and multiplying by $\d^{n}$ shows that
      \[
        (\d\k)^{n}+\frac{\a_{n-1}\d}{\d_{n-1}}(\d\k)^{n-1}+\cdots+\frac{\a_{0}\d^{n}}{\d_{0}} = 0,
      \]
      where $\frac{\a_{i}\d^{n-i}}{\d_{i}} \in \smc{O}$ for $0 \le i \le n-1$. Hence $\d\k$ is integral over $\smc{O}$ and therefore $\d\k \in \smc{O}$ because $\smc{O}$ is Dedekind. But then $\k \in \smc{O}D^{-1}$ so that $\smc{O}D^{-1}$ is integrally closed. We now show $\smc{O}D^{-1}$ is noetherian. Let $\mf{A}$ be an ideal of $\smc{O}D^{-1}$ and set $\mf{a} = \mf{A} \cap \smc{O}$. Then $\mf{a}$ is an ideal of $\smc{O}$. We claim
      \[
        \mf{A} = \mf{a}\smc{O}D^{-1}.
      \]
      The reverse containment is trivial. For the forward containment, if $\frac{\a}{\d} \in \mf{A}$ then $\a \in \mf{a}$ because $\d \in D$ and $\mf{A}$ is an ideal of $\smc{O}D^{-1}$. Hence $\frac{\a}{\d} \in \mf{a}\smc{O}D^{-1}$ as desired. Since $\smc{O}$ is Dedekind, $\mf{a}$ is a finitely generated $\smc{O}$-module and hence $\mf{A}$ is a finitely generated $\smc{O}D^{-1}$-module by the identity we have just proved. Thus $\smc{O}D^{-1}$ is noetherian. It remains to show that every nonzero prime ideal of $\smc{O}D^{-1}$ is maximal. Let $\mf{P}$ be a nonzero prime ideal of $\smc{O}D^{-1}$ and let $\mf{p}$ be the corresponding prime ideal of $\smc{O}$ disjoint from $D$ under the inclusion-preserving bijections in \cref{prop:localization_prime_bijection}. Then
      \[
        \mf{P} = \mf{p}\smc{O}D^{-1},
      \]
      and we see that $\mf{P}$ is maximal since $\mf{p}$ is as $\smc{O}$ is a Dedekind domain.
    \end{proof}

    We can now show that localizing a Dedekind domain at a prime produces a discrete valuation ring. Actually, we will show the following stronger statement:

    \begin{theorem}\label{thm:Dedekind_if_and_only_if_all_localizations_are_discrete_valuation_rings}
      Let $\smc{O}$ be a noetherian integral domain. Then $\smc{O}$ is a Dedekind domain if and only if $\smc{O}_{\mf{p}}$ is a discrete valuation ring for all nonzero prime ideals $\mf{p}$.
    \end{theorem}
    \begin{proof}
      Let $\mf{p}$ be a nonzero prime ideal of $\smc{O}$. Then $\smc{O}_{\mf{p}}$ is a local ring and so $\mf{m}_{\mf{p}}$ is the unique maximal ideal. Now suppose $\smc{O}$ is a Dedekind domain. Then $\smc{O}_{\mf{p}}$ is as well by \cref{prop:localization_of_Dedekind_is_Dedekind}. Since primes are maximal in Dedekind domains, $\mf{m}_{\mf{p}}$ is also the only prime of $\smc{O}_{\mf{p}}$. So choosing any $\pi \in \mf{m}_{\mf{p}}-\mf{m}_{\mf{p}}^{2}$, prime factorization of fractional ideals implies that $\mf{m}_{\mf{p}} = \pi\smc{O}_{\mf{p}}$ and hence $\mf{m}_{\mf{p}}^{n} = \pi^{n}\smc{O}_{\mf{p}}$ for all $n \ge 1$. As these are the only integral ideals of $\smc{O}_{\mf{p}}$, we see that $\smc{O}_{\mf{p}}$ is a principal ideal domain and hence a discrete valuation ring. This proves the forward implication. For the reverse implication, suppose all of the localizations $\smc{O}_{\mf{p}}$ are discrete valuation rings. As the $\smc{O}_{\mf{p}}$ are discrete valuation rings, they are principal ideal domains and hence integrally closed by \cref{lemma:unique_factorization_domains_are_integrally_closed}. As the intersection of integrally closed rings is clearly integrally closed, it follows from \cref{prop:ring_is_intersection_of_all_localizations} that $\smc{O}$ is integrally closed. Hence $\smc{O}$ is an integrally closed integral domain by our assumptions. Also, $\smc{O}$ is noetherian by assumption. It remains to show that every nonzero prime ideal of $\smc{O}$ is maximal. Since $\smc{O}$ is noetherian (which we recall is equivalent to every nonempty collection of ideals having a maximal element), $\mf{p} \subseteq \mf{q}$ for some maximal and thus prime ideal $\mf{q}$. Under the inclusion-preserving bijections in \cref{prop:localization_prime_bijection}, we have
      \[
        \mf{p} = \mf{p}\smc{O}_{\mf{q}} \cap \smc{O} = \mf{m}_{\mf{q}} \cap \smc{O} = \mf{q},
      \]
      where the middle equality holds because $ \mf{p}\smc{O}_{\mf{q}} = \mf{m}_{\mf{q}}$ as $\smc{O}_{\mf{q}}$ has a unique maximal and nonzero prime ideal (as we have seen). Hence $\mf{p}$ itself must be maximal.
    \end{proof}

    \cref{prop:ring_is_intersection_of_all_localizations,thm:Dedekind_if_and_only_if_all_localizations_are_discrete_valuation_rings} together form a powerful simplification tool for Dedekind domains $\smc{O}$. For if we want to prove a property about a fractional ideal $\mf{f}$ of $\smc{O}$, \cref{prop:ring_is_intersection_of_all_localizations} implies that it suffices to show this property holds for the corresponding fractional ideals $\mf{f}\smc{O}_{\mf{p}}$ in the localizations $\smc{O}_{\mf{p}}$ at all nonzero primes $\mf{p}$ and is preserved under intersections. Moreover, by \cref{thm:Dedekind_if_and_only_if_all_localizations_are_discrete_valuation_rings} the localizations $\smc{O}_{\mf{p}}$ are discrete valuation rings and hence principal ideal domains. This latter fact is often immensely helpful. In this case, let $v_{\mf{p}}$ denote the valuation of $\smc{O}_{\mf{p}}$. Then we call $v_{\mf{p}}$ the \textbf{valuation}\index{valulation} associated to the prime $\mf{p}$ of $\smc{O}$. These valuations are intimately connected to the prime factorization of principal fractional ideals. Indeed, the prime factorization of fractional ideals implies that for any $\k \in K^{\ast}$, we have
    \[
      \k\smc{O} = \prod_{\text{$\mf{q}$ prime}}\mf{q}^{e_{\mf{q}}},
    \]
    where the product is taken over all primes $\mf{q}$ of $\smc{O}$, $e_{\mf{q}} \in \Z$ for all $\mf{q}$, and all but finitely many of the $e_{\mf{q}}$ are zero. We claim that $v_{\mf{p}}(\k) = e_{\mf{p}}$ for all primes $\mf{p}$. To see this, first observe that if $\mf{p}$ and $\mf{q}$ are distinct primes then we have $\mf{q}\smc{O}_{\mf{p}} = \smc{O}_{\mf{p}}$. Indeed, choosing $\a \in \mf{q}-\mf{p}$ forces $\a$ to be invertible in $\smc{O}_{\mf{p}}$ so that $1 \in \mf{q}\smc{O}_{\mf{p}}$ and hence the ideal $\mf{q}\smc{O}_{\mf{p}}$ must be $\smc{O}_{\mf{p}}$. This fact and the prime factorization of $\k\smc{O}$ together imply that
    \[
      \k\smc{O}_{\mf{p}} = \mf{m}_{\mf{p}}^{e_{\mf{p}}},
    \]
    and therefore $v_{\mf{p}}(\k) = e_{\mf{p}}$ by \cref{equ:valuation_characterization}. In particular, $v_{\mf{p}}(\k) = 0$ for all but finitely many primes $\mf{p}$.

    \begin{remark}
      The valuation $v_{\mf{p}}$ associated to the prime $\mf{p}$ of $\smc{O}$ is sometimes called an \textbf{exponential valuation}\index{exponential valuation}.
    \end{remark}

    Continue to let $\smc{O}$ be a Dedekind domain with field of fractions $K$ and let $X$ be a set of all but finitely many primes of $\smc{O}$. Then $\smc{O}(X)$ is a Dedekind domain by \cref{prop:localization_of_Dedekind_is_Dedekind} and by \cref{prop:localization_prime_bijection} the primes $\mf{p}_{X}$ of $\smc{O}(X)$ are of the form $\mf{p}_{X} = \mf{p}\smc{O}(X)$ for $\mf{p} \in X$. Moreover, $\smc{O}$ and $\smc{O}(X)$ have the same localizations at $\mf{p}$ and $\mf{p}_{X}$ respectively. That is,
    \begin{equation}\label{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes}
      \smc{O}_{\mf{p}} = \smc{O}(X)_{\mf{p}_{X}}.
    \end{equation}
    Indeed, observe that
     \[
      \smc{O}(X)_{\mf{p}_{X}} = \left\{\frac{\a\g}{\b\d} \in K:\text{$\a,\b,\g,\d \in \smc{O}$ with $\d \not\equiv 0 \tmod{\mf{p}}$ and $\b,\g \not\equiv 0 \tmod{\mf{p}}$ for some $\mf{p} \in X$}\right\},
     \]
     which is exactly $\smc{O}_{\mf{p}}$. From \cref{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes} and the fact that the primes $\mf{p}_{X}$ are the only primes of $\smc{O}(X)$, the prime factorization of a fractional ideal $\mf{f}\smc{O}(X)$ of $\smc{O}(X)$, for a fractional ideal $\mf{f}$ of $\smc{O}$, is obtained from that of $\mf{f}$ by removing those primes factors corresponding to primes not in $X$. Also, from \cref{prop:ring_is_intersection_of_all_localizations,equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes} we conclude that the original fractional ideal can be recovered by taking the intersection of $\mf{f}\smc{O}(X)$ with the localizations $\smc{O}_{\mf{p}}$ for all $\mf{p} \notin X$. Moreover, the ideal class and unit groups of $\smc{O}(X)$ are related to those of $\smc{O}$ via the following exact sequence:

     \begin{proposition}\label{prop:ideal_class_group_localization_exact_sequence}
      Let $\smc{O}$ be a Dedekind domain with field of fractions $K$ and let $X$ be set of all but finitely many primes of $\smc{O}$. Then the sequence

      \begin{center}
        \begin{tikzcd}[row sep=large, column sep=large]
          1 \arrow{r} & \smc{O}^{\ast} \arrow{r} & \smc{O}(X)^{\ast} \arrow{r} & \displaystyle{\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}} \arrow{r}{\displaystyle{\prod_{\mf{p} \notin X}\mf{p}^{v_{\mf{p}}}}} & \Cl(\smc{O}) \arrow{r}{\smc{O}(X)} & \Cl(\smc{O}(X)) \arrow{r} & 1,
        \end{tikzcd}
      \end{center}

      where the fourth map takes the representative $(\k_{\mf{p}})_{\mf{p} \notin X}$ of a class in $\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}$ to the class represented by $\prod_{\mf{p} \notin X}\mf{p}^{v_{\mf{p}}(\k_{\mf{p}})}$ in $\Cl(\smc{O})$ and the fifth map takes the representative $\mf{a}$ of an ideal class in $\Cl(\smc{O})$ to the ideal class represented by $\mf{a}\smc{O}(X)$ in $\Cl(\smc{O}(X))$, is exact. Moreover, $K^{\ast}/\smc{O}_{\mf{p}}^{\ast} \cong \Z$ for all primes $\mf{p}$ of $\smc{O}$.
    \end{proposition}
    \begin{proof}
      The sequence is exact at $\smc{O}^{\ast}$ because the second map is injective. For exactness at $\smc{O}(X)^{\ast}$, it is clear that the image of the second map belongs to the kernel of the third map. So suppose $\a \in \smc{O}(X)^{\ast}$ belongs to the kernel of the third map. Then $\a \in \smc{O}_{\mf{p}}^{\ast}$ for all $\mf{p} \notin X$ and for all $\mf{p} \in X$ as well by \cref{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes}. It follows from \cref{prop:ring_is_intersection_of_all_localizations} that $\a \in \smc{O}^{\ast}$ so it is in the image of the second map which proves exactness at $\smc{O}(X)^{\ast}$. For exactness at $\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}$, from \cref{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes} again we see that the image of the third map is contained in the kernel of the fourth. So suppose $(\k_{\mf{p}})_{\mf{p} \notin X}$ is a representative of a class in $\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}$ that is contained in the kernel of the fourth map. Then there is a $\k \in K^{\ast}$ such that
      \[
        \prod_{\mf{p} \notin X}\mf{p}^{v_{\mf{p}}(\k_{\mf{p}})} = \k\smc{O} = \prod_{\text{$\mf{p}$ prime}}\mf{p}^{v_{\mf{p}}(\k)}.
      \]
      By the prime factorization of fractional ideals, $v_{\mf{p}}(\k) = 0$ for all $\mf{p} \in X$ and $v_{\mf{p}}(\k) = v_{\mf{p}}(\k_{\mf{p}})$ for all $\mf{p} \notin X$. As $v_{\mf{p}}(\k) = 0$ for all $\mf{p} \in X$, we have $\k \in \smc{O}_{\mf{p}}^{\ast}$ for all $\mf{p} \in X$. Because the primes of $\smc{O}(X)$ are $\mf{p}_{X}$ for $\mf{p} \in X$, \cref{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes,prop:ring_is_intersection_of_all_localizations} together imply that $\bigcap_{\mf{p} \in X}\smc{O}_{\mf{p}}^{\ast} = \smc{O}(X)^{\ast}$ and therefore $\k \in \smc{O}(X)^{\ast}$. As $v_{\mf{p}}(\k) = v_{\mf{p}}(\k_{\mf{p}})$ for all $\mf{p} \notin X$, we have $\k \equiv \k_{\mf{p}} \tmod{\smc{O}_{\mf{p}}^{\ast}}$ for all $\mf{p} \notin X$ because they have the same power of a uniformizer for $\smc{O}_{\mf{p}}^{\ast}$. We have shown that $\k \in \smc{O}(X)^{\ast}$ and $\k \equiv \k_{\mf{p}} \tmod{\smc{O}_{\mf{p}}^{\ast}}$ for all $\mf{p} \notin X$ which means $\k$ maps to $(\k_{\mf{p}})_{\mf{p} \notin X}$ under the third map. In other words, $(\k_{\mf{p}})_{\mf{p} \notin X}$ is in the image of the third map proving exactness at $\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}$. For exactness at $\Cl(\smc{O})$, we first show that $\mf{p}\smc{O}(X) = \smc{O}(X)$ for any prime $\mf{p} \notin X$. Indeed, choosing $\a \in \mf{p}-\bigcup_{\mf{q} \in X}\mf{q}$ fores $\a$ to be invertible in $\smc{O}(X)$ so that $1 \in \mf{p}\smc{O}(X)$ and hence the ideal $\mf{p}\smc{O}(X)$ must be $\smc{O}(X)$. It follows that the image of the fourth map is contained in the kernel of the fifth. Now suppose $\mf{a}$ is an integral ideal representing a class in $\Cl(\smc{O})$ that is contained in the kernel of the fifth map. Then there is a $\k \in K^{\ast}$ such that
      \[
        \mf{a}\smc{O}(X) = \k\smc{O}(X),
      \]
      In view of \cref{equ:localizing_at_primes_for_X_is_the_same_as_localizing_at_primes,prop:ring_is_intersection_of_all_localizations} again, taking the intersection with the localizations $\smc{O}_{\mf{p}}$ for all $\mf{p} \notin X$ shows that
      \[
        \mf{a} = \k\smc{O},
      \]
      and therefore $(v_{\mf{p}}(\k))_{\mf{p} \notin X}$ is a representative of a class in $\bigoplus_{\mf{p} \notin X}K^{\ast}/\smc{O}_{\mf{p}}^{\ast}$ whose image under the fourth map is $\mf{a}$. In other words, $\mf{a}$ is in the image of the third map proving exactness at $\Cl(\smc{O})$. Lastly, to show exactness $\Cl(\smc{O}(X))$ recall that every ideal class can be represented by an integral ideal and that the primes $\mf{p}_{X}$ of $\smc{O}(X)$ are of the form $\mf{p}_{X} = \mf{p}\smc{O}(X)$ for $\mf{p} \in X$. Then the fifth map is surjective since the primes of $\smc{O}$ and $\smc{O}(X)$ generate their corresponding ideal class groups by the prime factorization of fractional ideals. Therefore exactness holds at $\Cl(\smc{O}(X))$ which completes exactness of the sequence. The last statement follows from the first isomorphism theorem since the valuation $v_{\mf{p}}$ restricted to $K^{\ast}$ is a surjective homomorphism and the kernel is precisely the set of units of $\smc{O}_{\mf{p}}$. This completes the proof.
    \end{proof}

    We now turn to the setting of a number field $K$. We let $S$ denote a finite set of primes of $\mc{O}_{K}$ and let $X$ denote the set of all primes that do not belong to $S$. The \textbf{ring of $S$-integers}\index{ring of $S$-integers} $\mc{O}_{K}^{S}$ of $K$ is defined by
    \[
      \mc{O}_{K}^{S} = \mc{O}_{K}(X).
    \]
    We call any $\a \in \mc{O}_{K}^{S}$ an \textbf{algebraic $S$-integer}\index{algebraic $S$-integer}. The \textbf{$S$-class group}\index{$S$-class group} $\Cl^{S}(K)$ of $K$ is the ideal class group of $\mc{O}_{K}^{S}$. The \textbf{$S$-class number}\index{$S$-class number} $h_{K}^{S}$ of $K$ is the class number of $\Cl^{S}(K)$. The \textbf{$S$-unit group}\index{$S$-unit group} of $K$ is the unit group $(\mc{O}_{K}^{S})^{\ast}$ of $\mc{O}_{K}^{S}$ and we call any element of $(\mc{O}_{K}^{S})^{\ast}$ an \textbf{$S$-unit}\index{$S$-unit} of $K$.
  \section{Ramification}
    Having discussed the prime factorization of fractional ideals in a Dedekind domain, we now turn to discussing how primes factor when considered in a larger Dedekind domain. Let $\smc{O}$ be a Dedekind domain with field of fractions $K$, $L/K$ be a finite separable extension, and $\mc{O}$ be the integral closure of $\smc{O}$ in $L$. We first show that $\mc{O}$ is also a Dedekind domain:

    \begin{proposition}\label{prop:integral_closure_of_Dedekind_is_Dedekind}
      Let $\smc{O}$ be a Dedekind domain with field of fractions $K$, $L/K$ be a finite separable extension, and $\mc{O}$ be the integral closure of $\smc{O}$ in $L$. Then $\mc{O}$ is a Dedekind domain.
    \end{proposition}
    \begin{proof}
      $\mc{O}$ is an integral domain because it is a subring of $L$ and is integrally closed since it is the integral closure of $\smc{O}$. We now show $\mc{O}$ is noetherian. Let the degree of $L/K$ be $n$ and let $\l_{1},\ldots,\l_{n}$ be a basis for $L/K$. By \cref{prop:field_of_fractions_AKBL} we may multiply by a nonzero element of $\smc{O}$, if necessary, to ensure that this basis lies in $\mc{O}$. Then $d_{L/K}(\l_{1},\ldots,\l_{n})$ is nonzero by \cref{prop:discriminant_not_zero} and \cref{lem:lemma_for_integral_basis_AKBL} implies that
      \[
        d_{L/K}(\l_{1},\ldots,\l_{n})\mc{O} \subseteq \smc{O}\l_{1}+\cdots+\smc{O}\l_{n}.
      \]
      Thus $\mc{O}$ is a finitely generated $\smc{O}$-module of rank at most $n$. In particular, every ideal of $\mc{O}$ is also a finitely generated $\smc{O}$-module and therefore also a finitely generated $\mc{O}$-module. It remains to show that every nonzero prime ideal is maximal. Letting $\mf{P}$ be a nonzero prime ideal, it suffices to show $\mc{O}/\mf{P}$ is a field. To this end, consider the homomorphism
      \[
        \phi:\smc{O} \to \mc{O}/\mf{P} \qquad \a \mapsto \a \tmod{\mf{p}}.
      \]
      Then $\ker\phi = \mf{P} \cap \smc{O}$ and we claim $\mf{P} \cap \smc{O}$ is a nonzero prime ideal of $\smc{O}$. It is clearly an ideal of $\smc{O}$ and is prime because $\mf{P}$ is. To see that it is nonzero, let $\a \in \mf{P}$ be nonzero. As $\a$ is algebraic over $\smc{O}$, we have
      \[
        \a^{n}+a_{n-1}\a^{n-1}+\cdots+a_{0} = 0,
      \]
      for some $n \ge 1$ and $a_{i} \in \smc{O}$ for $0 \le i \le n-1$. Taking $n$ minimal, we have $a_{0} \neq 0$. Isolating $a_{0}$ shows that $a_{0} \in \mf{P}$ and hence $a_{0} \in \mf{P} \cap \smc{O}$. Therefore $\mf{P} \cap \smc{O} = \mf{p}$ for some prime $\mf{p}$. Hence $\ker\phi = \mf{p}$ and by the first isomorphism theorem, $\phi$ induces an injection $\phi:\smc{O}/\mf{p} \to \mc{O}/\mf{P}$. Since $\smc{O}$ is a Dedekind domain, $\mf{p}$ is maximal and thus $\smc{O}/\mf{p}$ is a field. As $\mc{O}$ is the integral closure of $\smc{O}$ in $L$, it is obtained from $\smc{O}$ by forming a polynomial ring with algebraic elements. The latter injection then shows that $\mc{O}/\mf{P}$ is obtained from $\smc{O}/\mf{p}$ by adjoining the images of these algebraic elements modulo $\mf{P}$. These images are still algebraic over $\smc{O}/\mf{p}$ by reducing their minimal polynomials modulo $\mf{P}$. Hence $\mc{O}/\mf{P}$ is obtained from $\smc{O}/\mf{p}$ by adjoining algebraic elements to $\smc{O}/\mf{p}$ (since $(\smc{O}/\mf{p})[\a] = (\smc{O}/\mf{p})(\a)$ if $\a$ is algebraic over $\smc{O}/\mf{p}$) and is therefore a field.
    \end{proof}

    Under the assumptions of \cref{prop:integral_closure_of_Dedekind_is_Dedekind}, it follows from \cref{prop:field_of_fractions_AKBL} that $L$ is the field of fractions of $\mc{O}$. For brevity, we write $\mc{O}/\smc{O}$ and say that this is a \textbf{Dedekind extension}\index{Dedekind extension} for a finite separable extension $L/K$ if $\mc{O}$ and $\smc{O}$ are Dedekind domains whose field of fractions are $L$ and $K$ respectively and $\mc{O}$ is the integral closure of $\smc{O}$ in $L$. We also say that $\mc{O}/\smc{O}$ admits an \textbf{integral basis}\index{integral basis} if $\mc{O}$ admits an integral basis over $\smc{O}$. Moreover, \cref{prop:localization_of_integral_closure_is_integral_closure,prop:localization_of_Dedekind_is_Dedekind} together show $\mc{O}D^{-1}/\smc{O}D^{-1}$ is a Dedekind extension of $L/K$ as well for any multiplicative set $D \subseteq \smc{O}-\{0\}$. With this phrasing, the proof of \cref{prop:integral_closure_of_Dedekind_is_Dedekind} gives the following corollary:

    \begin{corollary}\label{cor:integral_closure_of_Dedekind_is_Dedekind}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$. Then $\mc{O}$ is a finitely generated $\smc{O}$-module of rank at most $n$ and every prime $\mf{P}$ of $\mc{O}$ satisfies
      \[
        \mf{P} \cap \smc{O} = \mf{p},
      \]
      for some prime $\mf{p}$ of $\smc{O}$. Moreover, $(\mc{O}/\mf{P})/(\smc{O}/\mf{p})$ is a finite extension of degree at most $n$.
    \end{corollary}
    \begin{proof}
      The first statement was deduced in the proof of \cref{prop:integral_closure_of_Dedekind_is_Dedekind} along with the fact that there is an injection of fields $\smc{O}/\mf{p} \to \mc{O}/\mf{P}$. From this injection it follows that $(\mc{O}/\mf{P})/(\smc{O}/\mf{p})$ is an extension and since $\mc{O}$ is a finitely generated $\smc{O}$-module of rank at most $n$, $(\mc{O}/\mf{P})/(\smc{O}/\mf{p})$ is at most $n$ dimensional.
    \end{proof}

    Continue to let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$. Let $\mf{P}$ and $\mf{p}$ be primes of $L$ and $K$ respectively. We say that $\mf{P}$ is \textbf{above}\index{above} $\mf{p}$, or equivalently, $\mf{p}$ is \textbf{below}\index{below} $\mf{P}$ if
    \[
      \mf{P} \cap \mc{O} = \mf{p}.
    \]
    Then \cref{cor:integral_closure_of_Dedekind_is_Dedekind} implies that every prime of $L$ is above exactly one prime of $K$. If $\mf{P}$ is above $\mf{p}$, then $\mf{P} \mid \mf{p}\mc{O}$. Indeed, since $\mf{p} \subseteq \mf{P}$ we have $\mf{p}\mc{O} \subseteq \mf{P}$ which is to say that $\mf{P}$ divides $\mf{p}\mc{O}$. This implies that only finitely many primes $\mf{P}$ can lie above a prime $\mf{p}$ and they are exactly the prime factors of $\mf{p}\mc{O}$. We illustrated the relationship via the extension

    \begin{center}
      \begin{tikzcd}[row sep=large, column sep=large]
        \mf{P} \subset \mc{O} \subset L \arrow[dash]{d} \\
        \mf{p} \subset \smc{O} \subset K.
      \end{tikzcd}
    \end{center}

    As primes $\mf{P}$ and $\mf{p}$ are maximal in the Dedekind domains $\mc{O}$ and $\smc{O}$ respectively, we have the residue class fields $\mc{O}/\mf{P}$ and $\smc{O}/\mf{p}$. The former is a finite extension of the latter of degree at most $n$ by \cref{cor:integral_closure_of_Dedekind_is_Dedekind}. Accordingly, we call $(\mc{O}/\mf{P})/(\smc{O}/\mf{p})$ the \textbf{residue class extension}\index{residue class extension} of $\mf{P}$. Actually since \cref{cor:integral_closure_of_Dedekind_is_Dedekind} implies $\mc{O}$ is at finitely generated $\smc{O}$-module of rank at most $n$, the quotient ring $\mf{B}/\mf{A}$ is a vector space over $\smc{O}/\mf{p}$ of dimension at most $n$ for any integral ideals $\mf{A}$ and $\mf{B}$ with $\mf{p} \subseteq \mf{A} \subseteq \mf{B}$. In any case, we define the \textbf{inertia degree}\index{inertia degree} $f_{\mf{p}}(\mf{P})$ of $\mf{P}$ relative to $\mf{p}$ by
    \[
      f_{\mf{p}}(\mf{P}) = [\mc{O}/\mf{P}:\smc{O}/\mf{p}].
    \]
    That is, $f_{\mf{p}}(\mf{P})$ is the dimension of the residue field $\mc{O}/\mf{P}$ as a vector space over $\smc{O}/\mf{p}$. The \textbf{ramification index}\index{ramification index} $e_{\mf{p}}(\mf{P})$ is the power of $\mf{P}$ appearing in the prime factorization of $\mf{p}\mc{O}$. So if $\mf{p}\mc{O}$ has prime factors $\mf{P}_{1},\ldots,\mf{P}_{r}$, then the prime factorization of $\mf{p}\mc{O}$ is
    \[
      \mf{p}\mc{O} = \mf{P}_{1}^{e_{\mf{p}}(\mf{P}_{1})} \cdots \mf{P}_{r}^{e_{\mf{p}}(\mf{P}_{r})}.
    \]
    The inertia degrees and ramification indices are related via the following result:

    \begin{theorem}\label{prop:inertia_ramification_relation}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$. Suppose $\mf{p}$ is a prime of $K$ and $\mf{p}\mc{O}$ has prime factorization
      \[
        \mf{p}\mc{O} = \mf{P}_{1}^{e_{\mf{p}}(\mf{P}_{1})} \cdots \mf{P}_{r}^{e_{\mf{p}}(\mf{P}_{r})}.
      \]
      Then
      \[
        n = \sum_{1 \le i \le r}e_{\mf{p}}(\mf{P}_{i})f_{\mf{p}}(\mf{P}_{i}).
      \]
    \end{theorem}
    \begin{proof}
      Since distinct primes are relatively prime, the Chinese remainder theorem implies that
      \[
        \mc{O}/\mf{p}\mc{O} \cong \bigoplus_{1 \le i \le r} \mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}.
      \]
      As $\mc{O}/\mf{p}\mc{O}$ and $\mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}$ are vector spaces over $\smc{O}/\mf{p}$ for all $i$, it suffices to show $\mc{O}/\mf{P}$ is of dimension $n$ and $\mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}$ is of dimension $e_{\mf{p}}(\mf{P}_{i})f_{\mf{p}}(\mf{P}_{i})$ for all $i$. For $\mc{O}/\mf{p}\mc{O}$, we already know it is a vector space over $\smc{O}/\mf{p}$ of dimension at most $n$ (since $\mc{O}$ is a finitely generated $\smc{O}$-module of rank at most $n$ by \cref{cor:integral_closure_of_Dedekind_is_Dedekind} and $\mf{p} \subseteq \mf{p}\mc{O}$). Therefore we must show that the dimension is exactly $n$. Let $\conj{\l_{1}},\ldots,\conj{\l_{m}}$ be a basis for $\mc{O}/\mf{p}\mc{O}$ as a vector space over $\smc{O}/\mf{p}$ and let $\l_{1},\ldots,\l_{m}$ be any lift of this basis to $\mc{O}$. As $m \le n$, it suffices to show $\l_{1},\ldots,\l_{m}$ spans $L/K$ and hence $m = n$. Let $M = \l_{1}\smc{O}+\cdots+\l_{m}\smc{O}$ and set $N = \mc{O}/M$. Then $\mc{O} = M+\mf{p}\mc{O}$ since $\l_{1},\ldots,\l_{m}$ is a lift a basis for $(\mc{O}/\mf{p}\mc{O})/(\smc{O}/\mf{p})$, and hence $N = \mf{p}N$. As $\mc{O}$ is a finitely generated $\smc{O}$-module of rank at most $n$ by \cref{cor:integral_closure_of_Dedekind_is_Dedekind}, so is $N$. So let $\w_{1},\ldots,\w_{r}$ be generators. As $N = \mf{p}N$, we have
      \[
        \w_{i} = \sum_{1 \le j \le r}\a_{i,j}\w_{j},
      \]
      for some $\a_{i,j} \in \mf{p}$ for $1 \le i,j \le r$. These $r$ equations are equivalent to the identity
      \[
        ((\a_{i,j})_{i,j}-I)(\w_{1},\ldots,\w_{r})^{t} = \mathbf{0}.
      \]
      Let $d = \det((\a_{i,j})_{i,j}-I)$. Then $d \neq 0$ because expanding the determinant shows $d \equiv (-1)^{r} \tmod{\mf{p}}$ as $\a_{i,j} \in \mf{p}$ for all $i$ and $j$. Multiplying on the left by the adjugate of $(\a_{i,j})_{i,j}-I$ and recalling that a matrix times its adjugate is its determinant times the identity, we obtain
      \[
        d(\w_{1},\ldots,\w_{r})^{t} = \mathbf{0}.
      \]
      Hence multiplication by $d$ annihilates $N$ which is to say that $d\mc{O} \subseteq M$. Equivalently,
      \[
        d\mc{O} \subseteq \l_{1}\smc{O}+\cdots+\l_{m}\smc{O}.
      \]
      By \cref{prop:field_of_fractions_AKBL} and that $d \neq 0$, multiplication by $K$ shows $L = \l_{1}K+\cdots+\l_{m}K$ (as the reverse containment is trivial). Hence $\l_{1},\ldots,\l_{m}$ spans $L/K$ so that $m = n$ and $\mc{O}/\mf{p}\mc{O}$ is an $n$ dimensional vector space over $\smc{O}/\mf{p}$ is $n$. For $\mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}$, consider the descending chain
      \[
        \mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})} \supseteq \mf{P}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})} \supseteq \cdots \supseteq \mf{P}^{e_{\mf{p}}(\mf{P}_{i})-1}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})},
      \]
      of vector spaces over $\smc{O}/\mf{p}$. The dimension of $\mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}$ as a vector space over $\smc{O}/\mf{p}$ is the sum of the dimensions of the successive quotients in this chain. By the third isomorphism theorem, these quotients are of the form $\mf{P}_{i}^{e}/\mf{P}_{i}^{e+1}$ for $0 \le e \le e_{\mf{p}}(\mf{P}_{i})-1$ and are all isomorphic to $\mc{O}/\mf{P}_{i}$ by \cref{prop:isomorphism_of_quotient_by_prime_integral_ideals}. As the dimension of $\mc{O}/\mf{P}_{i}$ over $\smc{O}/\mf{p}$ is $f_{\mf{p}}(\mf{P}_{i})$ by definition, it follows that $\mc{O}/\mf{P}_{i}^{e_{\mf{p}}(\mf{P}_{i})}$ is an $e_{\mf{p}}(\mf{P}_{i})f_{\mf{p}}(\mf{P}_{i})$ dimensional vector space over $\smc{O}/\mf{p}$. Together with the chinese remainder theorem, our dimension computations combine to give
      \[
        n = \sum_{1 \le i \le r}e_{\mf{p}}(\mf{P}_{i})f_{\mf{p}}(\mf{P}_{i}).
      \]
    \end{proof}

    We also classify primes according to extremal cases of \cref{prop:inertia_ramification_relation}. We say $\mf{p}$ is \textbf{inert}\index{inert} if $r = 1$ so that there is a single prime $\mf{P}$ above $\mf{p}$ and we have $e_{\mf{p}}(\mf{P}) = 1$ and $f_{\mf{p}}(\mf{P}) = n$ by \cref{prop:inertia_ramification_relation}. Then
    \[
      \mf{p}\mc{O} = \mf{P},
    \]
    which means $\mf{p}\mc{O}$ is prime. We say $\mf{p}$ is \textbf{totally split}\index{totally split} if $r = n$ so that there are primes $\mf{P}_{i}$ above $\mf{p}$ with $e_{\mf{p}}(\mf{P}_{i}) = f_{\mf{p}}(\mf{P}_{i}) = 1$ for $1 \le i \le n$ by \cref{prop:inertia_ramification_relation}. Hence
    \[
      \mf{p}\mc{O} = \mf{P}_{1} \cdots \mf{P}_{n}.
    \]
    In terms of the inertia degrees, being inert or totally split are antithetical properties. In particular, the smaller the inertia degrees are the greater the tendency for $\mf{p}\mc{O}$ to factor into distinct primes. Now let us introduce ramification. If $\mf{P}$ is a prime of $L$ above $\mf{p}$, we say that $\mf{P}$ is \textbf{unramified}\index{unramified} if $e_{\mf{p}}(\mf{P}) = 1$ and the residue class extension $(\mc{O}/\mf{P})/(\smc{O}/\mf{p})$ is separable. Otherwise, we say $\mf{P}$ is \textbf{ramified}\index{ramified} or \textbf{totally ramified}\index{totally ramified} if in addition to being ramified we have $f_{\mf{p}}(\mf{P}) = 1$. Similarly, we say that a prime $\mf{p}$ of $K$ is \textbf{unramified}\index{unramified} if every prime $\mf{P}$ above it is unramified and is \textbf{ramified}\index{ramified} otherwise. The extension $L/K$ itself is said to be \textbf{unramified}\index{unramified} if every prime of $K$ is unramified and is said to be \textbf{ramified}\index{ramified} otherwise.

    \begin{remark}
      We will see that it is an exceptional phenomena for a prime $\mf{p}$ of $K$ to ramify in $K/L$. Therefore it is typical that $\mf{p}$ is either inert or totally split.
    \end{remark}

    In the case of a number field $K$, every prime $\mf{p}$ of $K$ is above some prime $p$ (recall $\Z$ is a principal ideal domain so we are referring to primes by their generator). Then the residue class extension of $\mf{p}$ is $(\mc{O}_{K}/\mf{p})/\F_{p}$. Also, we write $f_{p}(\mf{p})$ and $e_{p}(\mf{p})$ for the inertia degree and ramification index of $\mf{p}$ relative to $p$ respectively. Moreover, all of the residue class extensions are separable since $\F_{p}$ is a perfect field. This implies that $\mf{p}$ is ramified if and only if $e_{p}(\mf{p}) = 1$.
  \section{\todo{The Ideal Norm}}
    Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ extension $L/K$. If $\mf{P}$ a prime of $L$ is above the prime $\mf{p}$ of $K$, we define the \textbf{norm}\index{norm} $\mf{N}_{\mc{O}/\smc{O}}(\mf{P})$ of $\mf{P}$ by
    \[
      \mf{N}_{\mc{O}/\smc{O}}(\mf{P}) = \mf{p}^{f_{\mf{p}}(\mf{P})}.
    \]
    Setting $\mf{N}_{\mc{O}/\smc{O}}(\mc{O}) = \smc{O}$, we extend this multiplicatively to all fractional ideals of $\mc{O}$. This induces a homomorphism
    \[
      \mf{N}_{\mc{O}/\smc{O}}:I_{\mc{O}} \to I_{\smc{O}} \qquad \mf{P}_{1}^{e_{1}} \cdots \mf{P}_{r}^{e_{r}} \mapsto \mf{p}_{1}^{e_{1}f_{\mf{p}_{1}}(\mf{P}_{1})} \cdots \mf{p}_{r}^{e_{r}f_{\mf{p}_{r}}(\mf{P}_{r})},
    \]
    called the \textbf{ideal norm}\index{ideal norm} of $\mc{O}/\smc{O}$. If $\mf{P}_{1},\ldots,\mf{P}_{r}$ are the primes above $\mf{p}$, then it follows form \cref{prop:inertia_ramification_relation} that
    \[
      \mf{N}_{\mc{O}/\smc{O}}(\mf{p}\mc{O}) = \mf{p}^{n}.
    \]
    \todo{xxx}

    In the case of a number field $K$, the \textbf{ideal norm}\index{ideal norm} $\mf{N}_{K}$ of $K$ is the ideal norm of $\mc{O}_{K}/\Z$. As $\Z$ is a principal ideal domain, every fractional ideal is principal. Therefore $\mf{N}_{K}(\mf{f})$ is generated by a nonzero rational for every fractional ideal $\mf{f}$ of $\mc{O}_{K}$. We define the \textbf{norm}\index{norm} $N_{K}(\mf{a})$ of an integral ideal $\mf{a}$ of $K$ by \todo{xxx} 

    \todo{xxx}

    Lastly, let $a_{K}(m)$ denote the number of integral ideals of norm $m$. Because the ideal norm is multiplicative so is $a_{K}(m)$. Moreover, we have the following result:

    \begin{proposition}\label{equ:ideals_of_fixed_norm_bound}
      Let $K$ be a number field of degree $n$. Then $a_{K}(m) \le \s_{0}(m)^{n}$.
    \end{proposition}
    \begin{proof}
      Let $\mf{a}$ be an integral ideal of norm $m$. First suppose $m = p^{k}$ for some prime $p$ and $k \ge 0$. As there are at most $n$ prime integral ideals $\mf{p}_{1},\ldots,\mf{p}_{n}$ above $p$ with inertia degrees $f_{p}(\mf{p}_{1}),\ldots,f_{p}(\mf{p}_{1})$ respectively, we have
      \[
        \Norm_{K}(\mf{a}) = p^{e_{1}f_{p}(\mf{p}_{1})} \cdots p^{e_{n}f_{p}(\mf{p}_{n})},
      \]
      for some integers $0 \le e_{i} \le k$ for $1 \le i \le n$. Therefore the number of possibilities is equivalent to the number of solutions
      \[
        e_{1}f_{p}(\mf{p}_{1})+\cdots+e_{n}f_{\mf{p}_{n}} = k,
      \]
      which is at most $\s_{0}(p^{k})^{n} = (k+1)^{n}$. This proves the claim in the case $m$ is a prime power. By multiplicativity of $a_{K}(m)$ and the divisor function, it follows that the number of integral ideals of norm $m$ is at most $\s_{0}(m)^{n}$ as desired.
    \end{proof}

    As a consequence of \cref{prop:sum_of_divisors_growth_rate}, we have the slightly weaker estimate $a_{K}(n) \ll_{\e} n^{\e}$.
  \section{\todo{The Different \& Discriminant}}
    Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$. It is exceptionally rare for a prime $\mf{p}$ of $K$ to ramify. We will construct two integral ideals, one of $\mc{O}$ and the other of $\smc{O}$ which will tell us which primes ramify in $L$ or $K$. These integral ideals are the different and discriminant respectively. To describe them, we will need the concept of lattices in Dedekind domains. We say that $\mf{L}$ is a \textbf{$\smc{O}$-lattice}\index{$\smc{O}$-lattice} if it is a finitely generated $\smc{O}$-submodule of $L$. Moreover, we say that $\mf{L}$ is \textbf{complete}\index{complete} if it spans $L/K$. That is, $\mf{L}$ contains a basis of $L/K$.

    \begin{remark}
      In the case $\smc{O} = \Z$, a $\Z$-lattice is an integral lattice and a complete $\Z$-lattice is a complete integral lattice.
    \end{remark}

    A $\smc{O}$-lattice $\mf{L}$ need not be a fractional ideal of $\smc{O}$ since it does not need to be a $\mc{O}$-submodule of $L$. However, every fractional ideal $\mf{F}$ of $\mc{O}$ is a complete $\smc{O}$-lattice. Indeed, by \cref{cor:integral_closure_of_Dedekind_is_Dedekind} $\mc{O}$ is a finitely generated $\smc{O}$-module and so $\mf{F}$ is a finitely generated $\smc{O}$-module as well. Moreover, $\mf{F}$ contains a basis of $L/K$. For if $\l_{1},\ldots,\l_{n}$ is a basis for $L/K$ we may use \cref{prop:field_of_fractions_AKBL} to multiply by a nonzero element of $\smc{O}$, if necessary, to ensure that this basis lies in $\mc{O}$. Choosing any nonzero $\a \in \mf{F}$, $\a\l_{1},\ldots,\a\l_{n}$ is a basis for $L/K$ inside $\mf{F}$.

    \begin{remark}
      A $\smc{O}$-lattice $\mc{L}$ need not be a free $\smc{O}$-submodule of $L$. Indeed, we are only guaranteed that $\mc{L}$ is a finitely generated $\smc{O}$-submodule of $L$ not that it be a free finitely generated $\smc{O}$-submodule of $L$.
    \end{remark}
    
    Recall by \cref{lem:trace_is_nondegenerate} that there is a nondegenerate symmetric bilinear form on $K$ given by
    \[
      \Trace_{L/K}:L \x L \to K \qquad (\l,\eta) \mapsto \Trace_{L/K}(\l\eta).
    \]
    We call this bilinear form the \textbf{trace form}\index{trace form} of $L/K$. The trace form makes $L$ into a nondegenerate inner product space over $K$ and so every basis $\l_{1},\ldots,\l_{n}$ admits a dual basis $\l_{1}^{\vee},\ldots,\l_{n}^{\vee}$ with respect to $\Trace_{L/K}$ defined by
    \[
      \Trace_{L/K}(\l_{i}\l_{j}^{\vee}) = \d_{i,j},
    \]
    for $1 \le i,j \le n$. The trace form will allow us to introduce duals. Indeed, if $\mf{F}$ is a fractional ideal $\mc{O}$, the \textbf{dual}\index{dual} $\mf{F}^{\vee}$ of $\mf{F}$ is defined by
    \[
      \mf{F}^{\vee} = \{\l \in L:\Trace_{L/K}(\l\mf{F}) \subseteq \smc{O}\}.
    \]
    The following proposition shows that the dual $\mf{F}^{\vee}$ is indeed a fractional ideal:

    \begin{proposition}\label{prop:dual_lattice_is_fractional}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and let $\mf{F}$ be a fractional ideal of $\mc{O}$. Then $\mf{F}^{\vee}$ is also a fractional ideal of $\mc{O}$ and
      \[
        \mf{F}^{\vee} = \mf{F}^{-1}\mc{O}^{\vee}.
      \]
    \end{proposition}
    \begin{proof}
      We will first show that $\mf{F}^{\vee}$ is a finitely generated $\smc{O}$-submodule of $L$. Let $\l_{1},\ldots,\l_{n}$ be a basis for $L/K$. Using \cref{prop:field_of_fractions_AKBL} to multiply by a nonzero element of $\smc{O}$, if necessary, we can ensure that this basis lies in $\mc{O}$. Now choose some nonzero $\a \in \mf{F} \cap \smc{O}$ (such an element exists since every prime $\mf{P}$ of $\mc{O}$ lies over a prime $\mf{p}$ of $\smc{O}$ and $\mf{F}$ is of the form $\mf{F} = \frac{1}{\d}\mf{A}$ for some nonzero $\d \in \mc{O}$ and integral ideal $\mf{A}$ so that $\mf{A} \subseteq \mf{F}$). Now suppose $\l \in \mf{F}^{\vee}$ and write $\l = \k_{1}\l_{1}+\cdots+\k_{n}\l_{n}$ with $\k_{i} \in K$ for $1 \le i \le n$. Then linearity of the trace implies
      \[
        \sum_{1 \le j \le n}\a\k_{j}\Trace_{L/K}(\l_{i}\l_{j}) = \Trace_{L/K}(\a\l_{i}\l),
      \]
      for $1 \le i \le n$. These $n$ equations are equivalent to the identity
      \[
        (\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}(\a\k_{1},\ldots,\a\k_{n})^{t} = (\Trace_{L/K}(\a\l_{1}\l),\ldots,\Trace_{L/K}(\a\l_{n}\l))^{t}.
      \]
      Multiplying on the left by the adjugate of $(\Trace_{L/K}(\l_{i}\l_{j}))_{i,j}$ and recalling that a matrix times its adjugate is its determinant times the identity, we see that
      \[
        \a\k_{i} = \frac{\Trace_{L/K}(\a\l_{i}\l)}{d_{L/K}(\l_{1},\ldots,\l_{n})},
      \]
      for all $i$ since $d_{L/K}(\l_{1},\ldots,\l_{n})$ is nonzero by \cref{prop:discriminant_not_zero}. As $\a\l_{i} \in \mf{F}$ (because $\l_{j} \in \mc{O}$ for all $j$) and $\l \in \mf{F}^{\vee}$, $\Trace_{L/K}(\a\l_{i}\l) \in \smc{O}$ for all $i$. Since $\l \in \mf{F}^{\vee}$ was arbitrary, it follows that
      \[
        \a d_{L/K}(\l_{1},\ldots,\l_{n})\mf{F}^{\vee} \subseteq \mc{O}.
      \]
      As $\mc{O}$ is a finitely generated $\smc{O}$-module by \cref{cor:integral_closure_of_Dedekind_is_Dedekind}, it follows that $\mf{F}^{\vee}$ is a finitely generated $\smc{O}$-submodule of $L$. Therefore $\mf{F}^{\vee}$ is also a finitely generated $\mc{O}$-submodule of $L$ if it is preserved under multiplication by $\mc{O}$. Let $\a \in \mc{O}$ and $\b \in \mf{F}^{\vee}$. Then we must show $\a\b \in \mf{F}^{\vee}$. To see this, observe that $\Trace_{L/K}(\a\b\mf{F}) \subseteq \Trace_{L/K}(\b\mf{F}) \subseteq \smc{O}$ by \cref{prop:norm_and_trace_AKBL} since $\a\mf{F} \subseteq \mf{F}$ and $\b \in \mf{F}^{\vee}$. Therefore $\a\b \in \mf{F}^{\vee}$ and hence $\mf{F}^{\vee}$ is a fractional ideal proving the first statement. To prove the second statement we will show containment in both directions. For the forward containment, first suppose $\a \in \mf{F}^{\vee}$ and $\b \in \mf{F}$. Then $\Trace_{L/K}(\a\b\mc{O}) \subseteq \Trace_{L/K}(\a\mf{F}) \subseteq \smc{O}$ by \cref{prop:norm_and_trace_AKBL} since $\b\mc{O} \subseteq \mf{F}$ and $\a \in \mf{F}^{\vee}$. Hence $\a\b \in \mc{O}^{\vee}$ so that $\mf{F}^{\vee}\mf{F} \subseteq \mc{O}^{\vee}$ and therefore $\mf{F}^{\vee} \subseteq \mf{F}^{-1}\mc{O}^{\vee}$. This proves the forward containment. For the reverse containment, suppose $\a \in \mf{F}^{-1}$ and $\b \in \mc{O}^{\vee}$. Then $\Trace_{L/K}(\a\b\mf{F}) \subseteq \Trace_{L/K}(\b\mc{O}) \subseteq \smc{O}$ by \cref{prop:norm_and_trace_AKBL} since $\a\mf{F} \subseteq \mc{O}$ and $\b \in \mc{O}^{\vee}$. Thus $\a\b \in \mf{F}^{\vee}$ implying $\mf{F}^{-1}\mc{O}^{\vee} \subseteq \mf{F}^{\vee}$ and proving the reverse containment. This completes the proof.
    \end{proof}

    As the dual $\mf{F}^{\vee}$ is a fractional ideal by \cref{prop:dual_lattice_is_fractional}, it is also a complete $\smc{O}$-lattice. As we might hope, taking the dual behaves well with respect to localization:

    \begin{proposition}\label{prop:localization_of_dual_is_dual_of_localization}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and let $D \subseteq \smc{O}-\{0\}$ be multiplicative. Then for any fractional ideal $\mf{F}$ of $\mc{O}$, we have
      \[
        (\mf{F}\mc{O}D^{-1})^{\vee} = \mf{F}^{\vee}\mc{O}D^{-1}.
      \]
    \end{proposition}
    \begin{proof}
      For the forward containment, suppose $\l \in L$ is such that $\Trace_{L/K}(\l\mf{F}\mc{O}D^{-1}) \subseteq \smc{O}$. As $D \subset K$ and $\mf{F}\mc{O} = \mf{F}$, linearity of the trace implies $\Trace_{L/K}(\l\mf{F}) \subseteq \smc{O}$. Hence $\l \in \mf{F}^{\vee}\mc{O}D^{-1}$ and the forward containment follows. For the reverse containment, suppose $\l \in L$ is such that $\Trace_{L/K}(\l\mf{F}) \subseteq \smc{O}$ and $\frac{\a}{\d} \in \mc{O}D^{-1}$. As $\mf{F}$ is an ideal we have $\Trace_{L/K}(\l\a\mf{F}) \subseteq \smc{O}$. From linearity of the trace together with $D \subset K$, we find that $\Trace_{L/K}(\l\mf{F}\mc{O}D^{-1}) \subseteq \smc{O}$. This proves $\l \in (\mf{F}\mc{O}D^{-1})^{\vee}$ and the reverse containment follows.
    \end{proof}
    
    We will now introduce the different and the discriminant. We define the \textbf{complement}\index{complement} $\mf{C}_{\mc{O}/\smc{O}}$ of $\mc{O}/\smc{O}$ by
    \[
      \mf{C}_{\mc{O}/\smc{O}} = \mc{O}^{\vee}.  
    \]
    This is a fractional ideal by \cref{prop:dual_lattice_is_fractional}. The \textbf{different}\index{different} $\mf{D}_{\mc{O}/\smc{O}}$ of $\mc{O}/\smc{O}$ is defined to be the inverse of the complement $\mf{C}_{\mc{O}/\smc{O}}$: 
    \[
      \mf{D}_{\mc{O}/\smc{O}} = (\mc{O}^{\vee})^{-1}.  
    \]
    As $\mc{O} \subseteq \mc{O}^{\vee}$ by \cref{prop:norm_and_trace_AKBL}, it follows from \cref{prop:explicit_inverse_ideal} that $\mf{D}_{\mc{O}/\smc{O}}$ is an integral ideal and
    \[
      \mf{D}_{\mc{O}/\smc{O}} = \{\l \in L: \l\mc{O}^{\vee} \subseteq \mc{O}\}.  
    \]
    Moreover, by \cref{prop:dual_lattice_is_fractional} we can express the dual fractional ideal $\mf{F}^{\vee}$ of a fractional ideal $\mf{F}$ of $\smc{O}$ in terms of the different as
    \[
      \mf{F}^{\vee} = \mf{F}^{-1}\mf{D}_{\mc{O}/\smc{O}}^{-1}.
    \]
    Now for the discriminant. We define the \textbf{discriminant}\index{discriminant} $\mf{d}_{\mc{O}/\smc{O}}$ of $\mc{O}/\smc{O}$ to be the ideal of $\smc{O}$ generated by all discriminants $d_{L/K}(\a_{1},\ldots,\a_{n})$ as $\a_{1},\ldots,\a_{n}$ runs over all bases of $L/K$ contained in $\mc{O}$. Note that $\mf{d}_{\mc{O}/\smc{O}}$ is necessarily an integral ideal. Recall that if $\mc{O}/\smc{O}$ admits an integral then $\mc{O}$ is a free $\smc{O}$-module of rank $n$. In this case, bases of $L/K$ contained in $\mc{O}$ are precisely the integral bases of $\mc{O}/\smc{O}$. Since the discriminant of any two integral bases differ by an element of $(\smc{O}^{\ast})^{2}$ (as we have seen more generally for free modules), we find that
    \[
      \mf{d}_{\mc{O}/\smc{O}} = d_{L/K}(\a_{1},\ldots,\a_{n})\smc{O},
    \]
    for any integral basis $\a_{1},\ldots,\a_{n}$ of $\mc{O}/\smc{O}$. So $\mf{d}_{\mc{O}/\smc{O}}$ is a principal integral ideal if $\mc{O}/\smc{O}$ admits an integral basis. By \cref{thm:integral_basis_AKBL} this will hold if $\smc{O}$ is a principal ideal domain but not necessarily in general. The different and discriminant are related to each other via the ideal norm, but to show this we require a fact. Recall that if $\mc{O}/\smc{O}$ is Dedekind extension for a finite separable extension $L/K$ then so is $\mc{O}D^{-1}/\smc{O}D^{-1}$ for any multiplicative $D \subseteq \smc{O}-\{0\}$. The different and discriminant behave well in this setting:

    \begin{proposition}\label{prop:different_and_discriminant_respect_localization}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and let $D \subseteq \smc{O}-\{0\}$ be multiplicative. Then
      \[
        \mf{D}_{\mc{O}D^{-1}/\smc{O}D^{-1}} = \mf{D}_{\mc{O}/\smc{O}}\mc{O}D^{-1} \quad \text{and} \quad \mf{d}_{\mc{O}D^{-1}/\smc{O}D^{-1}} = \mf{d}_{\mc{O}/\smc{O}}\smc{O}D^{-1}
      \]
    \end{proposition}
    \begin{proof}
      For the first identity, it is equivalent to show
      \[
        ((\mc{O}D^{-1})^{\vee})^{-1} = (\mc{O}^{\vee})^{-1}\mc{O}D^{-1},
      \]
      by definition of the different. Applying \cref{prop:localization_of_inverse_is_inverse_of_localization,prop:localization_of_dual_is_dual_of_localization}, we see that the right-had side is equal to the left-hand side as desired. For the second identity, we will show containment in both directions. For the forward inclusion, suppose $\frac{\a_{1}}{\d_{1}},\ldots,\frac{\a_{n}}{\d_{n}}$ is a basis of $L/K$ contained in $\mc{O}D^{-1}$. Setting $\d = \d_{1} \cdots \d_{n}$, we see that $\frac{\a_{1}\d}{\d_{1}},\ldots,\frac{\a_{n}\d}{\d_{n}}$ is a basis of $L/K$ contained in $\mc{O}$. As $D \subset K$ and $d_{L/K}\left(\frac{\a_{1}\d}{\d_{1}},\ldots,\frac{\a_{n}\d}{\d_{n}}\right) \in \mf{d}_{\mc{O}/\smc{O}}$, linearity of the trace implies $d_{L/K}\left(\frac{\a_{1}}{\d_{1}},\ldots,\frac{\a_{n}}{\d_{n}}\right) \in \mf{d}_{\mc{O}/\smc{O}}\smc{O}D^{-1}$. This shows the forward containment. For the reverse containment, suppose $\a_{1},\ldots,\a_{n}$ is a basis of $L/K$ contained in $\mc{O}$ and let $\frac{\b}{\d} \in \smc{O}D^{-1}$. Then $\frac{\a_{1}\b}{\d},\ldots,\frac{\a_{n}\b}{\d}$ is a basis for $L/K$ contained in $\mc{O}D^{-1}$. As $\smc{O}D^{-1} \subseteq K$ and $d_{L/K}\left(\frac{\a_{1}\b}{\d},\ldots,\frac{\a_{n}\b}{\d}\right) \in \mf{d}_{\mc{O}D^{-1}/\smc{O}D^{-1}}$, linearity of the trace again implies $d_{L/K}(\a_{1}\ldots,\a_{n}) \in \mf{d}_{\mc{O}D^{-1}/\smc{O}D^{-1}}$ proving the reverse containment.
    \end{proof}

    The different and discriminant are related in the sense that the ideal norm of the different is the discriminant:

    \begin{proposition}\label{prop:norm_of_different_is_discriminant}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$. Then
      \[
        \mf{d}_{\mc{O}/\smc{O}} = \mf{N}_{\mc{O}/\smc{O}}(\mf{D}_\mc{O}/\smc{O}).
      \] 
    \end{proposition}
    \begin{proof}
      In view of \cref{prop:ring_is_intersection_of_all_localizations,thm:Dedekind_if_and_only_if_all_localizations_are_discrete_valuation_rings,prop:different_and_discriminant_respect_localization}, we may assume $\smc{O}$ is a discrete valuation ring and hence a principal ideal domain. Since $\smc{O}$ is local there are only finitely many primes of $\mc{O}$ (as they all must lie above the unique prime of $\smc{O}$). By \cref{prop:Dedekind_with_finite_primes_is_PID}, $\mc{O}$ is a principal ideal domain as well. Moreover, by \cref{thm:integral_basis_AKBL} $\mc{O}$ admits an integral basis $\a_{1},\ldots,\a_{n}$ over $\smc{O}$ and every fractional ideal of $\mc{O}$ is a free $\smc{O}$-module of rank $n$. Then $\mf{d}_{\mc{O}/\smc{O}}$ is a principal integral ideal where
      \[
        \mf{d}_{\mc{O}/\smc{O}} = d_{L/K}(\a_{1},\ldots,\a_{n})\smc{O}.
      \]
      As $\mc{O}$ is a principal ideal domain, every fractional ideal is also principal. So on the one hand, $\mf{C}_{\mc{O}/\smc{O}} = \l\mc{O}$ for some nonzero $\l \in L$ and $\l\a_{1},\ldots,\l\a_{n}$ is a basis of $L/K$ contained in $\mf{C}_{\mc{O}/\smc{O}}$. Moreover,
      \[
        d_{L/K}(\l\a_{1},\ldots,\l\a_{n}) = \Norm_{L/K}(\l)^{2}d_{L/K}(\a_{1},\ldots,\a_{n}),
      \]
      by \cref{equ:discriminant_base_change} and that base change matrix from $\a_{1},\ldots,\a_{n}$ to $\l\a_{1},\ldots,\l\a_{n}$ is the multiplication by $\l$ map. \todo{xxx}
    \end{proof}

    We will now show that a prime $\mf{P}$ of $L$ ramifies if and only if it divides the different $\mf{D}_{\mc{O}/\smc{O}}$ provided the residue class extensions are separable:

    \begin{theorem}\label{thm:ramifies_if_and_only_if_divides_the_different}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and assume that all residue class extensions are separable. Then a prime $\mf{P}$ of $L$ ramifies if and only if $\mf{P}$ divides $\mf{D}_{\mc{O}/\smc{O}}$.
    \end{theorem}

    As an almost immediate consequence, a prime $\mf{p}$ of $K$ ramifies if and only if it divides the discriminant $\mf{d}_{\mc{O}/\smc{O}}$ provided the residue class extensions are separable:

    \begin{theorem}\label{thm:ramifies_if_and_only_if_divides_the_discriminant}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and assume that all residue class extensions are separable. Then a prime $\mf{p}$ of $K$ ramifies if and only if $\mf{p}$ divides $\mf{d}_{\mc{O}/\smc{O}}$.
    \end{theorem}
    \begin{proof}
      If $\mf{p}$ divides $\mf{d}_{\mc{O}/\smc{O}}$, \cref{prop:norm_of_different_is_discriminant} implies that there is a prime $\mf{P}$ above $\mf{p}$ which divides $\mf{D}_{\mc{O}/\smc{O}}$. By \cref{thm:ramifies_if_and_only_if_divides_the_different}, $\mf{P}$ is ramified in $L$ and hence $\mf{p}$ is ramified in $K$. Now suppose $\mf{p}$ is ramified in $K$. Then there is a prime $\mf{P}$ above $\mf{p}$ which is ramified in $L$. By \cref{thm:ramifies_if_and_only_if_divides_the_different}, $\mf{P}$ divides $\mf{D}_{\mc{O}/\smc{O}}$. But then \cref{prop:norm_of_different_is_discriminant} implies $\mf{p}$ divides $\mf{d}_{\mc{O}/\smc{O}}$.
    \end{proof}

    As a corollary to both \cref{thm:ramifies_if_and_only_if_divides_the_different,thm:ramifies_if_and_only_if_divides_the_discriminant} we see that only finitely many primes can ramify:

    \begin{corollary}\label{cor:finitely_many_primes_ramify}
      Let $\mc{O}/\smc{O}$ be a Dedekind extension of a degree $n$ separable extension $L/K$ and assume that all residue class extensions are separable. Then only finitely many primes ramify in $L$ or $K$.
    \end{corollary}
    \begin{proof}
      There are only finitely many prime factors of both $\mf{D}_{\mc{O}/\smc{O}}$ and $\mf{d}_{\mc{O}/\smc{O}}$. By \cref{thm:ramifies_if_and_only_if_divides_the_different,thm:ramifies_if_and_only_if_divides_the_discriminant} only finitely many primes can ramify in $L$ or $K$.
    \end{proof}

    Now consider the case of a number field $K$ of degree $n$. The \textbf{complement}\index{complement} $\mf{C}_{K}$ of $K$ is the complement of $\mc{O}_{K}/\Z$, the \textbf{different}\index{different} $\mf{D}_{K}$ of $K$ is the different of $\mc{O}_{K}/\Z$, and the \textbf{discriminant}\index{discriminant} $\mf{d}_{K}$ of $K$ is the discriminant of $\mc{O}_{K}/\Z$. Since $\Z$ is a principal ideal domain, $\mf{d}_{K}$ is a principal integral ideal and generated by the discriminant $d_{L/K}(\a_{1},\ldots,\a_{n})$ of any integral basis $\a_{1},\ldots,\a_{n}$ for $K$. But the discriminant of any two integral bases for $K$ differ by an element of $(\Z^{\ast})^{2}$ and hence are actually equal. Accordingly, we define the \textbf{discriminant}\index{discriminant} $\D_{K}$ of $K$ by
    \[
      \D_{K} = d_{L/K}(\a_{1},\ldots,\a_{n}),
    \]
    for any integral basis $\a_{1},\ldots,\a_{n}$ for $K$. Then $\D_{K}$ is well-defined. Moreover, $\D_{K}$ is a non-zero integer by \cref{prop:norm_and_trace_AKBL,lem:trace_is_nondegenerate} and may very well be negative. In any case, $\D_{K}$ is related to $\mf{d}_{K}$ by the identity
    \[
      \mf{d}_{K} = \D_{K}\mc{O}_{K}.
    \]
    As all of the residue class extensions are separable, it follows from \cref{thm:ramifies_if_and_only_if_divides_the_discriminant,cor:finitely_many_primes_ramify} that a prime $p$ ramifies in $\Q$ if and only if it divides $|\D_{K}|$ and finitely many primes of $\Q$ ramify.

    \iffalse
    There is no general way to see how a prime $p$ factors for an arbitrary number field $K$. However, in the case that the ring of integers is monogenic we can describe the unique factorization explicitly via the \textbf{Dedekind-Kummer theorem}\index{Dedekind-Kummer theorem}:

    \begin{theorem*}[Dedekind-Kummer theorem]
      Let $K$ be a monogenic number field where $\mc{O}_{K} = \Z[\a]$ for $\a \in \mc{O}_{K}$ and let $p$ be a prime. Let $m_{\a}(x)$ be the minimal polynomial for $\a$ and let $\conj{m_{\a}}(x)$ be its reduction modulo $p$. Also let
      \[
        \conj{m_{\a}}(x) = \conj{m_{r}}(x)^{e_{r}} \cdots \conj{m_{r}}(x)^{e_{r}}
      \]
      with $\conj{m_{i}}(x) \in \F_{p}[x]$ and $e_{i} \ge 0$, be the prime factorization of $\conj{m_{\a}}(x)$ in $\F_{p}[x]$. Let $m_{i}(x)$ be any lift of $\conj{m_{i}}(x)$ to $\Z[x]$ and set
      \[
        \mf{p}_{i} = p\mc{O}_{K}+m_{i}(\a)\mc{O}_{K},
      \]
      for all $i$. Then $\mf{p}_{i}$ is a prime integral ideal for all $i$ and
      \[
        p\mc{O}_{K} = \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}},
      \]
      is the prime factorization of $p\mc{O}_{K}$.
    \end{theorem*}
    \begin{proof}
      Since $m_{\a}(x)$ is the minimal polynomial for $\a$, we have an isomorphism $\Z[\a] \cong \Z[x]/m_{\a}(x)\Z[x]$ where the inverse isomorphism is given by evaluation at $\a$. Then we have the chain of isomorphism
      \[
        \mc{O}_{K}/p\mc{O}_{K} \cong (\Z[x]/m_{\a}(x)\Z[x])/(p(\Z[x]/m_{\a}(x)\Z[x])) \cong \Z[x]/(p\Z[x]+m_{\a}(x)\Z[x]) \cong \F_{p}[x]/\conj{m_{\a}}(x)\F_{p}[x],
      \]
      where the second and third isomorphisms follow by taking $\Z[x]/(p\Z[x]+m_{\a}(x)\Z[x])$ and reducing $\Z[x]$ modulo $m_{\a}(x)$ or $p$ respectively. Therefore the inverse isomorphism is given by sending any representative $\conj{f}(x)$ of a class in $\F_{p}[x]/\conj{m_{\a}}(x)\F_{p}[x]$ to a lift $f(x) \in \Z[x]$ and then to $\conj{f(\a)}$ where $\conj{f(\a)}$ is $f(\a)$ modulo $p\mc{O}_{K}$. Now set $A = \F_{p}[x]/\conj{m_{\a}}(x)\F_{p}[x]$. Then the Chinese remainder theorem gives an isomorphism
      \[
        A \cong \bigop_{1 \le i \le r}\F_{p}[x]/\conj{m_{i}}(x)^{e_{i}}\F_{p}[x].
      \]
      As $\conj{m_{i}}(x)$ is irreducible, $\conj{m_{i}}(x)\F_{p}[x]$ is maximal and hence $\F_{p}[x]/\conj{m_{i}}(x)\F_{p}[x]$ is a field. By the third isomorphism theorem, $\conj{m_{i}}(x)\F_{p}[x]/\conj{m_{i}}(x)^{e_{i}}\F_{p}[x]$ is a maximal ideal of $\F_{p}[x]/\conj{m_{i}}(x)^{e_{i}}\F_{p}[x]$. It follows that the maximal ideals of $A$ are precisely $\conj{m_{i}}(x)A$ and we have an isomorphism
      \[
        A/\conj{m_{i}}(x)A \cong \F_{p}[x]/\conj{m_{i}}(x)\F_{p}[x],
      \]
      for all $i$. Via the isomorphism $\mc{O}_{K}/p\mc{O}_{K} \cong A$ described above, the maximal ideals of $\mc{O}_{K}/p\mc{O}_{K}$ are exactly $\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})$. We now show that the $\mf{p}_{i}$ are prime. To see this, consider the surjective homomorphism
      \[
        \pi:\mc{O}_{K} \to \mc{O}_{K}/p\mc{O}_{K} \qquad \a \mapsto \a \pmod{p\mc{O}_{K}}.
      \]
      Then the image of $\mf{p}_{i}$ under $\pi$ is $\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})$. As this ideal is maximal and hence prime, the preimage $\mf{p}_{i}$ is prime too. Moreover, the $\mf{p}_{i}$ are all distinct since the $\conj{m_{i}(\a)}\mc{O}_{K}/p\mc{O}_{K}$ are which are all distinct because the $\conj{m_{i}}(x)A$ are (using the isomorphism $\mc{O}_{K}/p\mc{O}_{K} \cong A$). In particular, they are also relatively prime. By construction, $\mf{p}_{i} \subseteq p\mc{O}_{K}$ so that the $\mf{p}_{i}$ are prime factors of $p\mc{O}_{K}$. These are the only prime factors of $p\mc{O}_{K}$ because the image of any prime integral ideal under $\pi$ contained in $p\mc{O}_{K}$ must be a maximal ideal of $\mc{O}_{K}/p\mc{O}_{K}$ (by the fact that prime integral ideals are maximal and the fourth isomorphism theorem) and every maximal ideal is one of the $\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})$. Together, all of this means that $p\mc{O}_{K}$ admits the prime factorization
      \[
        p\mc{O}_{K} = \mf{p}_{1}^{e_{p}(\mf{p}_{1})} \cdots \mf{p}_{r}^{e_{p}(\mf{p}_{r})},
      \]
      for some ramification indices $e_{p}(\mf{p}_{i})$ for all $i$. We will be done if we can show that the ramification indices satisfy $e_{p}(\mf{p}_{i}) = e_{i}$. To accomplish this, observe that we have an isomorphism
      \[
        \mc{O}_{K}/\mf{p}_{i} \cong (\mc{O}_{K}/p\mc{O}_{K})/(\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})) \cong \F_{p}[x]/\conj{m_{i}}(x)\F_{p}[x],
      \]
      where the first isomorphism follow by taking $\mc{O}_{K}/\mf{p}_{i}$ and reducing $\mc{O}_{K}$ modulo $p$ and the second isomorphism follows from $\mc{O}_{K}/p\mc{O}_{K} \cong A$ and that the image of the maximal ideal $\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})$ under this isomorphisms is $\conj{m_{i}}(x)A$. Now $\F_{p}[x]/\conj{m_{i}}(x)\F_{p}[x]$ is a vector space over $\F_{p}$ (as it contains $\F_{p}$) of degree $\deg(\conj{m_{i}}(x))$. Hence the inertia degree $f_{p}(\mf{p}_{i})$ of $\mf{p}_{i}$ satisfies $f_{p}(\mf{p}_{i}) = \deg(\conj{m_{i}}(x))$. The ideal $\conj{m_{i}}(x)^{e_{i}}A$ under the isomorphism $A \cong \mc{O}_{K}/p\mc{O}_{K}$ is the ideal $\conj{m_{i}(\a)}^{e_{i}}(\mc{O}_{K}/p\mc{O}_{K})$. As the image of $\mf{p}_{i}$ under $\pi$ is $\conj{m_{i}(\a)}(\mc{O}_{K}/p\mc{O}_{K})$, we have that $\mf{p}_{i}^{e_{i}}$ is contained in the preimage of $\conj{m_{i}(\a)}^{e_{i}}(\mc{O}_{K}/p\mc{O}_{K})$ under $\pi$. As $\conj{m_{\a}(\a)}(\mc{O}_{K}/p\mc{O}_{K}) = 0$ is the zero ideal, it follows that
      \[
        p\mc{O}_{K} = \pi^{-1}(0) \supseteq \mf{p}_{1}^{e_{1}} \cdots \mf{p}_{r}^{e_{r}}.
      \]
      Since the $\mf{p}_{i}$ are prime, we have $e_{p}(\mf{p}_{i}) \le e_{i}$ for all $i$. By \cref{prop:inertia_ramification_relation} then gives
      \[
        n = \sum_{1 \le i \le r}e_{p}(\mf{p}_{i})f_{p}(\mf{p}_{i}) \le \sum_{1 \le i \le r}e_{i}f_{p}(\mf{p}_{i}) \le \sum_{1 \le i \le r}e_{i}\deg(\conj{m_{i}}(x)) \le n,
      \]
      where the last equality follows by the prime factorization of $\conj{m_{\a}}(x)$ and that $\deg(\conj{m_{\a}}(x)) = \deg(m_{\a}(x))$ because $m_{\a}(x)$ is monic. This shows that $e_{p}(\mf{p}_{i}) = e_{i}$ for all $i$ which completes the proof.
    \end{proof}
    \fi