\chapter{The Theory of Holomorphic Forms}
  Holomorphic forms are special classes of functions on the upper half-space $\H$ of the complex plane. They are holomorphic, have a transformation law with respect to a congruence subgroup, and satisfy a growth condition. We will introduce these forms in a general context.
  \section{Holomorphic Forms}
    Define $j(\g,z)$ by
    \[
      j(\g,z) = (cz+d),
    \]
    for all $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \GL_{2}^{+}(\Q)$ and $z \in \H$. There is a very useful property that $j(\g,z)$ satisfies. To state it, let $\g' = \begin{psmallmatrix} a' & b' \\ c' & d' \end{psmallmatrix} \in \GL_{2}^{+}(\Q)$. Then
    \[
      \g\g' = \begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} a' & b' \\ c' & d' \end{pmatrix} = \begin{pmatrix} a'a+b'c & a'b+b'b \\ c'a+d'c & c'b+d'd \end{pmatrix},
    \]
    and we have
    \begin{align*}
      j(\g',\g z)j(\g,z) &= \left(c'\frac{az+b}{cz+d}+d'\right)(cz+d) \\
      &= (c'(az+b)+d'(cz+d)) \\
      &= (c'a+d'c)z+c'b+d'd) \\
      &= j(\g'\g,z).
    \end{align*}
    In short,
    \[
      j(\g'\g,z) =  j(\g',\g z)j(\g,z),
    \]
    and this is called the \textbf{cocycle condition}\index{cocycle condition} for $j(\g,z)$. For any integer $k \ge 1$ and any $\g \in \GL_{2}^{+}(\Q)$ we define the \textbf{slash operator}\index{slash operator} $|_{j,k}\g:C(\H) \to C(\H)$ to be the linear operator given by
    \[
      (f|_{j,k}\g)(z) = j(\g,z)^{-k}f(\g z).
    \]
    If $j$ and $k$ are clear from content we will suppress this dependencies accordingly. If an operator commutes with the slash operators $|_{j,k}\g$ for every $\g \in \PSL_{2}(\Z)$, we say that it is \textbf{invariant}\index{invariant}. Now let $\G$ be a congruence subgroup of level $N$ that is reduced at infinity and let $\chi$ be a Dirichlet character of conductor $q \mid N$. Set $\chi(\g) = \chi(d)$ for all for all $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G$. We say that a function $f:\H \to \C$ is \textbf{holomorphic form}\index{holomorphic form} (or \textbf{modular form}\index{modular form}) on $\GH$ of \textbf{weight}\index{weight} $k$, \textbf{level}\index{level} $N$, and \textbf{character}\index{character} $\chi$, if the following properties are satisfied:
    \begin{enumerate}[label=(\roman*)]
      \item $f$ is holomorphic on $\H$.
      \item $(f|_{j,k}\g)(z) = \chi(\g)f(z)$ for all $\g \in \G$.
      \item $(f|_{j,k}\a)(z) = O(1)$ for all $\a \in \PSL_{2}(\Z)$ (or equivalently $\a \in \GL_{2}^{+}(\Q)$).
    \end{enumerate}
    We say $f$ is a \textbf{(holomorphic) cusp form}\index{(holomorphic) cusp form} if the additional property is satisfied:
    \begin{enumerate}[label=(\roman*)]
      \setcounter{enumi}{3}
      \item For all cusps $\mf{a}$ and any $y > 0$, we have
      \[
        \int_{0}^{1}(f|\s_{\mf{a}})(z)\,dx = 0.
      \]
    \end{enumerate}
    Property (ii) is called the \textbf{modularity condition}\index{modularity condition} and we say $f$ is \textbf{modular}\index{modular}. In particular, $f$ is a function on $\mc{F}_{\G}$. The modularity condition can equivalently be expressed as
    \[
      f(\g z) = \chi(\g)j(\g,z)^{k}f(z).
    \]
    Property (iii) is called the \textbf{growth condition}\index{growth condition} for holomorphic forms and we say $f$ is \textbf{holomorphic at the cusps}\index{holomorphic at the cusps}. Clearly we only need to verify the growth condition on a set of scaling matrices for the cusps. To see the equivalence in the growth condition, every $\a \in \GL_{2}^{+}(\Q)$ is of the form $\a = \g\eta$ for some $\g \in \PSL_{2}(\Z)$ and $\eta \in \GL_{2}^{+}(\Q)$ of the form $\eta = \begin{psmallmatrix} \ast & \ast \\ 0 & \ast \end{psmallmatrix}$. To see this, if $c = 0$ the claim is obvious. For $c \neq 0$, let $r \ge 1$ be such that $r\a = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \GL_{2}^{+}(\Z)$ and set $a' = \frac{a}{(a,c)}$ and $c' = \frac{c'}{(a,c)}$ so that $a',c' \in \Z$ with $(a',c') = 1$. Then there exists $\g \in \PSL_{2}(\Z)$ with $\g^{-1} = \begin{psmallmatrix} \ast & \ast \\ -c' & a' \end{psmallmatrix}$. Moreover, $\g^{-1}r\a = \begin{psmallmatrix} \ast & \ast \\ 0 & \ast \end{psmallmatrix} \in \GL_{2}^{+}(\Z)$. Upon setting $\eta = \g^{-1}\a$, the claim is complete. From the decomposition $\a = \g\eta$, the cocycle condition gives
    \[
      j(\a,z) = j(\g,\eta z),
    \]
    and it follows that $(f|_{j,k}\a)(z) = O(1)$ for all $\a \in \GL_{2}^{+}(\Q)$ which proves the forward implication. The reverse implication is trivial since $\PSL_{2}(\Z) \subset \GL_{2}^{+}(\Q)$. Holomorphic forms also admit Fourier series. Indeed, modularity implies
    \[
      f(z+1) = f\left(\begin{pmatrix} 1 & 1 \\ 0 & 1 \end{pmatrix}z\right) = f(z),
    \]
    so that $f$ is $1$-periodic. Let $\s_{\mf{a}}$ be a scaling matrix for the $\mf{a}$ cusp. As \cref{lem:coset_lemma_1} implies $\s_{\mf{a}}^{-1}\G\s_{\mf{a}}$ is a congruence subgroup, it follows by the cocycle condition that $f|\s_{\mf{a}}$ is a holomorphic form on $\s_{\mf{a}}^{-1}\G\s_{\mf{a}}\backslash\H$ of the same weight and character as $f$. In particular, $f|\s_{\mf{a}}$ is $1$-periodic. Note that this means we only need to verify the growth condition as $y \to \infty$. Moreover, as $f|\s_{\mf{a}}$ is holomorphic it has a Fourier series
    \[
      (f|\s_{\mf{a}})(z) = \sum_{n \ge 0}a_{\mf{a}}(n,y)e^{2\pi inx},
    \]
    where the sum is only over $n \ge 0$ because holomorphy at the cusps implies that $f|\s_{\mf{a}}$ is bounded. We can simplify the Fourier coefficients $a_{\mf{a}}(n,y)$. To see this, since $f|\s_{\mf{a}}$ is holomorphic it satisfies the first order Cauchy-Riemann equations so that
    \[
      \frac{1}{2}\left(\frac{\del f|\s_{\mf{a}}}{\del x}+i\frac{\del f|\s_{\mf{a}}}{\del y}\right) = 0.
    \]
    Substituting in the Fourier series and equating coefficients we obtain the ODE
    \[
      2\pi na_{\mf{a}}(n,y)+a_{\mf{a},y}(n,y) = 0,
    \]
    Solving this ODE by separation of variables, we see that there exists an $a_{\mf{a}}(n)$ such that
    \[
      a_{\mf{a}}(n,y) = a_{\mf{a}}(n)e^{-2\pi ny}.
    \]
    The coefficients $a_{\mf{a}}(n)$ are the only part of the Fourier series depending on the implicit congruence subgroup $\G$. Using these coefficients instead, $f$ admits a \textbf{Fourier series at the $\mf{a}$ cusp}\index{Fourier series at the $\mf{a}$ cusp}:
    \[
      (f|\s_{\mf{a}})(z) = \sum_{n \ge 0}a_{\mf{a}}(n)e^{2\pi inz}.
    \]
    If $\mf{a} = \infty$, we will drop this dependence and in this case $f|\s_{\mf{a}} = f$. Moreover, property (iv) implies that $f$ is a cusp form if and only if $a_{\mf{a}}(n) = 0$ for every cusp $\mf{a}$. We can also easily derive a bound for the size of the Fourier coefficients of cusp forms. To see this, note that $\left|(f|\s_{\mf{a}})(z)\Im(z)^{\frac{k}{2}}\right|$ is $\s_{\mf{a}}^{-1}\G\s_{\mf{a}}$-invariant by the modularity of $f|\s_{\mf{a}}$, the cocycle condition, the identity $\Im(\s_{\mf{a}}^{-1}\g\s_{\mf{a}}z)^{\frac{k}{2}} = \frac{\Im(z)^{\frac{k}{2}}}{|j(\s_{\mf{a}}^{-1}\g\s_{\mf{a}},z)|^{k}}$, and that $|\chi(\g)| = 1$. Moreover, this function is bounded on $\mc{F}_{\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}$ because $f$ is a cusp form. Then $\s_{\mf{a}}^{-1}\G\s_{\mf{a}}$-invariance implies $\left|(f|\s_{\mf{a}})(z)\Im(z)^{\frac{k}{2}}\right|$ is bounded on $\H$. From the definition of Fourier series, it follows that
    \[
      a_{\mf{a}}(n)\Im(z)^{\frac{k}{2}} = \int_{0}^{1}(f|\s_{\mf{a}})(z)\Im(z)^{\frac{k}{2}}e^{-2\pi inz}\,dx \ll \int_{0}^{1}e^{2\pi ny}\,dx \ll e^{2\pi ny}.
    \]
    Upon setting $y = \frac{1}{n}$, the last expression is absolutely bounded and we obtain
    \[
      a_{\mf{a}}(n) \ll n^{\frac{k}{2}}.
    \]
    This bound is known as the \textbf{Hecke bound}\index{Hecke bound} for holomorphic forms. It follows from the Hecke bound and the Taylor series of $\frac{1}{1-e^{y}}$ along with its derivatives, that
    \[
      (f|\s_{\mf{a}})(z) = O\left(\sum_{n \ge 1}n^{\frac{k}{2}}e^{-2\pi ny}\right) = O\left(\sum_{n \ge 1}n^{k}e^{-2\pi ny}\right) = O\left(\frac{e^{-2\pi y}}{(1-e^{-2\pi y})^{2}}\right) = O(e^{-2\pi y}).
    \]
    This implies $(f|\s_{\mf{a}})(z)$ exhibits rapid decay. Accordingly, we say that $f$ exhibits \textbf{rapid decay at the cusps}\index{rapid decay at the cusps}. Observe that $(f|\s_{\mf{a}})$ is then bounded on $\H$ and, in particular, $f$ is bounded on $\H$.
  \section{Poincar\'e \& Eisenstein Series}
    Let $\G$ be a congruence subgroup of level $N$. We will introduce two important classes of holomorphic forms on $\GH$ namely the Poincar\'e and Eisenstein series. Let $m \ge 0$, $k \ge 4$, $\chi$ be a Dirichlet character with conductor $q \mid N$, and $\mf{a}$ be a cusp of $\GH$. We define the $m$-th \textbf{(holomorphic) Poincar\'e series}\index{(holomorphic) Poincar\'e series} $P_{m,k,\chi,\mf{a}}(z)$ of weight $k$ with character $\chi$ on $\GH$ at the $\mf{a}$ cusp by
    \[
      P_{m,k,\chi,\mf{a}}(z) = \sum_{\g \in \G_{\mf{a}}\backslash\G}\cchi(\g)j(\s_{\mf{a}}^{-1}\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g z}.
    \]
    We call $m$ the \textbf{index}\index{index} of $P_{m,k,\chi,\mf{a}}(z)$. If $\chi$ is the trivial character or $\mf{a} = \infty$, we will drop these dependencies accordingly. 

    \begin{remark}
      The reason why we restrict to $k \ge 4$ is because for $k = 0,2$ the Poincar\'e series need not converge (see \cref{prop:general_lattice_sum_convergence_for_two_variables}).
    \end{remark}

    We first verify that $P_{m,k,\chi,\mf{a}}(z)$ is well-defined. It suffices to show that the summands are independent of the representatives $\g$ and $\s_{\mf{a}}$. To see that $\cchi(\g)$ is independent of $\g$, recall that $\G_{\mf{a}} = \s_{\mf{a}}\G_{\infty}\s_{\mf{a}}^{-1}$ and let $\g' = \s_{\mf{a}}\eta_{\infty}\s_{\mf{a}}^{-1}\g$ with $\eta_{\infty} = \begin{psmallmatrix} 1 & n \\ 0 & 1 \end{psmallmatrix} \in \G_{\infty}$. Then
    \[
      \cchi(\g') = \cchi(\s_{\mf{a}}\eta_{\infty}\s_{\mf{a}}^{-1}\g) = \cchi(\s_{\mf{a}})\chi(\eta_{\infty})\cchi(\s_{\mf{a}})^{-1}\cchi(\g) = \cchi(\g),
    \]
    verifying that $\cchi(\g)$ is independent of the representative $\g$. As the set of representatives for the scaling matrix $\s_{\mf{a}}$ is $\s_{\mf{a}}\G_{\infty}$ and the set of representatives for $\g$ is $\G_{\mf{a}}\g$, the set of representatives for $\s_{\mf{a}}^{-1}\g$ is $\G_{\infty}\s_{\mf{a}}^{-1}\G_{\mf{a}}\g$. But as $\G_{\mf{a}} = \s_{\mf{a}}\G_{\infty}\s_{\mf{a}}^{-1}$, this set of representatives is $\G_{\infty}\s_{\mf{a}}^{-1}\g$ and therefore it remains to verify independence from multiplication on the left by an element of $\G_{\infty}$ namely $\eta_{\infty}$. The cocycle relation gives
    \[
      j(\eta_{\infty}\s_{\mf{a}}^{-1}\g,z) = j(\eta_{\infty},\s_{\mf{a}}^{-1}\g z)j(\s_{\mf{a}}^{-1}\g,z) = j(\s_{\mf{a}}^{-1}\g,z),
    \]
    where the last equality follows because $j(\eta_{\infty},\s_{\mf{a}}^{-1}\g z) = 1$. This verifies that $j(\s_{\mf{a}}^{-1}\g,z)$ is independent of the representatives $\g$ and $\s_{\mf{a}}$. Moreover, we have
    \[
      e^{2\pi im\eta_{\infty}\s_{\mf{a}}^{-1}\g z} = e^{2\pi im(\s_{\mf{a}}^{-1}\g z+n)} = e^{2\pi im\s_{\mf{a}}^{-1}\g}e^{2\pi imnz} = e^{2\pi im\s_{\mf{a}}^{-1}\g},
    \]
    which verifies that $e^{2\pi im\s_{\mf{a}}^{-1}\g z}$ is independent of the representatives $\g$ and $\s_{\mf{a}}$. Therefore $P_{m,k,\chi,\mf{a}}(z)$ is well-defined. To see that $P_{m,k,\chi,\mf{a}}(z)$ is holomorphic on $\H$, first note that $|e^{2\pi im\s_{\mf{a}}^{-1}\g z}| = e^{-2\pi m\Im(\mf{a}^{-1}\g z)} < 1$. Then the Bruhat decomposition for $\s_{\mf{a}}^{-1}\G$ gives
    \[
      P_{m,k,\chi,\mf{a}}(z) \ll \sum_{(c,d) \in \Z^{2}-\{\mathbf{0}\}}\frac{1}{|cz+d|^{k}}.
    \]
    As $k \ge 4$, this latter series is locally absolutely uniformly convergent for $z \in \H$ by \cref{prop:general_lattice_sum_convergence_for_two_variables}. Hence $P_{m,k,\chi,\mf{a}}(z)$ does too and so it is holomorphic on $\H$. We now verify modularity for $P_{m,k,\chi,\mf{a}}(z)$. This is just a computation:
    \begin{align*}
      P_{m,k,\chi,\mf{a}}(\g z) &= \sum_{\g' \in \G_{\mf{a}}\backslash\G}\cchi(\g')j(\s_{\mf{a}}^{-1}\g',\g z)^{-k}j(\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g'\g z} \\
      &= \sum_{\g' \in \G_{\mf{a}}\backslash\G}\cchi(\g')\left(\frac{j(\s_{\mf{a}}^{-1}\g'\g,z)}{j(\g,z)}\right)^{-k}j(\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g'\g z} \\
      &= j(\g,z)^{k}\sum_{\g' \in \G_{\mf{a}}\backslash\G}\cchi(\g')j(\s_{\mf{a}}^{-1}\g'\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g'\g z} \\
      &= \chi(\g)j(\g,z)^{k}\sum_{\g' \in \G_{\mf{a}}\backslash\G}\cchi(\g'\g)j(\s_{\mf{a}}^{-1}\g'\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g'\g z} \\
      &= \chi(\g)j(\g,z)^{k}\sum_{\g' \in \G_{\mf{a}}\backslash\G}\cchi(\g')j(\s_{\mf{a}}^{-1}\g',z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g' z} \\
      &= \chi(\g)P_{m,k,\chi,\mf{a}}(z),
    \end{align*}
    where in the second line we have used the cocycle condition and in the second to last line we have used that $\g' \to \g'\g^{-1}$ is a bijection on $\G$. To verify the growth condition, we will need a technical lemma:

    \begin{lemma}\label{lem:technical_Eisenstein_convergence_lemma}
      Let $a,b > 0$ be reals and consider the half-strip
      \[
        S_{a,b} = \{z \in \H:\text{$|x| \le a$ and $y \ge b$}\}.
      \]
      Then there is a $\d \in (0,1)$ such that
      \[
        |nz+m| \ge \d|ni+m|,
      \]
      for all $n,m \in \Z$ and all $z \in S_{a,b}$.
    \end{lemma}
    \begin{proof}
      If $n = 0$ then any $\d$ is sufficient and this $\d$ is independent of $z$. If $n \neq 0$, then the desired inequality is equivalent to
      \[
        \left|\frac{z+\frac{m}{n}}{i+\frac{n}{m}}\right| \ge \d.
      \]
      So consider the function
      \[
        f(z,r) = \left|\frac{z+r}{i+r}\right|,
      \]
      for $z \in S_{a,b}$ and $r \in \R$. It suffices to show $f(z,r) \ge \d$. As $z \in \H$, $z-r \neq 0$ so that $f(z,r)$ is continuous and positive on $S_{a,b} \x \R$. Now let $Y > b$ and consider the region
      \[
        S_{a,b}^{Y} = \{z \in \H:\text{$|x| \le a$ and $b \le y \le Y$}\}.
      \]
      We claim that there exists a $Y$ such that if $y > Y$ and $|x| > Y$ then $f(z,r)^{2} > \frac{1}{4}$. Indeed, we compute
      \[
        f(z,r)^{2} = \frac{(z+r)(\conj{z}+r)}{(i+r)(-i+r)} = \frac{|z|^{2}+2xr+r^{2}}{1+r^{2}} \ge \frac{y+r^{2}}{1+r^{2}},
      \]
      where in the inequality we have used the bound $|z|^{2} \ge y$ and that $x$ is bounded. Now $\frac{r^{2}}{1+r^{2}} \to 1$ as $r \to \pm\infty$ so there exists a $Y$ such that $|r| > Y$ implies $\frac{r^{2}}{1+r^{2}} \ge \frac{1}{4}$. Then
      \[
        \frac{y+r^{2}}{1+r^{2}} \ge \frac{y}{1+r^{2}}+\frac{r^{2}}{1+r^{2}} \ge \frac{y}{1+r^{2}}+\frac{1}{4} > \frac{1}{4}.
      \]
      It follows that $f(z,r) > \frac{1}{2}$ outside of $S_{a,b}^{Y} \x [-Y,Y]$. But this latter region is compact and so $f(z,r)$ obtains a minimum $\d'$ on it. Setting $\d = \min\{\frac{1}{2},\d'\}$ completes the proof.
    \end{proof}

    We can now verify the growth condition for $P_{m,k,\chi,\mf{a}}(z)$. Let $\s_{\mf{b}}$ be a scaling matrix for the cusp $\mf{b}$. Then the bound $|e^{2\pi im\s_{\mf{a}}^{-1}\g\s_{\mf{b}}z}| = e^{-2\pi m\Im(\s_{\mf{a}}^{-1}\g\s_{\mf{b}}z)} < 1$, cocycle condition, and Bruhat decomposition for $\s_{\mf{a}}^{-1}\G\s_{\mf{b}}$ together give
    \[
      j(\s_{\mf{b}},z)^{-k}P_{m,k,\chi,\mf{a}}(\s_{\mf{b}}z) \ll \sum_{(c,d) \in \Z^{2}-\{\mathbf{0}\}}\frac{1}{|cz+d|^{k}}.
    \]
    Now decompose this last sum as
    \[
      \sum_{(c,d) \in \Z^{2}-\{\mathbf{0}\}}\frac{1}{|cz+d|^{k}} = \sum_{d \neq 0}\frac{1}{d^{k}}+\sum_{c \neq 0}\sum_{d \in \Z}\frac{1}{|cz+d|^{k}} = 2\sum_{d \ge 1}\frac{1}{d^{k}}+2\sum_{c \ge 1}\sum_{d \in \Z}\frac{1}{|cz+d|^{k}}.
    \]
    Since the first sum is absolutely uniformly bounded, it suffices to show that the double sum is too. To see this, let $y \ge 1$ and $\d$ be as in \cref{lem:technical_Eisenstein_convergence_lemma}. Then for any integer $N \ge 1$ we can write
    \begin{align*}
      \sum_{c \ge 1}\sum_{d \in \Z}\frac{1}{|cz+d|^{k}} &= \sum_{c+|d| \le N}\frac{1}{|cz+d|^{k}}+\sum_{c+|d| > N}\frac{1}{|cz+d|^{k}} \\
      &\le \sum_{c+|d| \le N}\frac{1}{|cz+d|^{k}}+\sum_{c+|d| > N}\frac{1}{(\d|ci+d|)^{k}} \\
      &\le \sum_{c+|d| \le N}\frac{1}{|cz+d|^{k}}+\frac{1}{\d^{k}}\sum_{c+|d| > N}\frac{1}{|ci+d|^{k}}.
    \end{align*}
    As $\sum_{c \ge 1}\sum_{d \in \Z}\frac{1}{|ci+d|^{k}}$ converges by \cref{prop:general_lattice_sum_convergence_for_two_variables}, the second sum tends to zero as $N \to \infty$. As for the first sum, it is finite and each term is bounded. Thus the double sum is absolutely uniformly bounded. This verifies the growth condition. We collect this work as a theorem:

    \begin{theorem}
      Let $m \ge 0$, $k \ge 4$, $\chi$ be a Dirichlet character with conductor dividing the level, and $\mf{a}$ be a cusp of $\GH$. The Poincar\'e series
      \[
        P_{m,k,\chi,\mf{a}}(z) = \sum_{\g \in \G_{\mf{a}}\backslash\G}j(\s_{\mf{a}}^{-1}\g,z)^{-k}e^{2\pi im\s_{\mf{a}}^{-1}\g z},
      \]
      is a weight $k$ holomorphic form with character $\chi$ on $\GH$.
    \end{theorem}
    
    For $m = 0$, we write $E_{k,\chi,\mf{a}}(z) = P_{0,k,\chi,\mf{a}}(z)$ and call $E_{k,\chi,\mf{a}}(z)$ the \textbf{(holomorphic) Eisenstein series}\index{(holomorphic) Eisenstein series} of weight $k$ and character $\chi$ on $\GH$ at the $\mf{a}$ cusp. It is defined by
    \[
      E_{k,\chi,\mf{a}}(z) = \sum_{\g \in \G_{\mf{a}}\backslash\G}\cchi(\g)j(\s_{\mf{a}}^{-1}\g,z)^{-k}.
    \]
    If $\chi$ is the trivial character or $\mf{a} = \infty$, we will drop these dependencies accordingly. In particular, we have already verified the following theorem:

    \begin{theorem}
      Let $k \ge 4$, $\chi$ be Dirichlet character with conductor dividing the level, and $\mf{a}$ be a cusp of $\GH$. The Eisenstein series
      \[
        E_{k,\chi,\mf{a}}(z) = \sum_{\g \in \G_{\mf{a}}\backslash\G}\cchi(\g)j(\s_{\mf{a}}^{-1}\g,z)^{-k},
      \]
      is a weight $k$ holomorphic form with character $\chi$ on $\GH$.
    \end{theorem}

    We will now compute the Fourier series of the Poincar\'e series with positive index:

    \begin{proposition}\label{prop:Fourier_series_Poincare_holomorphic}
      Let $m \ge 1$, $k \ge 4$, $\chi$ be Dirichlet character with conductor dividing the level, and $\mf{a}$ and $\mf{b}$ be cusps of $\GH$. The Fourier series of $P_{m,k,\chi,\mf{a}}(z)$ on $\GH$ at the $\mf{b}$ cusp is given by
      \[
        (P_{m,k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \sum_{t \ge 1}\left(\d_{\mf{a},\mf{b}}\d_{m,t}+\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}\sum_{c \in \mc{C}_{\mf{a},\mf{b}}}\frac{2\pi i^{-k}}{c}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)S_{\chi,\mf{a},\mf{b}}(m,t,c)\right)e^{2\pi itz}.
      \]
    \end{proposition}
    \begin{proof}
      From the cocycle condition, the Bruhat decomposition for $\s_{\mf{a}}^{-1}\G\s_{\mf{b}}$, and \cref{rem:Bruhat_modulo_infity_exact}, we have
      \[
        (P_{m,k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \d_{\mf{a},\mf{b}}e^{2\pi imz}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}, d \in \Z \\ d \tmod{c} \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(d)\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+cd}\right)}}{(cz+d)^{k}},
      \]
      where $a$ has been determined modulo $c$ by $ad-bc = 1$ and we have used the fact that
      \[
        \frac{a}{c}-\frac{1}{c^{2}z+cd} = \frac{az+b}{cz+d}.
      \]
      Summing over all pairs $(c,d)$ with $c \in \mc{C}_{\mf{a},\mf{b}}$, $d \in \Z$, and $d \in \mc{D}_{\mf{a},\mf{b}}(c)$ is the same as summing over all triples $(c,\ell,r)$ with $c \in \mc{C}_{\mf{a},\mf{b}}$, $\ell \in \Z$, and $r$ taken modulo $c$ with $r \in \mc{D}_{\mf{a},\mf{b}}(c)$. Indeed, this is seen by writing $d = c\ell+r$. Moreover, since $ad-bc = 1$ we have $a(c\ell+r)-bc = 1$ which further implies that $ar \equiv 1 \tmod{c}$. So we may take $a$ to be the inverse for $r$ modulo $c$. Then
      \begin{align*}
        \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}, d \in \Z \\ d \tmod{c} \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(d)\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+cd}\right)}}{(cz+d)^{k}} &= \sum_{(c,\ell,r)}\cchi(c\ell+r)\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+c^{2}\ell+cr}\right)}}{(cz+c\ell+r)^{k}} \\
        &= \sum_{(c,\ell,r)}\cchi(r)\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+c^{2}\ell+cr}\right)}}{(cz+c\ell+r)^{k}} \\
        &= \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}(c)}}\sum_{\ell \in \Z}\cchi(r)\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+c^{2}\ell+cr}\right)}}{(cz+c\ell+r)^{k}} \\
        &= \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(r)\sum_{\ell \in \Z}\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+c^{2}\ell+cr}\right)}}{(cz+c\ell+r)^{k}},
      \end{align*}
      where on the right-hand side it is understood that we are summing over all triples $(c,\ell,r)$ with the prescribed properties and the second line holds since $\chi$ has conductor diving the level and $d \in \mc{D}_{\mf{a},\mf{b}}(c)$ is determined modulo $c$. Now let
      \[
        I_{c,r}(z) = \sum_{\ell \in \Z}\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+c^{2}\ell+cr}\right)}}{(cz+c\ell+r)^{k}}.
      \]
      We will apply the Poisson summation formula to $I_{c,r}(z)$. This is possible since the summands are absolutely integrable by \cref{prop:decay_unbounded_inteval_integral} because they exhibit polynomial decay of order $k$ and $I_{c,r}(z)$ is holomorphic because $(P_{m,k,\chi,\mf{a}}|\s_{\mf{b}})(z)$ is. By the identity theorem it suffices to apply the Poisson summation formula for $z = iy$ with $y > 0$. Accordingly, let $f(x)$ be given by
      \[
        f(x) = \frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}x+cr+ic^{2}y}\right)}}{(cx+r+icy)^{k}}.
      \]
      As we have just noted, $f(x)$ is absolutely integrable on $\R$. We compute the Fourier transform:
      \[
        \hat{f}(t) = \int_{-\infty}^{\infty}f(x)e^{-2\pi itx}\,dx = \int_{-\infty}^{\infty}\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}x+cr+ic^{2}y}\right)}}{(cx+r+icy)^{k}}e^{-2\pi itx}\,dx.
      \]
      Complexify the integral to get
      \[
        \int_{\Im(z) = 0}\frac{e^{2\pi im\left(\frac{a}{c}-\frac{1}{c^{2}z+cr+ic^{2}y}\right)}}{(cz+r+icy)^{k}}e^{-2\pi itz}\,dz.
      \]
      Now make the change of variables $z \to z-\frac{r}{c}-icy$ to obtain
      \[
        e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}-2\pi ty}\int_{\Im(z) = y}\frac{e^{-\frac{2\pi im}{c^{2}z}}}{(cz)^{k}}e^{-2\pi itz}\,dz.
      \]
      The integrand is meromorphic with a pole at $z = 0$. Moreover, we have
      \[
        \frac{1}{(cz)^{k}} \ll \frac{1}{|cz|^{k}}, \quad e^{-\frac{2\pi im}{c^{2}z}} \ll e^{-\frac{2\pi m\Im(z)}{|cz|^{2}}}, \quad \text{and} \quad e^{-2\pi itz} \ll e^{2\pi ty}.
      \]
      The first expression has polynomial decay, the second expression is bounded, and the third expression exhibits rapid decay if and only if $t < 0$ and when $t = 0$ it is bounded. So when $t \le 0$ we may take the limit as $\Im(z) \to \infty$ by shifting the line of integration and conclude that the integral vanishes. It remains to compute the integral for $t \ge 1$. To do this, make the change of variables $z \to -\frac{z}{2\pi it}$ to the last integral to rewrite it as
      \begin{align*}
        -\frac{1}{2\pi it}\int_{(2\pi ty)}\frac{e^{-\frac{4\pi^{2}mt}{c^{2}z}}}{\left(-\frac{cz}{2\pi it}\right)^{k}}e^{z}\,dz &= -\frac{1}{2\pi it}\int_{(2\pi ty)}\left(-\frac{2\pi it}{cz}\right)^{k}e^{z-\frac{4\pi^{2}mt}{c^{2}z}}\,dz \\
        &= \frac{(-2\pi it)^{k-1}}{c^{k}}\int_{(2\pi ty)}z^{-k}e^{z-\frac{4\pi^{2}mt}{c^{2}z}}\,dz \\
        &= \frac{(-2\pi it)^{k-1}}{c^{k}}\int_{-\infty}^{(0^{+})}z^{-k}e^{z-\frac{4\pi^{2}mt}{c^{2}z}}\,dz \\
        &= \frac{2\pi i^{-k}}{c}\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right),
      \end{align*}
      where in the second to last line we have homotoped the line of integration to a Hankel contour about the negative real axis and in the last line we have used the Schl\"aflin integral representation for the $J$-Bessel function (see \cref{append:Bessel_Functions}). So in total we obtain
      \[
        \hat{f}(t) = \begin{cases} \left(\frac{2\pi i^{-k}}{c}\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}}\right)e^{-2\pi ty} & \text{if $t \ge 1$}, \\ 0 & \text{if $t \le 0$}. \end{cases}
      \]
      By the Poisson summation formula and the identity theorem, we have
      \[
        I_{c,r}(z) = \sum_{t \ge 1}\left(\frac{2\pi i^{-k}}{c}\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}}\right)e^{2\pi itz},
      \]
      for all $z \in \H$. Plugging this back into the Poincar\'e series gives a form of the Fourier series:
      \begin{align*}
        (P_{m,k,\chi,\mf{a}}|\s_{\mf{b}})(z) &= \d_{\mf{a},\mf{b}}e^{2\pi imz}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}}}\cchi(r)\sum_{t \ge 1}\left(\frac{2\pi i^{-k}}{c}\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}}\right)e^{2\pi imz} \\
        &= \sum_{t \ge 1}\left(\d_{\mf{a},\mf{b}}\d_{m,t}+\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}}}\cchi(r)\frac{2\pi i^{-k}}{c}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}}\right)e^{2\pi itz} \\
        &= \sum_{t \ge 1}\left(\d_{\mf{a},\mf{b}}\d_{m,t}+\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}}}\frac{2\pi i^{-k}}{c}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)\sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(r)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}}\right)e^{2\pi itz}.
      \end{align*}
      We will simplify the innermost sum. Since $a$ is the inverse for $r$ modulo $c$, the innermost sum above becomes
      \[
        \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(r)e^{2\pi im\frac{a}{c}+2\pi it\frac{r}{c}} = \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(\conj{a})e^{2\pi im\frac{a}{c}+2\pi it\frac{\conj{a}}{c}} = \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\chi(a)e^{\frac{2\pi i(am+\conj{a}t)}{c}} = S_{\chi,\mf{a},\mf{b}}(m,t,c).
      \]
      So at last, we obtain our desired Fourier series:
      \[
        (P_{m,k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \sum_{t \ge 1}\left(\d_{\mf{a},\mf{b}}\d_{m,t}+\left(\frac{\sqrt{t}}{\sqrt{m}}\right)^{k-1}\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}}}\frac{2\pi i^{-k}}{c}J_{k-1}\left(\frac{4\pi\sqrt{mt}}{c}\right)S_{\chi,\mf{a},\mf{b}}(m,t,c)\right)e^{2\pi itz}.
      \]
    \end{proof}

    An immediate consequence of \cref{prop:Fourier_series_Poincare_holomorphic} is that the Poincar\'e series $P_{m,k,\chi,\mf{a}}(z)$ with positive index are cusp forms. In a similar manner, we can obtain the Fourier series of the Eisenstein series too:
    
    \begin{proposition}\label{prop:Fourier_series_Eisenstein_holomorphic}
      Let $k \ge 4$, $\chi$ be Dirichlet character with conductor dividing the level, and $\mf{a}$ and $\mf{b}$ be cusps of $\GH$. The Fourier series of $E_{k,\chi,\mf{a}}(z)$ on $\GH$ at the $\mf{b}$ cusp is given by
      \[
        (E_{k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \sum_{t \ge 0}\left(\d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}}}\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}S_{\chi,\mf{a},\mf{b}}(0,t,c)\right)e^{2\pi itz}.
      \]
    \end{proposition}
    \begin{proof}
      From the cocycle condition, the Bruhat decomposition for $\s_{\mf{a}}^{-1}\G\s_{\mf{b}}$, and \cref{rem:Bruhat_modulo_infity_exact}, we have
      \[
        (E_{k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}, d \in \Z \\ d \tmod{c} \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(d)\frac{1}{(cz+d)^{k}},
      \]
      where $a$ has been determined modulo $c$ by $ad-bc = 1$ and we have used the fact that
      \[
        \frac{a}{c}-\frac{1}{c^{2}z+cd} = \frac{az+b}{cz+d}.
      \]
      Summing over all pairs $(c,d)$ with $c \in \mc{C}_{\mf{a},\mf{b}}$, $d \in \Z$, and $d \in \mc{D}_{\mf{a},\mf{b}}(c)$ is the same as summing over all triples $(c,\ell,r)$ with $c \in \mc{C}_{\mf{a},\mf{b}}$, $\ell \in \Z$, and $r$ taken modulo $c$ with $r \in \mc{D}_{\mf{a},\mf{b}}(c)$. Indeed, this is seen by writing $d = c\ell+r$. Moreover, since $ad-bc = 1$ we have $a(c\ell+r)-bc = 1$ which further implies that $ar \equiv 1 \tmod{c}$. So we may take $a$ to be the inverse for $r$ modulo $c$. Then
      \begin{align*}
        \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}, d \in \Z \\ d \tmod{c} \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(d)\frac{1}{(cz+d)^{k}} &= \sum_{(c,\ell,r)}\cchi(c\ell+r)\frac{1}{(cz+c\ell+r)^{k}} \\
        &= \sum_{(c,\ell,r)}\cchi(r)\frac{1}{(cz+c\ell+r)^{k}} \\
        &= \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}(c)}}\sum_{\ell \in \Z}\cchi(r)\frac{1}{(cz+c\ell+r)^{k}} \\
        &= \sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}(c)}}\cchi(r)\sum_{\ell \in \Z}\frac{1}{(cz+c\ell+r)^{k}},
      \end{align*}
      where on the right-hand side it is understood that we are summing over all triples $(c,\ell,r)$ with the prescribed properties and the second line holds since $\chi$ has conductor diving the level and $d \in \mc{D}_{\mf{a},\mf{b}}(c)$ is determined modulo $c$. Now let
      \[
        I_{c,r}(z) = \sum_{\ell \in \Z}\frac{1}{(cz+c\ell+r)^{k}}.
      \]
      We apply the Poisson summation formula to $I_{c,r}(z)$. This is allowed since the summands are absolutely integrable by \cref{prop:decay_unbounded_inteval_integral}, as they exhibit polynomial decay of order $k$, and $I_{c,r}(z)$ is holomorphic because $(E_{k,\chi,\mf{a}}|\s_{\mf{b}})(z)$ is. By the identity theorem it suffices to apply the Poisson summation formula for $z = iy$ with $y > 0$. So let $f(x)$ be given by
      \[
        f(x) = \frac{1}{(cx+r+icy)^{k}}.
      \]
      As we have just noted, $f(x)$ is absolutely integrable on $\R$. We compute the Fourier transform:
      \[
        \hat{f}(t) = \int_{-\infty}^{\infty}f(x)e^{-2\pi itx}\,dx = \int_{-\infty}^{\infty}\frac{e^{-2\pi itx}}{(cx+r+icy)^{k}}\,dx.
      \]
      Complexify the integral to get
      \[
        \int_{\Im(z) = 0}\frac{e^{-2\pi itz}}{(cz+r+icy)^{k}}\,dz.
      \]
      Now make the change of variables $z \to z-\frac{r}{c}-icy$ to obtain
      \[
        e^{2\pi it\frac{r}{c}-2\pi ty}\int_{\Im(z) = y}\frac{e^{-2\pi itz}}{(cz)^{k}}\,dz.
      \]
      The integrand is meromorphic with a pole at $z = 0$. Moreover, we have
      \[
        \frac{1}{(cz)^{k}} \ll \frac{1}{|cz|^{k}} \quad \text{and} \quad e^{-2\pi itz} \ll e^{2\pi ty}.
      \]
      The first expression has polynomial decay while the expression exhibits rapid decay if and only if $t < 0$ and when $t = 0$ it is bounded. So when $t \le 0$ we may take the limit as $\Im(z) \to \infty$ by shifting the line of integration and conclude that the integral vanishes. It remains to compute the integral for $t \ge 1$. To do this, make the change of variables $z \to -\frac{z}{2\pi it}$ to the last integral to rewrite it as
      \[
        -\frac{1}{2\pi it}\int_{(2\pi ty)}\frac{e^{z}}{\left(-\frac{cz}{2\pi it}\right)^{k}}\,dz = -\frac{1}{2\pi it}\int_{(2\pi ty)}\left(-\frac{2\pi it}{cz}\right)^{k}e^{z}\,dz = \frac{(-2\pi it)^{k-1}}{c^{k}}\int_{(2\pi ty)}\frac{e^{z}}{z^{k}}\,dz.
      \]
      The integrand of the last integral has a pole of order $k$ at $z = 0$. To find the residue, the Laurent series of $\frac{e^{z}}{z^{k}}$ is
      \[
        \frac{e^{z}}{z^{k}} = \sum_{n \ge 0}\frac{z^{n-k}}{n!},
      \]
      and thus the residue of the integrand is $\frac{1}{(k-1)!}$. In shifting the line of integration to $(-x)$, for some $x > 0$, we pass by this pole and obtain
      \[
        \frac{(-2\pi it)^{k}}{(k-1)!c^{k}}+\int_{(-x)}\frac{e^{z}}{z^{k}}\,dz.
      \]
      Moreover, we have
      \[
        \frac{1}{z^{k}} \ll \frac{1}{|z|^{k}} \quad \text{and} \quad e^{z} \ll e^{x}.
      \]
      The first expression has polynomial decay while the second expression exhibits rapid decay provided $x < 0$. Therefore we make take the limit as $x \to \infty$ by shifting the line of integration again and conclude that the latter integral vanishes. Altogether, we have show that
      \[
        \hat{f}(t) = \begin{cases} \left(\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}e^{2\pi it\frac{r}{c}}\right)e^{-2\pi ty} & \text{if $t \ge 1$}, \\ 0 & \text{if $t \le 0$}. \end{cases}
      \]
      By the Poisson summation formula and the identity theorem, we have
      \[
        I_{c,r}(z) = \sum_{t \ge 1}\left(\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}e^{2\pi it\frac{r}{c}}\right)e^{2\pi itz},
      \]
      for all $z \in \H$. Substituting this back into the Eisenstein series gives a form of the Fourier series:
      \begin{align*}
        (E_{k,\chi,\mf{a}}|\s_{\mf{b}})(z) &= \d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}}}\cchi(r)\sum_{t \ge 1}\left(\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}e^{2\pi it\frac{r}{c}}\right)e^{2\pi imz} \\
        &= \sum_{t \ge 0}\left(\d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}} \\ r \in \mc{D}_{\mf{a},\mf{b}}}}\cchi(r)\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}e^{2\pi it\frac{r}{c}}\right)e^{2\pi itz} \\
        &= \sum_{t \ge 0}\left(\d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}}}\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}\sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(r)e^{2\pi it\frac{r}{c}}\right)e^{2\pi itz}.
      \end{align*}
      We will simplify the innermost sum. Since $a$ is the inverse for $r$ modulo $c$, the innermost sum above becomes
      \[
        \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(r)e^{2\pi it\frac{r}{c}} = \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\cchi(\conj{a})e^{2\pi it\frac{\conj{a}}{c}} = \sum_{r \in \mc{D}_{\mf{a},\mf{b}}}\chi(a)e^{\frac{2\pi i\conj{a}t}{c}} = S_{\chi,\mf{a},\mf{b}}(0,t,c).
      \]
      So at last, we obtain our desired Fourier series:
      \[
        (E_{k,\chi,\mf{a}}|\s_{\mf{b}})(z) = \sum_{t \ge 0}\left(\d_{\mf{a},\mf{b}}+\sum_{\substack{c \in \mc{C}_{\mf{a},\mf{b}}}}\frac{(-2\pi it)^{k}}{(k-1)!c^{k}}S_{\chi,\mf{a},\mf{b}}(0,t,c)\right)e^{2\pi itz}.
      \]
    \end{proof}

    An interesting observation from \cref{prop:Fourier_series_Eisenstein_holomorphic} is that $E_{k,\chi,\mf{a}}|\s_{\mf{b}}$ is necessarily a cusp form unless $\mf{a} = \mf{b}$.
  \section{Inner Product Spaces of Holomorphic Forms}
    Let $\G$ be a congruence subgroup of level $N$. Let $\mc{M}_{k}(\G,\chi)$ denote the space of all weight $k$ holomorphic forms with character $\chi$ on $\GH$. Let $\mc{S}_{k}(\G,\chi)$ denote the associated subspace of cusp forms. Moreover, if the character $\chi$ is the trivial character, we will suppress the dependence upon $\chi$. If $\G_{1}$ and $\G_{2}$ are two congruence subgroups such that $\G_{1} \le \G_{2}$, then we have the inclusion
    \[
      \mc{M}_{k}(\G_{2},\chi) \subseteq \mc{M}_{k}(\G_{1},\chi).
    \]
    So in general, the smaller the congruence subgroup the more holomorphic forms there are. We will need a dimensionality result regarding the space of holomorphic forms of a fixed weight. However, it will suffice to only require the result for forms with trivial character. The result is that $\mc{M}_{k}(\G,\chi)$ is never too large (see \cite{diamond2005first} for a proof):

    \begin{theorem}\label{thm:modular_forms_finite_dimensional}
      $\mc{M}_{k}(\G,\chi)$ is finite dimensional.
    \end{theorem}

    Since $\mc{S}_{k}(\G,\chi)$ is a subspace of $\mc{M}_{k}(\G,\chi)$, \cref{thm:modular_forms_finite_dimensional} implies that $\mc{S}_{k}(\G,\chi)$ is also finite dimensional. It turns out that $\mc{S}_{k}(\G,\chi)$ is naturally an inner product space. For $f,g \in \mc{S}_{k}(\G,\chi)$, define their \textbf{Petersson inner product}\index{Petersson inner product} by
    \[
      \<f,g\>_{\G} = \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}f(z)\conj{g(z)}\Im(z)^{k}\,d\mu.
    \]
    If the congruence subgroup is clear from context we will suppress the dependence upon $\G$. Since $f$ and $g$ have rapid decay at the cusps, the integral is locally absolutely uniformly convergent by \cref{prop:decay_finite_volume_integral}. The integrand is also $\G$-invariant so that the integral independent of the choice of fundamental domain. These two facts together imply that the Petersson inner product is well-defined. We will continue to use this notation even if $f$ and $g$ do not belong to $\mc{S}_{k}(\G,\chi)$ provided the integral is locally absolutely uniformly convergent. A basic property of the Petersson inner product is that it is invariant with respect to the slash operator:

    \begin{proposition}\label{prop:Petersson_slash_invariance_holomorphic}
      For any $f,g \in \mc{S}_{k}(\G,\chi)$ and $\a \in \PSL_{2}(\Z)$, we have
      \[
        \<f|\a,g|\a\>_{\a^{-1}\G\a} = \<f,g\>_{\G}.
      \]
    \end{proposition}
    \begin{proof}
      This is just a computation:
      \begin{align*}
        \<f|\a,g|\a\>_{\a^{-1}\G\a} &= \frac{1}{V_{\a^{-1}\G\a}}\int_{\mc{F}_{\a^{-1}\G\a}}(f|\a)(z)\conj{(g|\a)(z)}\Im(z)^{k}\,d\mu \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\a^{-1}\G\a}}(f|\a)(z)\conj{(g|\a)(z)}\Im(z)^{k}\,d\mu && \text{\cref{lem:invariance_of_volume}} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\a^{-1}\G\a}}|j(\a,z)|^{-2k}f(\a z)\conj{g(\a z)}\Im(z)^{k}\,d\mu \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}|j(\a,z)|^{-2k}f(z)\conj{g(z)}\Im(\a z)^{k}\,d\mu && \text{$z \to \a^{-1}z$} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}f(z)\conj{g(z)}\Im(z)^{k}\,d\mu \\
        &= \<f,g\>_{\G}.
      \end{align*}
    \end{proof}

    More importantly, the Petersson inner product turns $\mc{S}_{k}(\G,\chi)$ into a Hilbert space:

    \begin{proposition}\label{prop:Petersson_inner_product_hermitian}
      $\mc{S}_{k}(\G,\chi)$ is a Hilbert space with respect to Petersson inner product.
    \end{proposition}
    \begin{proof}
      Let $f,g \in \mc{S}_{k}(\G,\chi)$. Linearity of the integral immediately implies that the Petersson inner product is linear on $\mc{S}_{k}(\G,\chi)$. It is also positive definite since
      \[
        \<f,f\> = \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}f(z)\conj{f(z)}\Im(z)^{k}\,d\mu = \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}|f(z)|^{2}\Im(z)^{k}\,d\mu \ge 0,
      \]
      with equality if and only if $f$ is identically zero. To see that it is conjugate symmetric, observe
      \begin{align*}
        \conj{\<g,f\>} &= \conj{\frac{1}{V_{\G}}\int_{\mc{F}_{\G}}g(z)\conj{f(z)}\Im(z)^{k}\,d\mu} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\conj{g(z)}f(z)\Im(z)^{k}\,\conj{d\mu} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\conj{g(z)}f(z)\Im(z)^{k}\,d\mu && \text{$d\mu = \frac{dx\,dy}{y^{2}}$} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}f(z)\conj{g(z)}\Im(z)^{k}\,d\mu \\
        &= \<f,g\>.
      \end{align*}
      So the Petersson inner product is a Hermitian inner product on $\mc{S}_{k}(\G,\chi)$. Since $\mc{S}_{k}(\G,\chi)$ is finite dimensional by \cref{thm:modular_forms_finite_dimensional}, it follows immediately that $\mc{S}_{k}(\G,\chi)$ is a Hilbert space.
    \end{proof}

    \begin{remark}\label{rem:non-degeneracy_of_Petersson_inner_product}
      As a consequence of \cref{prop:Petersson_inner_product_hermitian}, the Petersson inner product is also non-degenerate on $\mc{S}_{k}(\G,\chi)$. Actually, for the exact same reasoning this holds on $\mc{S}_{k}(\G,\chi) \x \mc{M}_{k}(\G,\chi)$ wherever the Petersson inner product is defined.
    \end{remark}

    Now suppose $f \in \mc{S}_{k}(\G,\chi)$ with Fourier coefficients $a_{n,\mf{a}}(f)$ at the $\mf{a}$ cusp. Define linear functionals $\phi_{m,k,\chi,\mf{a}}:\mc{S}_{k}(\G,\chi) \to \C$ by 
    \[
      \phi_{m,k,\chi,\mf{a}}(f) = a_{m,\mf{a}}(f).
    \]
    Since $\mc{S}_{k}(\G,\chi)$ is a finite dimensional Hilbert space, the Riesz representation theorem implies that there exists unique $v_{m,k,\chi,\mf{a}}(z) \in \mc{S}_{k}(\G,\chi)$ such that
    \[
      \<f,v_{m,k,\chi,\mf{a}}\> = \phi_{m,k,\chi,\mf{a}}(f) = a_{m,\mf{a}}(f),
    \]
    We would like to know what these cusp forms are. It turns out that $v_{m,k,\chi,\mf{a}}(z)$ will be the Poincar\'e series $P_{m,k,\chi,\mf{a}}(z)$ of positive index up to a normalization factor. To see this, we compute the following inner product:
    \begin{align*}
      \<f,P_{m,k,\chi,\mf{a}}\> &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}f(z)\conj{P_{m,k,\chi,\mf{a}}(z)}\Im(z)^{k}\,d\mu \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\sum_{\g \in \G_{\a}\backslash\G}\chi(\g)\conj{j(\s_{\mf{a}}^{-1}\g,z)^{-k}}f(z)e^{-2\pi im\conj{\s_{\mf{a}}^{-1}\g z}}\Im(z)^{k}\,d\mu \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\sum_{\g \in \G_{\a}\backslash\G}\chi(\g)j(\s_{\mf{a}}^{-1}\g,z)^{k}f(z)e^{-2\pi im\conj{\s_{\mf{a}}^{-1}\g z}}\Im(\s_{\mf{a}}^{-1}\g z)^{k}\,d\mu \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\sum_{\g \in \G_{\a}\backslash\G}\left(\frac{j(\s_{\mf{a}}^{-1}\g,z)}{j(\g,z)}\right)^{k}f(\g z)e^{-2\pi im\conj{\s_{\mf{a}}^{-1}\g z}}\Im(\s_{\mf{a}}^{-1}\g z)^{k}\,d\mu && \text{modularity} \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\sum_{\g \in \G_{\a}\backslash\G}j(\s_{\mf{a}},\s_{\mf{a}}^{-1}\g z)^{-k}f(\g z)e^{-2\pi im\conj{\s_{\mf{a}}^{-1}\g z}}\Im(\s_{\mf{a}}^{-1}\g z)^{k}\,d\mu && \text{cocycle condition} \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}}\sum_{\g \in \G_{\a}\backslash\G}j(\s_{\mf{a}},\s_{\mf{a}}^{-1}\g\s_{\mf{a}}z)^{-k}f(\g\s_{\mf{a}}z)e^{-2\pi im\conj{\s_{\mf{a}}^{-1}\g\s_{\mf{a}}z}}\Im(\s_{\mf{a}}^{-1}\g\s_{\mf{a}}z)^{k}\,d\mu && \text{$z \to \s_{\mf{a}}z$} \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}}\sum_{\g \in \G_{\infty}\backslash\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}j(\s_{\mf{a}},\g z)^{-k}f(\s_{\mf{a}}\g z)e^{-2\pi im\conj{\g z}}\Im(\g z)^{k}\,d\mu && \text{$\g \to \s_{\mf{a}}\g\s_{\mf{a}}^{-1}$} \\
      &= \frac{1}{V_{\G}}\int_{\mc{F}_{\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}}\sum_{\g \in \G_{\infty}\backslash\s_{\mf{a}}^{-1}\G\s_{\mf{a}}}(f|\s_{\mf{a}})(\g z)e^{-2\pi im\conj{\g z}}\Im(\g z)^{k}\,d\mu && \\
      &= \frac{1}{V_{\G}}\int_{\G_{\infty}\backslash\H}(f|\s_{\mf{a}})(z)e^{-2\pi im\conj{z}}\Im(z)^{k}\,d\mu && \text{unfolding.}
    \end{align*}
    Substituting in the Fourier series of $f$ at the $\mf{a}$ cusp, we can finish the computation:
    \begin{align*}
       \frac{1}{V_{\G}}\int_{\G_{\infty}\backslash\H}(f|\s_{\mf{a}})(z)e^{-2\pi im\conj{z}}\Im(z)^{k}\,d\mu &= \frac{1}{V_{\G}}\int_{0}^{\infty}\int_{0}^{1}\sum_{n \ge 1}a_{n,\mf{a}}(f)e^{2\pi i(n-m)x}e^{-2\pi(n+m)y}y^{k}\,\frac{dx\,dy}{y^{2}} \\
      &= \frac{1}{V_{\G}}\int_{0}^{\infty}\sum_{n \ge 1}\int_{0}^{1}a_{n,\mf{a}}(f)e^{2\pi i(n-m)x}e^{-2\pi(n+m)y}y^{k}\,\frac{dx\,dy}{y^{2}} && \text{DCT} \\
      &= \frac{1}{V_{\G}}\int_{0}^{\infty}a_{m,\mf{a}}(f)e^{-4\pi my}y^{k}\,\frac{dy}{y^{2}},
    \end{align*}
    where the last line follows because
    \begin{equation}\label{equ:Dirac_integral_representation}
      \int_{0}^{1}e^{2\pi i(n-m)x}\,dx = \d_{n-m,0},
    \end{equation}
    so that the inner integral cuts off all the terms except the diagonal $n = m$. Then
    \begin{align*}
      \frac{1}{V_{\G}}\int_{0}^{\infty}a_{m,\mf{a}}(f)e^{-4\pi my}y^{k}\,\frac{dy}{y^{2}} &= \frac{a_{m,\mf{a}}(f)}{V_{\G}}\int_{0}^{\infty}e^{-4\pi my}y^{k-1}\,\frac{dy}{y} \\
      &= \frac{a_{m,\mf{a}}(f)}{V_{\G}}\int_{0}^{\infty}e^{-4\pi my}y^{k-1}\,\frac{dy}{y} && \text{$y \to \frac{y}{4\pi m}$} \\
      &= \frac{a_{m,\mf{a}}(f)}{V_{\G}(4\pi m)^{k-1}}\int_{0}^{\infty}e^{-y}y^{k-1}\,\frac{dy}{y} \\
      &= \frac{\G(k-1)}{V_{\G}(4\pi m)^{k-1}}a_{m,\mf{a}}(f) && \text{definition of $\G(k-1)$.}
    \end{align*}
    In conclusion,
    \begin{equation}\label{equ:Petersson_inner_product_with_Poincare_series}
      \<f,P_{m,k,\chi,\mf{a}}\> = \frac{\G(k-1)}{V_{\G}(4\pi m)^{k-1}}a_{m,\mf{a}}(f),
    \end{equation}
    and it follows that
    \[
      v_{m,k,\chi,\mf{a}}(z) = \frac{V_{\G}(4\pi m)^{k-1}}{\G(k-1)}P_{m,k,\chi,\mf{a}}(z).
    \]
    We will work with the Poincar\'e series $P_{m,k,\chi,\mf{a}}(z)$ instead of their normalized counterparts $v_{m,k,\chi,\mf{a}}(z)$. In any case, with \cref{equ:Petersson_inner_product_with_Poincare_series} in hand we can prove the following result:

    \begin{theorem}
      The Poincar\'e series of positive index span $\mc{S}_{k}(\G,\chi)$.
    \end{theorem}
    \begin{proof}
      Let $f \in \mc{S}_{k}(\G,\chi)$ with Fourier coefficients $a_{n,\mf{a}}(f)$ at the $\mf{a}$ cusp. Since $\G(k-1) \neq 0$, \cref{equ:Petersson_inner_product_with_Poincare_series} implies $\<f,P_{m,k,\chi,\mf{a}}\> = 0$ if and only if $a_{m,\mf{a}}(f) = 0$. So $f$ is orthogonal to all the Poincar\'e series $P_{m,k,\chi,\mf{a}}$ of positive index if and only if every Fourier coefficient $a_{m,\mf{a}}(f)$ is zero. But this happens if and only if $f$ is identically zero.
    \end{proof}
  \section{Double Coset Operators}
    We are ready to introduce a class of general operators, depending upon double cosets, on a congruence subgroup $\G$ of level $N$. We will use these operators to define the diamond and Hecke operators. For $\a \in \GL_{2}^{+}(\Q)$, consider the double coset
    \[
      \G_{1}\a\G_{2} = \{\g_{1}\a\g_{2}:\text{$\g_{1} \in \G_{1}$ and $\g_{2} \in \G_{2}$}\}.
    \]
    Then $\G_{1}$ acts on the set $\G_{1}\a\G_{2}$ by left multiplication so that it decomposes into a disjoin union of orbit spaces. Thus
    \[
      \G_{1}\a\G_{2} = \bigcup_{\b \in \G_{1}\backslash\G_{1}\a\G_{2}}\G_{1}\b,
    \]
    where the sum is over the orbit representatives $\b$. However, in order for these operators to be well-defined it is necessary that the orbit decomposition above is a finite union. This is indeed the case and we will require a lemma which gives a way to describe the orbit representatives for $\G_{1}\a\G_{2}$ in terms of coset representatives:

    \begin{lemma}\label{lem:coset_lemma_2}
      Let $\G_{1}$ and $\G_{2}$ be congruence subgroups and let let $\a \in \GL_{2}^{+}(\Q)$. Set $\G_{3} = \a^{-1}\G_{1}\a \cap \G_{2}$. Then left multiplication map
      \[
        \G_{2} \to \G_{1}\a\G_{2} \qquad \g_{2} \mapsto \a\g_{2},
      \]
      induces a bijection from the coset space $\G_{3}\backslash\G_{2}$ to the orbit space $\G_{1}\backslash\G_{1}\a\G_{2}$.
    \end{lemma}
    \begin{proof}
      We will show that the induced map is both surjective and injective. For surjectivity, the orbit representatives $\b$ of $\G_{1}\backslash\G_{1}\a\G_{2}$ are of the form $\b = \g_{1}\a\g_{2}$ for some $\g_{1} \in \G_{1}$ and $\g_{2} \in \G_{2}$. Since $\G_{1}$ is acting on $\G_{1}\a\G_{2}$ by left multiplication, $\b$ can be written as $\b = \a\g'_{2}$ for some $\g'_{2} \in \G_{2}$. This shows that the induced map is a surjection. To prove injectivity, let $\g_{2},\g'_{2} \in \G_{2}$ be such that the orbit space representatives $\a\g_{2}$ and $\a\g'_{2}$ are equivalent. That is,
      \[
        \G_{1}\a\g_{2} = \G_{1}\a\g'_{2}.
      \]
      This implies $\a\g_{2}(\g'_{2})^{-1} \in \G_{1}\a$ and so $\g_{2}(\g'_{2})^{-1} \in \a^{-1}\G_{1}\a$. But we also have $\g_{2}(\g'_{2})^{-1} \in \G_{2}$ and these two facts together imply $\g_{2}(\g'_{2})^{-1} \in \G_{3}$. Hence
      \[
        \G_{3}\g_{2} = \G_{3}\g'_{2},
      \]
      which shows that the induced map is also an injection.
    \end{proof}

    With this lemma in hand, we can prove that the orbit decomposition of $\G_{1}\a\G_{2}$ is finite:

    \begin{proposition}\label{prop:double_congruence_subgroup_coset_decomposition_is_finite}
      Let $\a \in \GL_{2}^{+}(\Q)$. Then the orbit decomposition
      \[
        \G_{1}\a\G_{2} = \bigcup_{j}\G_{1}\b_{j},
      \]
      with respect to the action of $\G_{1}$ by left multiplication, is a finite union.
    \end{proposition}
    \begin{proof}
      Let $\G_{3} = \a\G_{1}\a^{-1} \cap \G_{2}$. Then $\G_{3}$ acts on $\G_{2}$ by left multiplication. By \cref{lem:coset_lemma_2}, the number of orbits of $\G_{1}\backslash\G_{1}\a\G_{2}$ is the same as the number of cosets of $\G_{3}\backslash\G_{2}$ which is $[\G_{2}:\G_{3}]$. By \cref{lem:coset_lemma_1}, $\a^{-1}\G_{1}\a \cap \PSL_{2}(\Z)$ is a congruence subgroup and hence $[\PSL_{2}(\Z):\a^{-1}\G_{1}\a \cap \PSL_{2}(\Z)]$ is finite. As $\G_{2} = \PSL_{2}(\Z) \cap \G_{2}$ and $\G_{3} = \a^{-1}\G_{1}\a \cap \PSL_{2}(\Z) \cap \G_{2}$, it follows that $[\G_{2}:\G_{3}] \le [\PSL_{2}(\Z):\a^{-1}\G_{1}\a \cap \PSL_{2}(\Z)]$ completing the proof.
    \end{proof}

    In light of \cref{prop:double_congruence_subgroup_coset_decomposition_is_finite}, we will denote the orbit representatives by $\b_{j}$ to make it clear that there are finitely many. We can now introduce our operators. Fix some congruence subgroup $\G$ and consider $\mc{M}_{k}(\G)$. Then for $\a \in \GL_{2}^{+}(\Q)$, we define the operator $[\a]_{k}$ on $\mc{M}_{k}(\G)$ to be the linear operator given by
    \[
      (f[\a]_{k})(z) = \det(\a)^{k-1}j(\a,z)^{-k}f(\a z),
    \]
    Moreover, $[\a]_{k}$ is multiplicative. Indeed, if $\a,\a' \in \GL_{2}^{+}(\Q)$, then
    \begin{align*}
      ((f[\a']_{k})[\a]_{k})(z) &= \det(\a)^{k-1}j(\a,z)^{-k}(f[\a']_{k})(\a z) \\
      &= \det(\a')^{k-1}\det(\a)^{k-1}j(\a',\a z)^{-k}j(\a,z)^{-k}f(\a'\a z) \\
      &= \det(\a'\a)^{k-1}j(\a'\a,z)^{-k}f(\a'\a z) && \text{cocycle condition} \\
      &= (f[\a'\a]_{k})(z).
    \end{align*}
    Also, if $\g \in \G$ and we choose the representative with $\det(\g) = 1$, then the chain of equalities
    \[
      (f[\g]_{k})(z) = j(\g,z)^{-k}f(\g z) = \chi(\g)f(z),
    \]
    is equivalent to the modularity of $f$ with character $\chi$ on $\GH$. Thus $f$ is holomorphic form with trivial character on $\GH$ if and only if $f[\g]_{k} = f$ for all $\g \in \G$ where $\g$ is chosen to be the representative with positive determinant. Now let $\G_{1}$ and $\G_{2}$ be two congruence subgroups and let $\a \in \GL_{2}^{+}(\Q)$. We define the \textbf{double coset operator}\index{double coset operator} $[\G_{1}\a\G_{2}]_{k}$ on $\mc{M}_{k}(\G_{1})$ to be the linear operator given by
    \[
      (f[\G_{1}\a\G_{2}]_{k})(z) = \sum_{j}(f[\b_{j}]_{k})(z) = \sum_{j}\det(\b_{j})^{k-1}j(\b_{j},z)^{-k}f(\b_{j}z),
    \]
    By \cref{prop:double_congruence_subgroup_coset_decomposition_is_finite} this sum is finite. It remains to check that $f[\G_{1}\a\G_{2}]_{k}$ is well-defined. Indeed, if $\b_{j}$ and $\b_{j}'$ belong to the same orbit, then $\b_{j}'\b_{j}^{-1} \in \G_{1}$. But then as $f \in \mc{M}_{k}(\G_{1})$, is it invariant under the $[\b_{j}'\b_{j}^{-1}]_{k}$ operator so that
    \[
      (f[\b_{j}]_{k})(z) = ((f[\b_{j}'\b_{j}^{-1}]_{k})[\b_{j}]_{k})(z) = (f[\b_{j}']_{k})(z),
    \]
    and therefore the $[\G_{1}\a\G_{2}]_{k}$ operator is well-defined. Actually, the map $[\G_{1}\a\G_{2}]_{k}$ preserves holomorphic forms:

    \begin{proposition}\label{prop:double_coset_operator_preserves_subspaces_holomorphic}
      For any two congruence subgroups $\G_{1}$ and $\G_{2}$, $[\G_{1}\a\G_{2}]_{k}$ maps $\mc{M}_{k}(\G_{1})$ into $\mc{M}_{k}(\G_{2})$. Moreover, $[\G_{1}\a\G_{2}]_{k}$ preserves the subspace of cusp forms.
    \end{proposition}
    \begin{proof}
      Holomorphy is immediate since the sum in the definition of $f[\G_{1}\a\G_{2}]_{k}$ is finite by \cref{prop:double_congruence_subgroup_coset_decomposition_is_finite}. For modularity, let $\g \in \G_{2}$. Then
      \begin{align*}
        (f[\G_{1}\a\G_{2}]_{k})(\g z) &= \sum_{j}\det(\b_{j})^{k-1}j(\b_{j},\g z)^{-k}f(\b_{j}\g z) \\
        &= \sum_{j}\det(\b_{j}\g)^{k-1}j(\b_{j},\g z)^{-k}f(\b_{j}\g z) && \text{$\det(\g) = 1$} \\
        &= \sum_{j}\det(\b_{j}\g)^{k-1}\left(\frac{j(\g,z)}{j(\b_{j}\g,z)}\right)^{k}f(\b_{j}\g z) && \text{cocycle condition} \\
        &= j(\g,z)^{k}\sum_{j}\det(\b_{j}\g)^{k-1}j(\b_{j}\g,z)^{-k}f(\b_{j}\g z) \\
        &= j(\g,z)^{k}\sum_{j}\det(\b_{j})^{k-1}j(\b_{j},z)^{-k}f(\b_{j}z) && \text{$\b_{j} \to \b_{j}\g^{-1}$} \\
        &= j(\g,z)^{k}\sum_{j}(f[\b_{j}]_{k})(z) \\
        &= j(\g,z)^{k}(f[\G_{1}\a\G_{2}]_{k})(z).
      \end{align*}
      This proves the modularity of $f[\G_{1}\a\G_{2}]_{k}$. For the growth condition, let $\s_{\mf{a}}$ be a scaling matrix for the cusp $\mf{a}$ of $\G_{2}\backslash\H$. For any orbit representative $\b_{j}$, $\b_{j}\s_{\mf{a}}$ takes $\infty$ to an element of $\Q \cup \{\infty\}$ since $\b_{j} \in \GL_{2}^{+}(\Q)$. In other words, $\b_{j}\s_{\mf{a}}\infty = \mf{b}$ for some cusp $\mf{b}$ of $\G_{1}\backslash\H$. Then by the cocycle condition, we have
      \[
        j(\s_{\mf{a}},z)^{-k}(f[\G_{1}\a\G_{2}]_{k})(\s_{\mf{a}}z) = \sum_{j}\det(\b_{j})^{k-1}j(\b_{j}\s_{\mf{a}},z)^{-k}f(\b_{j}\s_{\mf{a}}z),
      \]
      and the growth condition follows from that of $f$. Therefore $f[\G_{1}\a\G_{2}]_{k} \in \mc{M}_{k}(\G_{2})$. Lastly, it is clear that $f[\G_{1}\a\G_{2}]_{k}$ is a cusp form if $f$ is. Therefore $[\G_{1}\a\G_{2}]_{k}$ preserves the subspace of cusp forms.
    \end{proof}

    The double coset operators are the most basic types of operators on holomorphic forms. They are the building blocks needed to define the more important diamond and Hecke operators.
  \section{Diamond \& Hecke Operators}
    The diamond and Hecke operators are special linear operators that are used to construct a linear theory of holomorphic forms. They will also help us understand the Fourier coefficients. Throughout this discussion, we will obtain corresponding results for holomorphic forms with nontrivial characters. We will discuss the diamond operator first. To define them, we need to consider both the congruence subgroups $\G_{1}(N)$ and $\G_{0}(N)$. Recall that $\G_{1}(N) \le \G_{0}(N)$ and consider the map
    \[
      \G_{0}(N) \to (\Z/N\Z)^{\ast} \qquad \begin{pmatrix} a & b \\ c & d\end{pmatrix} \to d \tmod{N},
    \]
    ($d$ is invertible modulo $N$ since $c \equiv 0 \tmod{N}$ and $ad-bc = 1$). This is a surjective homomorphism and its kernel is exactly $\G_{1}(N)$ so that $\G_{1}(N)$ is a normal subgroup of $\G_{0}(N)$ and $\G_{0}(N)/\G_{1}(N) \cong (\Z/N\Z)^{\ast}$. Letting $\a = \begin{psmallmatrix} \ast & \ast \\ \ast & d \end{psmallmatrix} \in \G_{0}(N)$ and $f \in \mc{M}_{k}(\G_{1})$, consider $\left(f\left[\G_{1}(N)\a\G_{1}(N)\right]_{k}\right)(z)$. This is only dependent upon the lower-right entry $d$ of $\a$ taken modulo $N$. To see this, since $\G_{1}(N)$ is normal in $\G_{0}(N)$, $\G_{1}(N)\a = \a\G_{1}(N)$ so that $\G_{1}(N)\a\G_{1}(N) = \a\G_{1}(N)$ and hence there is only one representative for the orbit decomposition. Therefore
    \[
      \left(f\left[\G_{1}(N)\a\G_{1}(N)\right]_{k}\right)(z) = \sum_{j}(f[\b]_{k})(z) = (f[\a]_{k})(z).
    \]
    This induces an action of $\G_{0}(N)$ on $\mc{M}_{k}(\G_{1})$ and since $\G_{1}(N)$ acts trivially, this is really an action of $\G_{0}(N)/\G_{1}(N) \cong (\Z/N\Z)^{\ast}$. In other words, we have an induced action that depends only upon the lower-right entry $d$ of $\a$ taken modulo $N$. So for any $d$ modulo $N$, we define the \textbf{diamond operator}\index{diamond operator} $\<d\>:\mc{M}_{k}(\G_{1}(N)) \to \mc{M}_{k}(\G_{1}(N))$ to be the linear operator given by
    \[
      (\<d\>f)(z) = (f[\a]_{k})(z),
    \]
    for any $\a = \begin{psmallmatrix} \ast & \ast \\ \ast & d \end{psmallmatrix} \in \G_{0}(N)$. Our discussion above has already shown that the diamond operators $\<d\>$ are well-defined. Moreover, the diamond operators are also invertible with $\<\conj{d}\>$ serving as an inverse and $\a^{-1}$ as a representative for the definition. Also, since the operator $[\a]_{k}$ is multiplicative and
    \[
      \begin{pmatrix} \ast & \ast \\ 0 & d \end{pmatrix}\begin{pmatrix} \ast & \ast \\ 0 & e \end{pmatrix} \equiv \begin{pmatrix} \ast & \ast \\ 0 & de \end{pmatrix} \tmod{N},
    \]
    the diamond operators are multiplicative. One reason the diamond operators are useful is that they decompose $\mc{M}_{k}(\G_{1}(N))$ into eigenspaces. For any Dirichlet character $\chi$ modulo $N$, we let
    \[
      \mc{M}_{k}(N,\chi) = \{f \in \mc{M}_{k}(\G_{1}(N)):\text{$\<d\>f = \chi(d)f$ for all $d \in (\Z/N\Z)^{\ast}$}\},
    \]
    be the $\chi$-eigenspace. Also let $\mc{S}_{k}(N,\chi)$ be the corresponding subspace of cusp forms. Then $\mc{M}_{k}(\G_{1}(N))$ admits a decomposition into these eigenspaces:

    \begin{proposition}\label{thm:diamond_operator_decomposition_holomorphic}
      We have a direct sum decomposition
      \[
        \mc{M}_{k}(\G_{1}(N)) = \bigop_{\chi \tmod{N}}\mc{M}_{k}(N,\chi).
      \]
      Moreover, this decomposition respects the subspace of cusp forms.
    \end{proposition}
    \begin{proof}
      The diamond operators give a representation of $\G_{0}(N)/\G_{1}(N) \cong (\Z/N\Z)^{\ast}$ over $\mc{M}_{k}(\G_{1}(N))$. Explicitly,
      \[
        \Phi:(\Z/N\Z)^{\ast} \x \mc{M}_{k}(\G_{1}(N)) \to \mc{M}_{k}(\G_{1}(N)) \qquad (d,f) \to \<d\>f.
      \]
      But any representation of a finite abelian group over $\C$ is completely reducible with respect to the characters of the group and every irreducible subrepresentation is $1$-dimensional (see \cref{thm:finite_abelian_representation_is_completely_reducible}). Since the characters of $(\Z/N\Z)^{\ast}$ are given by Dirichlet characters, the decomposition as a direct sum follows. The decomposition respects the subspace of cusp forms because the double coset operators do.
    \end{proof}
    
    If $\g = \begin{psmallmatrix} \ast & \ast \\ \ast & d \end{psmallmatrix} \in \G_{0}(N)$ and we choose the representative with positive determinant, then $\chi(\g) = \chi(d)$ and the chain of equalities
    \[
      (\<d\>f)(z) = (f[\g]_{k})(z) = j(\g,z)^{-k}f(\g z) = \chi(d)f(z),
    \]
    is equivalent to the modularity of $f$ with character $\chi$ on $\G_{0}(N)\backslash\H$. Thus $f$ is a holomorphic form with character $\chi$ on $\G_{0}(N)\backslash\H$ if and only if $f[\g]_{k} = \chi(\g)f$ for all $\g \in \G_{0}(N)$ where $\g$ is chosen to be the representative with positive determinant. It follows that the diamond operators sieve holomorphic forms on $\G_{1}(N)\backslash\H$ with trivial character in terms of holomorphic forms on $\G_{0}(N)\backslash\H$ with nontrivial characters. In particular, $\mc{M}_{k}(N,\chi) = \mc{M}_{k}(\G_{0}(N),\chi)$ and $\mc{S}_{k}(N,\chi) = \mc{S}_{k}(\G_{0}(N),\chi)$. So by \cref{thm:diamond_operator_decomposition_holomorphic}, we have
    \[
      \mc{M}_{k}(\G_{1}(N)) = \bigop_{\chi \tmod{N}}\mc{M}_{k}(\G_{0}(N),\chi),
    \]
    and this decomposition respects the subspace of cusp forms. This fact clarifies why it is necessary to consider holomorphic forms with nontrivial characters. Now it is time to define the Hecke operators. For a prime $p$, we define the $p$-th \textbf{Hecke operator}\index{Hecke operator} $T_{p}:\mc{M}_{k}(\G_{1}(N)) \to \mc{M}_{k}(\G_{1}(N))$ to be the linear operator given by
    \[
      (T_{p}f)(z) = \left(\left[\G_{1}(N)\begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\G_{1}(N)\right]_{k}f\right)(z).
    \]
    By \cref{prop:double_coset_operator_preserves_subspaces_holomorphic}, $T_{p}$ preserves the subspace of cusp forms. We will start discussing properties of the diamond and Hecke operators, but we first state an important lemma that will be used throughout (see \cite{diamond2005first} for a proof):

    \begin{lemma}\label{lem:cosets_for_Hecke_operators}
      Let $p$ be a prime. As sets,
      \[
        \G_{1}(N)\begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\G_{1}(N) = \left\{\g \in \Mat_{2}(\Z):\text{$\g \equiv \begin{pmatrix} 1 & \ast \\ 0 & p \end{pmatrix} \tmod{N}$ and $\det(\g) = p$}\right\}.
      \]
    \end{lemma}
    
    With \cref{lem:cosets_for_Hecke_operators}, it is not too hard to see that the diamond and Hecke operators commute:

    \begin{proposition}\label{prop:diamond_Hecke_operators_commute_holomorphic}
      For every $d \in (\Z/N\Z)^{\ast}$ and prime $p$, the diamond operator $\<d\>$ and the Hecke operator $T_{p}$ on $\mc{M}_{k}(\G_{1}(N))$ commute:
      \[
        \<d\>T_{p} = T_{p}\<d\>
      \]
    \end{proposition}
    \begin{proof}
      Let $\a = \begin{psmallmatrix} 1 & 0 \\ 0 & p \end{psmallmatrix}$. For $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{0}(N)$, we have
      \[
        \g\a\g^{-1} \equiv \begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\begin{pmatrix} d & -b \\ -c & a \end{pmatrix} = \begin{pmatrix} 1 & (p-1)ab \\ 0 & p \end{pmatrix} \tmod{N},
      \]
      because $c \equiv 0 \tmod{N}$, $ad-bc = 1$, and $ad \equiv {1} \tmod{N}$. By \cref{lem:cosets_for_Hecke_operators}, $\g\a\g^{-1} \in \G_{1}(N)\a\G_{1}(N)$ and so we can use this representative in place of $\a$. On the one hand,
      \[
        \G_{1}(N)\a\G_{1}(N) = \bigcup_{j}\G_{1}(N)\b_{j}.
      \]
      On the other hand, using $\g\a\g^{-1}$ in place of $\a$ and the normality of $\G_{1}(N)$ in $\G_{0}(N)$, we have
      \[
        \G_{1}(N)\a\G_{1}(N) = \G_{1}(N)\g\a\g^{-1}\G_{1}(N) = \g\G_{1}(N)\a\G_{1}(N)\g^{-1} = \g\bigcup_{j}\G_{1}(N)\b_{j}\g^{-1} = \bigcup_{j}\G_{1}(N)\g\b_{j}\g^{-1}.
      \]
      Upon comparing these two decompositions of $\G_{1}(N)\a\G_{1}(N)$ gives
      \[
        \bigcup_{j}\G_{1}(N)\b_{j} = \bigcup_{j}\G_{1}(N)\g\b_{j}\g^{-1}.
      \]
      Now let $f \in \mc{M}_{k}(\G_{1}(N))$. Then this equivalence of unions implies
      \[
      \<d\>T_{p}f = \sum_{j}f[\b_{j}\g]_{k} = \sum_{j}f[\g\b_{j}]_{k} = T_{p}\<d\>f.
      \]
    \end{proof}
    
    Using \cref{lem:cosets_for_Hecke_operators} we can obtain an explicit description of the Hecke operator $T_{p}$:

    \begin{proposition}\label{prop:explicit_description_of_Hecke_operators_holomorphic}
      Let $f \in \mc{M}_{k}(\G_{1}(N))$. Then the Hecke operator $T_{p}$ acts on $f$ as follows:
      \[
        (T_{p}f)(z) = \begin{cases} \displaystyle{\sum_{j \tmod{p}}}\left(f\left[\begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix}\right]_{k}\right)(z)+\left(f\left[\begin{pmatrix} m & n \\ N & p \end{pmatrix}\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix}\right]_{k}\right)(z) & \text{if $p \nmid N$}, \\ \displaystyle{\sum_{j \tmod{p}}}\left(f\left[\begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix}\right]_{k}\right)(z) & \text{if $p \mid N$}, \end{cases}
      \]
      where $m$ and $n$ are chosen such that $\det\left(\begin{psmallmatrix} m & n \\ N & p \end{psmallmatrix}\right) = 1$.
    \end{proposition}
    \begin{proof}
      Set $\G_{3} = \a^{1}\G_{1}(N)\a \cap \G_{1}(N)$ where $\a = \begin{psmallmatrix} 1 & 0 \\ 0 & p \end{psmallmatrix}$. Define
      \[
        \b_{j} = \begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix} \quad \text{and} \quad \b_{\infty} = \begin{pmatrix} m & n \\ N & p \end{pmatrix}\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} pm & n \\ Np & p \end{pmatrix},
      \]
      for $j$ taken modulo $p$ and where where $m$ and $n$ are chosen such that $\det\left(\begin{psmallmatrix} m & n \\ N & p \end{psmallmatrix}\right) = 1$. It suffices to show $\{\b_{1},\ldots,\b_{p-1}\}$ and $\{\b_{1},\ldots,\b_{p-1},\b_{\infty}\}$ are complete sets of orbit representatives for $\G_{1}(N)\backslash\G_{1}(N)\a\G_{1}(N)$ depending on if $p \nmid N$ or not. To accomplish this, we will find a complete set of coset representatives for $\G_{3}\backslash\G_{1}(N)$ and then use \cref{lem:coset_lemma_2}. First we require an explicit description of $\G_{3}$. Let
      \[
        \G^{0}(p) = \left\{\begin{pmatrix} a & b \\ c & d \end{pmatrix} \in \PSL_{2}(\Z):\begin{pmatrix} a & b \\ c & d \end{pmatrix} \equiv \begin{pmatrix} \ast & 0 \\ \ast & \ast \end{pmatrix} \tmod{p}\right\},
      \]
      and define
      \[
        \G_{1}^{0}(N,p) = \G_{1}(N) \cap \G^{0}(p).
      \]
      We claim $\G_{3} = \G_{1}^{0}(N,p)$. For the forward inclusion, let $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{1}(N)$ and observe that
      \[
        \a^{-1}\g\a = \begin{pmatrix} 1 & 0 \\ 0 & p^{-1} \end{pmatrix}\begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix} = \begin{pmatrix} a & pd \\ p^{-1}c & d \end{pmatrix}.
      \]
      If $\a^{-1}\g\a \in \G_{3}$, then $\a^{-1}\g\a \in \G_{1}(N)$ and thus $p \mid c$ so that $\a^{-1}\g\a \in \PSL_{2}(\Z)$. Moreover, the previous computation implies $\a^{-1}\g\a \in \G_{1}^{0}(N,p)$ and so $\G_{3} \subseteq \G_{1}^{0}(N,p)$. For the reverse inclusion, suppose $\begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{0}^{1}(N,p)$. Then $b = pk$ for some $k \in \Z$. Now observe
      \[
        \begin{pmatrix} a & b \\ c & d \end{pmatrix} = \begin{pmatrix} 1 & 0 \\ 0 & p^{-1} \end{pmatrix}\begin{pmatrix} a & k \\ pc & d \end{pmatrix}\begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix} = \a^{-1}\g\a,
      \]
      where $\g = \begin{psmallmatrix} a & k \\ pc & d \end{psmallmatrix}$. As $\begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{1}(N)$ we conclude $\g \in \G_{1}(N)$ as well. Now let
      \[
        \a_{j} = \begin{pmatrix} 1 & j \\ 0 & 1 \end{pmatrix} \quad \text{and} \quad \a_{\infty} = \begin{pmatrix} pm & n \\ N & 1 \end{pmatrix},
      \]
      for $j$ taken modulo $p$ and where $m$ and $n$ are as before. Clearly $\a_{j} \in \G_{1}(N)$ for all $j$. As $pm-Nn = 1$, we have $pm \equiv 1 \tmod{N}$ so that $\a_{\infty} \in \G_{1}(N)$ as well. We claim that $\{\a_{1},\ldots,\a_{p-1}\}$ and $\{\a_{1},\ldots,\a_{p-1},\a_{\infty}\}$ are sets of coset representatives for $\G_{3}\backslash\G_{1}(N)$ depending on if $p \nmid N$ or not. Let $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{1}(N)$ and consider
      \[
        \g\a_{j}^{-1} = \begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} 1 & -j \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} a & b-aj \\ c & d-cj \end{pmatrix}.
      \]
      As $\g\a_{j}^{-1} \in \G_{1}(N)$ because both $\g$ and $\g_{i}$ are, $\g\a_{j}^{-1} \in \G_{3} = \G_{1}^{0}(N,p)$ for some $i$ if and only if
      \[
        b \equiv aj \tmod{p}.
      \]
      First suppose $p \nmid a$. Then $a$ is invertible modulo $p$ so we may take $j = \conj{a}b \tmod{p}$. Now suppose $p \mid a$. If there is some $i$ satisfying $b \equiv ai \tmod{p}$, then we also have $p \mid b$. But as $ad-bc = 1$, this is impossible and so no such $i$ exists. As $a \equiv 1 \tmod{N}$, $p \mid a$ if and only if $p \nmid N$. In this case consider instead
      \[
        \g\a_{\infty}^{-1} = \begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} 1 & -n \\ -N & pm \end{pmatrix} = \begin{pmatrix} a-Nb & pmb-na \\ c-Nd & pmd-nc \end{pmatrix}.
      \]
      Since $p \mid a$, we have $pmb-na \equiv 0 \mod{p}$ so that $\g\a_{\infty}^{-1} \in \G_{3} = \G_{1}^{0}(N,p)$. Altogether, we have shown that $\{\a_{1},\ldots,\a_{p-1}\}$ and $\{\a_{1},\ldots,\a_{p-1},\a_{\infty}\}$ are sets of coset representatives for $\G_{3}\backslash\G_{1}(N)$ depending on if $p \nmid N$ or not. To show they are complete sets, we need to show that no two representatives belong to the same coset. To this end, suppose $j$ and $j'$ are distinct, taken modulo $p$, and consider
      \[
        \a_{j}\a_{j'}^{-1} = \begin{pmatrix} 1 & j \\ 0 & 1 \end{pmatrix}\begin{pmatrix} 1 & j' \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} 1 & j-j' \\ 0 & 1 \end{pmatrix}.
      \]
      Then $\a_{j}\a_{j'}^{-1} \in \G_{3} = \G_{1}^{0}(N,p)$ if and only if $j-j' \equiv 0 \tmod{p}$. This is impossible since $j$ and $j'$ are distinct. Hence $\a_{j}$ and $\a_{j'}$ represent distinct cosets. Now consider
      \[
        \a_{j}\a_{\infty}^{-1} = \begin{pmatrix} 1 & j \\ 0 & 1 \end{pmatrix}\begin{pmatrix} 1 & -n \\ -N & pm \end{pmatrix} = \begin{pmatrix} 1-Nj & pmj-n \\ -N & pm \end{pmatrix}.
      \]
      Now $\a_{j}\a_{\infty}^{-1} \in  \G_{3} = \G_{1}^{0}(N,p)$ if and only if $pmj-n \equiv 0 \tmod{p}$. This is impossible since $pm-Nn = 1$ implies $p \nmid n$. Therefore $\a_{j}$ and $\a_{\infty}$ represent distinct cosets. It follows that $\{\a_{1},\ldots,\a_{p-1}\}$ and $\{\a_{1},\ldots,\a_{p-1},\a_{\infty}\}$ are complete sets of coset representatives completing the proof. As
      \[
        \a\a_{j} = \begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\begin{pmatrix} 1 & j \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix} = \b_{j} \quad \text{and} \quad \a\a_{\infty} = \begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\begin{pmatrix} pm & n \\ N & 1 \end{pmatrix} = \begin{pmatrix} pm & n \\ Np & p \end{pmatrix} = \b_{\infty},
      \]
      \cref{lem:coset_lemma_2} finishes the proof.
    \end{proof}

    This explicit definition of $T_{p}$ can be used to compute how the Hecke operators act on the Fourier coefficients of a holomorphic form:

    \begin{proposition}\label{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}
      Let $f \in \mc{M}_{k}(\G_{1}(N))$ with Fourier coefficients $a_{n}(f)$. Then for primes $p$ with $(p,N) = 1$,
      \[
        (T_{p}f)(z) = \sum_{n \ge 0}\left(a_{np}(f)+\chi_{N,0}(p)p^{k-1}a_{\frac{n}{p}}(\<p\>f)\right)e^{2\pi inz},
      \]
      is the Fourier series of $T_{p}f$ where it is understood that $a_{\frac{n}{p}}(f) = 0$ if $p \nmid n$. Moreover, if $f \in \mc{M}_{k}(N,\chi)$, then $T_{p}f \in \mc{M}_{k}(N,\chi)$ and
      \[
        (T_{p}f)(z) = \sum_{n \ge 0}\left(a_{np}(f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(f)\right)e^{2\pi inz},
      \]
      where it is understood that $a_{\frac{n}{p}}(f) = 0$ if $p \nmid n$.
    \end{proposition}
    \begin{proof}
      In view of \cref{thm:diamond_operator_decomposition_holomorphic} and the linearity of the Hecke operators, it suffices to assume $f \in \mc{M}_{k}(N,\chi)$ and thus only the second formula needs to be verified. 
      Observe that
      \[
        \left(f\left[\begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix}\right]_{k}\right)(z) = \frac{1}{p}f\left(\frac{z+j}{p}\right) = \frac{1}{p}\sum_{n \ge 0}a_{n}(f)e^{\frac{2\pi in(z+j)}{p}}.
      \]
      Summing over all $j$ modulo $p$ gives
      \[
        \sum_{j \tmod{p}}\left(f\left[\begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix}\right]_{k}\right)(z) = \sum_{j \tmod{p}}\frac{1}{p}\sum_{n \ge 0}a_{n}(f)e^{\frac{2\pi in(z+j)}{p}} = \sum_{n \ge 0}a_{n}(f)e^{\frac{2\pi inz}{p}}\frac{1}{p}\sum_{j \tmod{p}}e^{\frac{2\pi nij}{p}}.
      \]
      If $p \nmid N$ then the inner sum vanishes because it is the sum over all $p$-th roots of unity. If $p \mid N$ then the sum is $p$. Therefore
      \[
        \sum_{j \tmod{p}}\left(f\left[\begin{pmatrix} 1 & j \\ 0 & p \end{pmatrix}\right]_{k}\right)(z) = \sum_{n \ge 0}a_{np}(f)e^{2\pi inz}.
      \]
      If $p \mid N$, then \cref{prop:explicit_description_of_Hecke_operators_holomorphic} implies
      \begin{equation}\label{equ:Hecke_operator_when_p_divides_holomorphic}
        (T_{p}f)(z) = \sum_{n \ge 0}a_{np}(f)e^{2\pi inz},
      \end{equation}
      which is the claimed Fourier series of $T_{p}f$. $p \nmid N$, then we have the additional term
      \begin{align*}
        \left(f\left[\begin{pmatrix} m & n \\ N & p \end{pmatrix}\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix}\right]_{k}\right)(z) &= \left(\<p\>f\left[\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix}\right]_{k}\right)(z) \\
        &= p^{k-1}(\<p\>f)(pz) \\
        &= \sum_{n \ge 0}p^{k-1}a_{n}(\<p\>f)e^{2\pi inpz} \\
        &= \sum_{n \ge 0}\chi(p)p^{k-1}a_{n}(f)e^{2\pi inpz},
      \end{align*}
      where the first equality holds because $\begin{psmallmatrix} m & n \\ N & p \end{psmallmatrix} \in \G_{0}(N)$ and the last equality holds because $\<p\>f = \chi(p)f$. In this case, \cref{prop:explicit_description_of_Hecke_operators_holomorphic} gives
      \[
        (T_{p}f)(z) = \sum_{n \ge 0}a_{np}(f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(f)e^{2\pi inz}.
      \]
      Since $\chi(p) = 0$ if $p \mid N$, these two cases can be expressed together as 
      \[
        (T_{p}f)(z) = \sum_{n \ge 0}\left(a_{np}(f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(f)\right)e^{2\pi inz}.
      \]
    \end{proof}

    We now mention the crucial result about Hecke operators which is that they form a simultaneously commuting family with the diamond operators:

    \begin{proposition}\label{prop:Hecke_operators_commute_holomorphic}
      Let $p$ and $q$ be primes and $d,e \in (\Z/N\Z)^{\ast}$. The Hecke operators $T_{p}$ and $T_{q}$ and diamond operators $\<d\>$ and $\<e\>$ on $\mc{M}_{k}(\G_{1}(N))$ form a simultaneously commuting family:
      \[
        T_{p}T_{q} = T_{q}T_{p}, \quad \<d\>T_{p} = T_{p}\<d\>, \quad \text{and} \quad \<d\>\<e\> = \<e\>\<d\>.
      \]
    \end{proposition}
    \begin{proof}
      Showing the diamond and Hecke operators commute was \cref{prop:diamond_Hecke_operators_commute_holomorphic}. To show commutativity of the diamond operators, let $\g = \begin{psmallmatrix} \ast & \ast \\ \ast & d \end{psmallmatrix} \in \G_{0}(N)$  and $\eta = \begin{psmallmatrix} \ast & \ast \\ \ast & e \end{psmallmatrix} \in \G_{0}(N)$. Then
      \[
        \g\eta \equiv \begin{pmatrix} \ast & \ast \\ 0 & de \end{pmatrix} \equiv \begin{pmatrix} \ast & \ast \\ 0 & ed \end{pmatrix} \equiv \eta\g \tmod{N}.
      \]
      Therefore $[\g\eta]_{k} = [\eta\g]_{k}$ and so for any $f \in \mc{M}_{k}(\G_{1}(N))$, we have
      \[
        \<d\>\<e\>f = f[\g\eta]_{k} = f[\eta\g]_{k} = \<e\>\<d\>f.
      \]
      We now show that the Hecke operators commute. In view of \cref{thm:diamond_operator_decomposition_holomorphic} and linearity of the Hecke operators, it suffices to prove this for $f \in \mc{M}_{k}(N,\chi)$. Applying \cref{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic} twice, for any $n \ge 1$ we compute
      \begin{align*}
        a_{n}(T_{p}T_{q}f) &= a_{np}(T_{q}f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(T_{q}f) \\
        &= a_{npq}(f)+\chi(q)q^{k-1}a_{\frac{np}{q}}(f)+\chi(p)p^{k-1}(a_{\frac{nq}{p}}(f)+\chi(q)q^{k-1}a_{\frac{n}{pq}}(f)) \\
        &= a_{npq}(f)+\chi(q)q^{k-1}a_{\frac{np}{q}}(f)+\chi(p)p^{k-1}a_{\frac{nq}{p}}(f)+\chi(pq)(pq)^{k-1}a_{\frac{n}{pq}}(f).
      \end{align*}
      The last expression is symmetric in $p$ and $q$ so that $a_{n}(T_{p}T_{q}f) = a_{n}(T_{q}T_{p}f)$ for all $n \ge 1$. Since all of the Fourier coefficients are equal, we get
      \[
        T_{p}T_{q}f = T_{q}T_{p}f.
      \]
    \end{proof}

    We can use \cref{prop:Hecke_operators_commute_holomorphic} to construct diamond operators $\<m\>$ and Hecke operators $T_{m}$ for all $m \ge 1$. The \textbf{diamond operator}\index{diamond operator} $\<m\>:\mc{M}_{k}(\G_{1}(N)) \to \mc{M}_{k}(\G_{1}(N))$ is defined to be the linear operator given by
    \[
      \<m\> = \begin{cases} \<m\> \text{ with $m$ taken modulo $N$} & \text{if $(m,N) = 1$}, \\ 0 & \text{if $(m,N) > 1$}. \end{cases}
    \]
    Now for the Hecke operators. If $m = p_{1}^{r_{1}}p_{2}^{r_{2}} \cdots p_{k}^{r_{k}}$ is the prime decomposition of $m$, then we define the $m$-th \textbf{Hecke operator}\index{Hecke operator} $T_{m}:\mc{M}_{k}(\G_{1}(N)) \to \mc{M}_{k}(\G_{1}(N))$ to be the linear operator given by
    \[
      T_{m} = \prod_{1 \le i \le k}T_{p_{i}^{r_{i}}},
    \]
    where $T_{p^{r}}$ is defined inductively by
    \[
      T_{p^{r}} = \begin{cases} T_{p}T_{p^{r-1}}-p^{k-1}\<p\>T_{p^{r-2}} & \text{if $p \nmid N$}, \\ T_{p}^{r} & \text{if $p \mid N$}, \end{cases}
    \]
    for all $r \ge 2$. Then by \cref{prop:Hecke_operators_commute_holomorphic}, the Hecke operators $T_{m}$ are multiplicative but not completely multiplicative in $m$. Moreover, they commute with the diamond operators $\<m\>$. Using these definitions, \cref{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic,prop:Hecke_operators_commute_holomorphic}, a more general formula for how the Hecke operators $T_{m}$ act on Fourier coefficients can be derived:

    \begin{proposition}\label{prop:general_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}
      Let $f \in \mc{M}_{k}(\G_{1}(N))$ with Fourier coefficients $a_{n}(f)$. Then for $m \ge 1$ with $(m,N) = 1$,
      \[
        (T_{m}f)(z) = \sum_{n \ge 0}\left(\sum_{d \mid (n,m)}d^{k-1}a_{\frac{nm}{d^{2}}}(\<d\>f)\right)e^{2\pi inz},
      \]
      is the Fourier series of $T_{m}f$. Moreover, if $f \in \mc{M}_{k}(N,\chi)$, then
      \[
        (T_{m}f)(z) = \sum_{n \ge 0}\left(\sum_{d \mid (n,m)}\chi(d)d^{k-1}a_{\frac{nm}{d^{2}}}(f)\right)e^{2\pi inz}.
      \]
    \end{proposition}
    \begin{proof}
      In view of \cref{thm:diamond_operator_decomposition_holomorphic} and linearity of the Hecke operators, we may assume $f \in \mc{M}_{k}(N,\chi)$. Therefore we only need to verify the second formula. When $m = 1$ the result is obvious and when $m = p$, we have
      \[
        \sum_{d \mid (n,p)}\chi(d)d^{k-1}a_{\frac{np}{d^{2}}}(f) = a_{np}(f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(f),
      \]
      which is the result obtained from \cref{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}. By induction assume that the desired formula holds for $m = 1,p,\ldots,p^{r-1}$. Using the definition of $T_{p^{r}}$ and \cref{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}, for any $n \ge 1$ we compute
      \begin{align*}
        a_{n}(T_{p^{r}}f) &= a_{n}(T_{p}T_{p^{r-1}}f)-\chi(p)p^{k-1}a_{n}(T_{p^{r-2}}f) \\
        &= a_{np}(T_{p^{r-1}}f)+\chi(p)p^{k-1}a_{\frac{n}{p}}(T_{p^{r-1}}f)-\chi(p)p^{k-1}a_{n}(T_{p^{r-2}}f).
      \end{align*}
      By our induction hypothesis, this last expression is
      \[
        \sum_{d \mid (np,p^{r-1})}\chi(d)d^{k-1}a_{\frac{np^{r}}{d^{2}}}(f)+\chi(p)p^{k-1}\sum_{d \mid \left(\frac{n}{p},p^{r-1}\right)}\chi(d)d^{k-1}a_{\frac{np^{r-2}}{d^{2}}}(f)-\chi(p)p^{k-1}\sum_{d \mid (n,p^{r-2})}\chi(d)d^{k-1}a_{\frac{np^{r-2}}{d^{2}}}(f).
      \]
      Write the first sum as
      \[
        \sum_{d \mid (np,p^{r-1})}\chi(d)d^{k-1}a_{\frac{np^{r}}{d^{2}}}(f) = a_{np^{r}}(f)+\sum_{d \mid (n,p^{r-2})}\chi(d)d^{k-1}a_{\frac{np^{r-2}}{d^{2}}}(f),
      \]
      and observe that the sum on the right-hand side cancels the entire third term above. Therefore our expression reduces to
      \begin{align*}
        a_{np^{r}}(f)+\chi(p)p^{k-1}\sum_{d \mid \left(\frac{n}{p},p^{r-1}\right)}\chi(d)d^{k-1}a_{\frac{np^{r-2}}{d^{2}}}(f) &= a_{np^{r}}(f)+\sum_{d \mid \left(\frac{n}{p},p^{r-1}\right)}\chi(dp)(dp)^{k-1}a_{\frac{np^{r-2}}{d^{2}}}(f) \\
        &= a_{np^{r}}(f)+\sum_{\substack{d \mid (n,p^{r}) \\ d \neq 1}}\chi(d)d^{k-1}a_{\frac{np^{r}}{d^{2}}}(f) \\
        &= \sum_{d \mid (n,p^{r})}\chi(d)d^{k-1}a_{\frac{np^{r}}{d^{2}}}(f),
      \end{align*}
      where in the second line we have performed the change of variables $dp \to d$ in the sum. This proves the claim when $m = p^{r}$ for all $r \ge 0$. By multiplicativity of the Hecke operators, it suffices to prove the claim when $m = p^{r}q^{s}$ for another prime $q$ and some $s \ge 0$. We compute
      \begin{align*}
        a_{n}(T_{p^{r}q^{s}}f) &= a_{n}(T_{p^{r}}T_{q^{s}}f) \\
        &= \sum_{d_{1} \mid (n,p^{r})}\chi(d_{1})d_{1}^{k-1}a_{\frac{np^{r}}{d_{1}^{2}}}(T_{q^{s}}f) \\
        &= \sum_{d_{1} \mid (n,p^{r})}\chi(d_{1})d_{1}^{k-1}\sum_{d_{2} \mid \left(\frac{np^{r}}{d_{1}^{2}},q^{s}\right)}\chi(d_{2})d_{2}^{k-1}a_{\frac{np^{r}q^{s}}{(d_{1}d_{2})^{2}}}(f) \\
        &= \sum_{d_{1} \mid (n,p^{r})}\sum_{d_{2} \mid \left(\frac{np^{r}}{d_{1}^{2}},q^{s}\right)}\chi(d_{1}d_{2})(d_{1}d_{2})^{k-1}a_{\frac{np^{r}q^{s}}{(d_{1}d_{2})^{2}}}(f).
      \end{align*}
      Summing over pairs $(d_{1},d_{2})$ of divisors of $(n,p^{r})$ and $\left(\frac{np^{r}}{d^{2}},q^{s}\right)$ respectively is the same as summing over divisors $d$ of $(n,p^{r}q^{s})$. Indeed, because $p$ and $q$ are relative prime, any such $d$ is of the form $d = d_{1}d_{2}$ where $d_{1} \mid (n,p^{r})$ and $d_{2} \mid \left(\frac{np^{r}}{d_{2}^{2}},q^{s}\right)$. Therefore the double sum becomes
      \[
        \sum_{d \mid (n,p^{r}q^{s})}\chi(d)d^{k-1}a_{\frac{np^{r}q^{s}}{d^{2}}}(f).
      \]
      This completes the proof.
    \end{proof}

    The diamond and Hecke operators turn out to be normal with respect to the Petersson inner product on the subspace of cusp forms. To prove this fact, we will require a lemma:

    \begin{lemma}\label{lem:adjoint_lemma}
      Let $\G$ be a congruence subgroup and let $\a \in \GL_{2}^{+}(\Q)$. Then there exist $\b_{1},\ldots,\b_{n} \in \GL_{2}^{+}(\Q)$, where $n = [\G:\a^{-1}\G\a \cap \G] = [\G:\a\G\a^{-1} \cap \G]$, and such that
      \[
        \G\a\G = \bigcup_{j}\G\b_{j} = \bigcup_{j}\b_{j}\G.
      \]
    \end{lemma}
    \begin{proof}
      Apply \cref{lem:invariance_of_volume} with the congruence subgroup $\a\G\a^{-1} \cap \G$ in place of $\G$ to get
      \[
        [\PSL_{2}(\Z):\a^{-1}\G\a \cap \G] = [\PSL_{2}(\Z):\a\G\a^{-1} \cap \G].
      \]
      Dividing both sides by $[\PSL_{2}(\Z):\G]$ gives
      \[
        [\G:\a^{-1}\G\a \cap \G] = [\G:\a\G\a^{-1} \cap \G].
      \]
      Therefore we can find coset representatives $\g_{1},\ldots,\g_{n} \in \G$ and $\wtilde{\g}_{1},\ldots,\wtilde{\g}_{n} \in \G$ such that
      \[
        \G = \bigcup_{j}(\a^{-1}\G\a \cap \G)\g_{j} = \bigcup_{j}(\a^{-1}\G\a \cap \G)\wtilde{\g}_{j}^{-1}.
      \]
      Invoking \cref{lem:coset_lemma_2} twice, we can express each of these coset decompositions as an orbit decomposition:
      \[
        \bigcup_{j}(\a^{-1}\G\a \cap \G)\g_{j} = \bigcup_{j}\G\a\g_{j} \quad \text{and} \quad \bigcup_{j}(\a^{-1}\G\a \cap \G)\wtilde{\g}_{j}^{-1} = \bigcup_{j}\G\a^{-1}\wtilde{\g}_{j}^{-1}.
      \]
      It follows that
      \[
        \G = \bigcup_{j}\G\a\g_{j} = \bigcup_{j}\wtilde{\g}_{j}\a\G.
      \]
      For each $j$ the orbit spaces $\G\a\g_{j}$ and $\wtilde{\g}_{j}\a\G$ have nonempty intersection. For if they did we would have $\G\a\g_{j} \subseteq \bigcup_{i \neq j}\wtilde{\g}_{i}\a\G$ and thus $\G\a\G \subseteq \bigcup_{i \neq j}\wtilde{\g}_{i}\a\G$. This contradicts the previous decomposition of $\G$. Therefore we can find representatives $\b_{j} \in \G\a\g_{j} \cap \wtilde{\g}_{j}\a\G$ for every $j$. Then $\b_{j}$
      \[
        \G = \bigcup_{j}\G\b_{j} = \bigcup_{j}\b_{j}\G.
      \] 
    \end{proof}

    We can use \cref{lem:adjoint_lemma} to compute adjoints:

    \begin{proposition}\label{prop:Petersson_adjoint_holomorphic}
      Let $\G$ be a congruence subgroup and let $\a \in \GL_{2}^{+}(\Q)$. Set $\a' = \det(\a)\a^{-1}$. Then the following are true:
      \begin{enumerate}[label=(\roman*)]
        \item If $\a^{-1}\G\a \subseteq \PSL_{2}(\Z)$, then for all $f \in \mc{S}_{k}(\G)$ and $g \in \mc{S}_{k}(\a^{-1}\G\a)$, we have
        \[
          \<f[\a]_{k},g\>_{\a^{-1}\G\a} = \<f,g[\a']_{k}\>_{\G}.
        \]
        \item For all $f,g \in \mc{S}_{k}(\G)$, we have
        \[
          \<f[\G\a\G]_{k},g\> = \<f,g[\G\a'\G]_{k}\>.
        \]
      \end{enumerate}
      In particular, if $\a^{-1}\G\a = \G$ then $[\a]_{k}^{\ast} = [\a']_{k}$ and $[\G\a\G]_{k}^{\ast} = [\G\a'\G]_{k}$.   
    \end{proposition}
    \begin{proof}
      To prove (i) we first compute
      \begin{align*}
        \<f[\a]_{k},g\>_{\a^{-1}\G\a} &= \frac{1}{V_{\a^{-1}\G\a}}\int_{\mc{F}_{\a^{-1}\G\a}}(f[\a]_{k})(z)\conj{g(z)}\Im(z)^{k}\,d\mu \\
        &= \frac{1}{V_{\a^{-1}\G\a}}\int_{\mc{F}_{\a^{-1}\G\a}}\det(\a)^{k-1}j(\a,z)^{-k}f(\a z)\conj{g(z)}\Im(z)^{k}\,d\mu \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\a^{-1}\G\a}}\det(\a)^{k-1}j(\a,z)^{-k}f(\a z)\conj{g(z)}\Im(z)^{k}\,d\mu && \text{\cref{lem:invariance_of_volume}} \\
        &= \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\det(\a)^{k-1}j(\a,\a^{-1}z)^{-k}f(z)\conj{g(\a^{-1}z)}\Im(\a^{-1}z)^{k}\,d\mu && \text{$z \to \a^{-1}z$.}
      \end{align*}
      As $\a'$ acts as $\a^{-1}$ on $\H$, this latter integral is equivalent to
      \[
        \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\det(\a)^{k-1}j(\a,\a'z)^{-k}f(z)\conj{g(\a'z)}\Im(\a'z)^{k}\,d\mu.
      \]
      Moreover, applying the cocycle condition and the identities $\Im(\a'z) = \det(\a')\frac{\Im(z)}{|j(\a',z)|^{2}}$, $j(\a\a',z) = \det(\a)$, and $\det(\a') = \det(\a)$ together, we can further rewrite the integral as
      \[
        \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\det(\a')^{k-1}\conj{j(\a',z)^{-k}}f(z)\conj{g(\a'z)}\Im(z)^{k}\,d\mu.
      \]
      Reversing the first computation in the start of the proof but applied to this integral shows that that
      \[
        \frac{1}{V_{\G}}\int_{\mc{F}_{\G}}\det(\a')^{k-1}\conj{j(\a',z)^{-k}}f(z)\conj{g(\a'z)}\Im(z)^{k}\,d\mu = \<f,g[\a']_{k}\>_{\G},
      \]
      which completes the proof of (i). To prove (ii), the coset decomposition $\G\a\G = \bigcup_{j}\G\b_{j}$ from \cref{lem:adjoint_lemma} implies that we can use the $\b_{j}$ as representatives in the definition of the $[\G\a\G]_{k}$ operator. As the $\b_{j}$ also satisfy $\G\a\G = \bigcup_{j}\b_{j}\G$, upon inverting $\b_{j}$ and noting that $\b_{j} \in \G\a$, we obtain $\G\a^{-1}\G = \bigcup_{j}\G\b_{j}^{-1}$. Since scalar multiplication commutes with matrices and the matrices in $\G$ have determinant $1$, we conclude that $\G\a'\G = \bigcup_{j}\G\b_{j}'$ where $\b_{j}' = \det(\b_{j})\b_{j}^{-1}$ (also $\det(\b_{j}) = \det(\a)$). So we can use the $\b_{j}'$ as representatives in the definition of the $[\G\a'\G]_{k}$ operator. The statement now follows from (i). The last statement is now obvious.
    \end{proof}

    We can now prove that the diamond and Hecke operators are normal:

    \begin{proposition}\label{prop:Hecke_operators_normal_holomorphic}
      On $\mc{S}_{k}(\G_{1}(N))$, the diamond operators $\<m\>$ and Hecke operators $T_{m}$ are normal with respect to the Petersson inner product for all $m \ge 1$ with $(m,N) = 1$. Moreover, their adjoints are given by
      \[
        \<m\>^{\ast} = \<\conj{m}\> \quad \text{and} \quad T_{p}^{\ast} = \<\conj{p}\>T_{p}.
      \]
    \end{proposition}
    \begin{proof}
      As taking the adjoint is a linear operator, the definition of the diamond and Hecke operators and \cref{prop:Hecke_operators_commute_holomorphic} imply that it suffices to prove the two adjoint formulas for the when $m = p$ is prime. We will first prove the adjoint formula for $\<p\>$. Let $\a = \begin{psmallmatrix} * & * \\ * & p \end{psmallmatrix} \in \G_{0}(N)$. As $\G_{1}(N)$ is normal in $\G_{0}(N)$ and $\det(\a) = 1$, \cref{prop:Petersson_adjoint_holomorphic} gives
      \[
        \<p\>^{\ast} = [\a]_{k}^{\ast} = [\a']_{k} = [\a^{-1}]_{k} = \<\conj{p}\>.
      \]
      This proves the adjoint formula for the diamond operators and normality follows from multiplicativity. For the Hecke operator $T_{p}$, let $\a = \begin{psmallmatrix} 1 & 0 \\ 0 & p \end{psmallmatrix}$ and note that $\a' = \begin{psmallmatrix} p & 0 \\ 0 & 1 \end{psmallmatrix}$. Now \cref{prop:Petersson_adjoint_holomorphic} implies
      \[
        T_{p}^{\ast} = [\G_{1}(N)\a\G_{1}(N)]_{k}^{\ast} = [\G_{1}(N)\a'\G_{1}(N)]_{k}.
      \]
      Let $m$ and $n$ be such that $pm-Nn = 1$. Then
      \[
        \begin{pmatrix} 1 & n \\ N & pm \end{pmatrix}\a' = \begin{pmatrix} 1 & n \\ N & pm \end{pmatrix}\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} p & n \\ Np & pm \end{pmatrix} = \begin{pmatrix} 1 & 0 \\ 0 & p \end{pmatrix}\begin{pmatrix} p & n \\ N & m \end{pmatrix} = \a\begin{pmatrix} p & n \\ N & m \end{pmatrix},
      \]
      which implies that $\a' = \begin{psmallmatrix} 1 & n \\ N & pm \end{psmallmatrix}^{-1}\a\begin{psmallmatrix} p & n \\ N & m \end{psmallmatrix}$. As $\begin{psmallmatrix} 1 & n \\ N & pm \end{psmallmatrix} \in \G_{1}(N)$ (note that $pm \equiv 1 \tmod{N}$ since $pm-Nn = 1$) and $\begin{psmallmatrix} p & n \\ N & m \end{psmallmatrix} \in \G_{0}(N)$, substituting the triple product expression for $\a'$ into $[\G_{1}(N)\a'\G_{1}(N)]_{k}$ and noting that $\G_{1}(N)$ is normal in $\G_{0}(N)$ yields
      \[
        \G_{1}(N)\a'\G_{1}(N) = \G_{1}(N)\a\G_{1}(N)\begin{pmatrix} p & n \\ N & m \end{pmatrix}.
      \]
      Now if the $\b_{j}$ are representatives for $[\G_{1}\a\G_{1}(N)]_{k}$, then $\G_{1}\a\G_{1}(N) = \bigcup_{j}\G_{1}(N)\b_{j}$. Therefore the formula above implies $\G_{1}\a'\G_{1}(N) = \bigcup_{j}\G_{1}(N)\b_{j}\begin{psmallmatrix} p & n \\ N & m \end{psmallmatrix}$ and so the $\b_{j}\begin{psmallmatrix} p & n \\ N & m \end{psmallmatrix}$ can be used as representatives for $[\G_{1}\a'\G_{1}(N)]_{k}$. As $pm-Nn = 1$, $m \equiv \conj{p} \tmod{N}$ and so \cref{prop:Hecke_operators_commute_holomorphic} implies that $T_{p}^{\ast} = \<\conj{p}\>T_{p}$. This proves the adjoint formula for the Hecke operators and normality follows from multiplicativity.
    \end{proof}

    In the case of the modular group, \cref{prop:Hecke_operators_normal_holomorphic} says that all of the diamond and Hecke operators are normal. Now suppose $f$ is a non-constant holomorphic form with Fourier coefficients $a_{n}(f)$. Let the eigenvalue of $T_{m}$ for $f$ be $\l_{f}(m)$. We say that the $\l_{f}(m)$ are the \textbf{Hecke eigenvalues}\index{Hecke eigenvalues} of $f$. If $f$ is a simultaneous eigenfunction for all diamond operators $\<m\>$ and Hecke operators $T_{m}$ with $(m,N) = 1$, we call $f$ an \textbf{eigenform}\index{eigenform}. If the condition $(m,N) = 1$ can be dropped, so that $f$ is a simultaneous eigenfunction for all diamond and Hecke operators, then we say $f$ is a \textbf{Hecke eigenform}\index{Hecke eigenform}. In particular, on $\G_{1}(1)\backslash\H$ all eigenforms are Hecke eigenforms. If $f$ is an eigenform, then \cref{prop:general_Hecke_operators_acting_on_Fourier_coefficients_holomorphic} immediately implies that the first Fourier coefficient of $T_{m}f$ is $a_{m}(f)$ and so
    \[
      a_{m}(f) = \l_{f}(m)a_{1}(f),
    \]
    for all $m \ge 1$ with $(m,N) = 1$. Therefore we cannot have $a_{1}(f) = 0$ for this would mean $f$ is constant. We can normalize $f$ by dividing by $a_{1}(f)$ which guarantees that this Fourier coefficient is $1$. It follows that
    \[
      a_{m}(f) = \l_{f}(m),
    \]
    for all $m \ge 1$ with $(m,N) = 1$. This normalization is called the \textbf{Hecke normalization}\index{Hecke normalization} of $f$. The \textbf{Petersson normalization}\index{Petersson normalization} of $f$ is where we normalize so that $\<f,f\> = 1$. From the spectral theorem we derive an important corollary:

    \begin{theorem}\label{thm:eigenforms_forms_spectral_theory_holomorphic}
      $\mc{S}_{k}(\G_{1}(N))$ admits an orthonormal basis of eigenforms.
    \end{theorem}
    \begin{proof}
      By \cref{thm:modular_forms_finite_dimensional}, $\mc{S}_{k}(\G_{1}(N))$ is finite dimensional. The claim then follows from the spectral theorem along with \cref{prop:Hecke_operators_commute_holomorphic,prop:Hecke_operators_normal_holomorphic}.
    \end{proof}

    As a near immediate consequence of \cref{thm:eigenforms_forms_spectral_theory_holomorphic}, we can show that Hecke eigenvalues of eigenforms satisfy certain relations known as the \textbf{Hecke relations}\index{Hecke relations} for holomorphic forms:

    \begin{proposition}[Hecke relations, holomorphic version]
    Let $f \in \mc{S}_{k}(N,\chi)$ be a Hecke eigenform with Hecke eigenvalues $\l_{f}(n)$. Then the Hecke eigenvalues are multiplicative and satisfy
    \[
      \l_{f}(n)\l_{f}(m) = \sum_{d \mid (n,m)}\chi(d)d^{k-1}\l_{f}\left(\frac{nm}{d^{2}}\right) \quad \text{and} \quad \l_{f}(nm) = \sum_{d \mid (n,m)}\mu(d)\chi(d)d^{k-1}\l_{f}\left(\frac{n}{d}\right)\l_{f}\left(\frac{m}{d}\right),
    \]
    for all $n,m \ge 1$ with $(nm,N) = 1$.
    \end{proposition}
    \begin{proof}
      By \cref{thm:eigenforms_forms_spectral_theory_holomorphic} it suffices to verify this when $f$ is a Hecke eigenform. We may also assume $f$ is Hecke normalized without any harm. The multiplicativity of the Hecke eigenvalues now follows from the multiplicity of the Hecke operators. Moreover, the first identity follows immediately from computing the $n$-th Fourier coefficient of $T_{m}f$ in two different ways. On the one hand, use that $f$ is a Hecke eigenform. On the other hand, use \cref{prop:general_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}. For the second identity, we have
      \[
        \chi(p)p^{k-1} = \l_{f}(p)^{2}-\l_{f}(p^{2}),
      \]
      provided $(p,N) = 1$, by computing the $p$-th Fourier coefficient of $T_{p}f$ in two different ways as we just did above. The second identity now follows from the first because $\l_{f}(n)$ is a specially multiplicative function in $n$ (see \cref{thm:specially_multiplicative_functions}).
    \end{proof}

    As an immediate consequence of the Hecke relations, the Hecke operators satisfy analogous relations:

    \begin{corollary}\label{cor:Hecke_relations_operator_holomorphic}
      The Hecke operators are multiplicative and satisfy
      \[
        T_{n}T_{m} = \sum_{d \mid (n,m)}\chi(d)d^{k-1}T_{\frac{nm}{d^{2}}} \quad \text{and} \quad T_{nm} = \sum_{d \mid (n,m)}\mu(d)\chi(d)d^{k-1}T_{\frac{n}{d}}T_{\frac{m}{d}},
      \]
      for all $n,m \ge 1$ with $(nm,N) = 1$.
    \end{corollary}
    \begin{proof}
      This is immediate from \cref{thm:eigenforms_forms_spectral_theory_holomorphic} and the Hecke relations.
    \end{proof}

    The identities in \cref{cor:Hecke_relations_operator_holomorphic} can also be established directly. Moreover, the first identity is symmetric in $n$ and $m$ so it can be used to show that the Hecke operators commute.
  \section{AtkinLehner Theory}
    So far, our entire theory of holomorphic forms has started with a fixed congruence subgroup of some level. AtkinLehner theory, or the theory of oldforms \& newforms, allows us to discuss holomorphic forms in the context of moving between levels. In this setting, we will only deal with congruence subgroups of the form $\G_{1}(N)$ and cusp forms on $\G_{1}(N)\backslash\H$. The easiest way lift a holomorphic form from a smaller level to a larger level is to observe that if $M \mid N$, then $\G_{1}(N) \le \G_{1}(M)$ so there is a natural inclusion $\mc{S}_{k}(\G_{1}(M)) \subseteq \mc{S}_{k}(\G_{1}(N))$. There is a less trivial way of lifting from $\mc{S}_{k}(\G_{1}(M))$ to $\mc{S}_{k}(\G_{1}(N))$. For any $d \mid \frac{N}{M}$, let $\a_{d} = \begin{psmallmatrix} d & 0 \\ 0 & 1 \end{psmallmatrix}$. If $f \in \mc{S}_{k}(\G_{1}(M))$, we consider
    \[
        (f[\a_{d}]_{k})(z) = \det(\a_{d})^{k-1}j(\a_{d},z)^{-k}f(\a_{d}z) = d^{k-1}f(dz).
    \]
    It turns out that, $[\a_{d}]_{k}$ maps $\mc{S}_{k}(\G_{1}(M))$ into $\mc{S}_{k}(\G_{1}(N))$ and preserves the subspace of cusp forms:
    
    \begin{proposition}\label{equ:lifting_operator_holomorphic}
      Let $M$ and $N$ be positive integers such that $M \mid N$. For any $d \mid \frac{N}{M}$, $[\a_{d}]_{k}$ maps $\mc{S}_{k}(\G_{1}(M))$ into $\mc{S}_{k}(\G_{1}(N))$.
    \end{proposition}
    \begin{proof}
      It is clear that holomorphy is satisfied for $f[\a_{d}]_{k}$. To verify modularity, let $\g = \begin{psmallmatrix} a & b \\ c & d' \end{psmallmatrix} \in \G_{1}(N)$. Then
      \[
        \a_{d}\g\a_{d}^{-1} = \begin{pmatrix} d & 0 \\ 0 & 1 \end{pmatrix}\begin{pmatrix} a & b \\ c & d' \end{pmatrix}\begin{pmatrix} d^{-1} & 0 \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} a & bd \\ d^{-1}c & d' \end{pmatrix} = \g',
      \]
      where $\g' = \begin{psmallmatrix} a & bd \\ d^{-1}c & d' \end{psmallmatrix}$. Since $c \equiv 0 \tmod{N}$ and $d \mid \frac{N}{M}$, we deduce that $d^{-1}c \equiv 0 \tmod{M}$. So $\g' \in \G_{1}(M)$ and therefore $\a_{d}\G_{1}(N)\a_{d}^{-1} \subseteq \G_{1}(M)$, or equivalently, $\G_{1}(N) \subseteq \a_{d}^{-1}\G_{1}(M)\a_{d}$. Writing $\g = \a_{d}^{-1}\g'\a_{d}$, we see that $j(\g',\a_{d}z) = j(\g,z)$ and 
      \begin{align*}
        (f[\a_{d}]_{k})(\g z) &= d^{k-1}f(d \g z) \\
        &= d^{k-1}f(d\a_{d}^{-1}\g'\a_{d}z) \\
        &= d^{k-1}f\left(\g'\a_{d}z\right) && \text{$d\a_{d}^{-1}z = z$} \\
        &= j(\g',\a_{d}z)d^{k-1}f(\a_{d}z) \\
        &= j(\g,z)d^{k-1}f(dz) && \text{$j(\g',\a_{d}z) = j(\g,z)$ and $\a_{d}z = dz$} \\
        &= j(\g,z)(f[\a_{d}]_{k})(z).
      \end{align*}
      This verifies the modularity of $f[\a_{d}]_{k}$. For the growth condition, let $\s_{\mf{a}}$ be a scaling matrix for the cusp $\mf{a}$ of $\G_{1}(M)\backslash\H$. Then $\a_{d}\s_{\mf{a}}$ takes $\infty$ to an element of $\Q \cup \{\infty\}$ since $\a_{d} \in \GL_{2}^{+}(\Q)$. In other words, $\a_{d}\s_{\mf{a}}\infty = \mf{b}$ for some cusp $\mf{b}$ of $\G_{1}(N)\backslash\H$. Then the cocycle condition implies
      \[
        j(\s_{\mf{a}},z)^{-k}(f[\a_{d}]_{k})(\s_{\mf{a}}z) = \det(\a_{d})^{k-1}j(\a_{d}\s_{\mf{a}},z)^{-k}f(\a_{d}\s_{\mf{a}}z),
      \]
      and the growth condition follows from that of $f$. Lastly, it is also clear that $f[\a_{d}]_{k}$ is a cusp form if $f$ is and so $f[\a_{d}]_{k} \in \mc{S}_{k}(\G_{1}(N))$.
    \end{proof}

    We can now define oldforms and newforms. For each divisor $d$ of $N$, set
    \[
      i_{d}:\mc{S}_{k}\left(\G_{1}\left(\frac{N}{d}\right)\right)\x\mc{S}_{k}\left(\G_{1}\left(\frac{N}{d}\right)\right) \to \mc{S}_{k}(\G_{1}(N)) \qquad (f,g) \mapsto f+g[\a_{d}]_{k}.
    \]
    This map is well-defined by \cref{equ:lifting_operator_holomorphic}. The subspace of \textbf{oldforms of level $N$}\index{oldforms of level $N$} is
    \[
      \mc{S}_{k}(\G_{1}(N))^{\mathrm{old}} = \bigop_{p \mid N}\Im(i_{p}),
    \]
    and the subspace of \textbf{newforms of level $N$}\index{newforms of level $N$} is
    \[
      \mc{S}_{k}(\G_{1}(N))^{\mathrm{new}} = \left(\mc{S}_{k}(\G_{1}(N))^{\mathrm{old}} \right)^{\perp},
    \]
    where the orthogonal complement is taken with respect to the Petersson inner product. The elements of such subspaces are called \textbf{oldforms}\index{oldforms} and \textbf{newforms}\index{newforms} respectively. Both subspaces are invariant under the diamond and Hecke operators (see \cite{diamond2005first} for a proof):

    \begin{proposition}\label{prop:old/new_subspaces_are_invariant_holomorphic}
      The spaces $\mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$ and $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ are invariant under the diamond operators $\<m\>$ and Hecke operators $T_{m}$ for all $m \ge 1$.
    \end{proposition}

    As a corollary, we deduce that these subspaces admit orthogonal bases of eigenforms:

    \begin{corollary}\label{cor:old/new_eigenbasis_holomorphic}
      $\mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$ and $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ admit orthonormal bases of eigenforms.
    \end{corollary}
    \begin{proof}
      This follows immediately from \cref{thm:eigenforms_forms_spectral_theory_holomorphic,prop:old/new_subspaces_are_invariant_holomorphic}
    \end{proof}

    Something quite amazing happens for the subspace in $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$; the condition $(m,N) = 1$ for eigenforms in a base can be removed. Therefore the eigenforms are actually eigenfunctions for all of the diamond and Hecke operators. We require a preliminary result whose proof is quite involved but it is not beyond the scope of this text (see \cite{diamond2005first} for a proof):

    \begin{lemma}\label{lem:the_main_lemma_for_newforms_holomorphic}
      If $f \in \mc{S}_{k}(\G_{1}(N))$ with Fourier coefficients $a_{n}(f)$ and such that $a_{n}(f) = 0$ whenever $(n,N) = 1$, then
      \[
        f = \sum_{p \mid N}p^{k-1}f_{p}[\a_{p}],
      \]
      for some $f_{p} \in \mc{S}_{k}\left(\G_{1}\left(\frac{N}{p}\right)\right)$.
    \end{lemma}

    The important observation to make about \cref{lem:the_main_lemma_for_newforms_holomorphic} is that if $f \in \mc{S}_{k}(\G_{1}(N))$ is such that its $n$-th Fourier coefficients vanish when $n$ is relatively prime to the level, then $f$ must be an oldform. With this lemma we can prove the main theorem about $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$. The introduction of some language will be useful for the statement and its proof. We say that $f$ is a \textbf{primitive Hecke eigenform}\index{primitive Hecke eigenform} if it is a nonzero Hecke normalized Hecke eigenform in $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$. We can now prove the main result about newforms:

    \begin{theorem}\label{thm:newforms_characterization_holomorphic}
      Let $f \in \mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ be an eigenform. Then the following hold:
      \begin{enumerate}[label=(\roman*)]
        \item $f$ is a Hecke eigenform.
        \item If $\wtilde{f}$ satisfies the same conditions as $f$ and has the same eigenvalues for the Hecke operators, then $\wtilde{f} = cf$ for some nonzero constant $c$.
      \end{enumerate}
      Moreover, the primitive Hecke eigenforms in $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ form an orthogonal basis with respect to the Petersson inner product and each such primitive Hecke eigenforms $f$ lies in an eigenspace $\mc{S}_{k}(N,\chi)$.
    \end{theorem}
    \begin{proof}
      First suppose $f \in \mc{S}_{k}(\G_{1}(N))$ is an eigenform with Fourier coefficients $a_{n}(f)$. For $m \ge 1$ with $(m,N) = 1$, there exists $\l_{f}(m),\mu_{f}(m) \in \C$ such that $T_{m}f = \l_{f}(m)f$ and $\<m\>f = \mu_{f}(m)f$. Actually, $\<m\>f = \mu_{f}(m)f$ holds for all $m \ge 1$ because $\<m\>$ is the zero operator if $(m,N) > 1$ and in this case we can take $\mu_{f}(m) = 0$. If we set $\chi(n) = \mu_{f}(m)$, then $\chi$ is a Dirichlet character modulo $N$. This follows because multiplicativity of $\<m\>$ implies the same for $\chi$ and $\chi$ is $N$-periodic since $\<m\>$ is $N$-periodic ($\<m\>$ is defined by $m$ taken modulo $N$). But then $\<m\>f = \chi(m)f$ so that $f \in \mc{S}_{k}(N,\chi)$. As $f$ is an eigenform, we also have $a_{m}(f) = \l_{f}(m)a_{1}(f)$ provided $(m,N) = 1$. So if $a_{1}(f) = 0$, \cref{lem:the_main_lemma_for_newforms_holomorphic} implies $f \in \mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$. With this fact in hand, we can prove the statements.
      \begin{enumerate}[label=(\roman*)]
        \item The claim is trivial if $f$ is zero, so assume otherwise. If $f \in \mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$, then $f \notin \mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$ and so by what we have shown $a_{1}(f) \neq 0$. Therefore we may Hecke normalize $f$ so that $a_{1}(f) = 1$ and $a_{m}(f) = \l_{f}(m)$. Now set $g_{m} = T_{m}f-\l_{f}(m)f$ for any $m \ge 1$. By \cref{prop:old/new_subspaces_are_invariant_holomorphic}, $g_{m} \in \mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$. Moreover, $g_{m}$ is an eigenform and its first Fourier coefficient is zero. But then $g_{m} \in \mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$ too and so $g_{m} = 0$ because $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ and $\mc{S}_{k}(\G_{1}(N))^{\mathrm{old}}$ are orthogonal subspaces. This means $T_{m}f = \l_{f}(m)f$ for any $m \ge 1$. Therefore $f$ is a primitive Hecke eigenform and so is a Hecke eigenform before Hecke normalization.
        \item Suppose $\wtilde{f}$ satisfies the same conditions as $f$ with the same eigenvalues for the Hecke operators. By (i), $f$ and $\wtilde{f}$ are Hecke eigenforms. After Hecke normalization, $f$ and $\wtilde{f}$ have the same Fourier coefficients and so are identical. It follows that before Hecke normalization $f = c\wtilde{f}$ for some nonzero constant $c$.
      \end{enumerate}
      Note that our initial remarks together with (i) show that each primitive Hecke eigenform $f$ belongs to some eigenspace $\mc{S}_{k}(N,\chi)$. By \cref{cor:old/new_eigenbasis_holomorphic}, $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ admits an orthogonal basis of eigenforms which by (i) are Hecke eigenforms. As $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ is finite dimensional (because $\mc{S}_{k}(\G_{1}(N))$ is), it follows that all of the primitive Hecke eigenforms form an orthogonal basis for $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ if we can show that they are linearly independent. So suppose, to the contrary, that we have a nontrivial linear relation
      \[
        \sum_{1 \le i \le r}c_{i}f_{i} = 0,
      \]
      for some primitive Hecke eigenforms $f_{i}$, nonzero constants $c_{i}$, and with $r$ minimal. Note that $r \ge 2$ for else we do not have a nontrivial linear relation. Letting $m \ge 1$ applying the operator $T_{m}-\l_{f_{1}}(m)$ to our nontrivial linear relation gives
      \[
        \sum_{2 \le i \le r}c_{i}(\l_{f_{i}}(m)-\l_{f_{1}}(m))f_{i} = 0,
      \]
      which has one less term. Since $r$ was chosen to be minimal, this implies $\l_{f_{i}}(m)-\l_{f_{1}}(m)$ for all $i$. But $m$ was arbitrary, so $f_{i} = f_{1}$ for all $i$ by (ii). Hence $r = 1$ which is a contradiction.
    \end{proof}

    Statement (i) in \cref{thm:newforms_characterization_holomorphic} implies that primitive Hecke eigenforms satisfy the Hecke relations for all $n,m \ge 1$. Statement (ii) can be interpreted as saying that a basis of newforms for $\mc{S}_{k}(\G_{1}(N))^{\mathrm{new}}$ contains one element per ``eigenvalue'' where we mean a set of eigenvalues one for each Hecke operator $T_{m}$. Actually, we can obtain a slightly better result called \textbf{multiplicity one}\index{multiplicity one} for holomorphic forms:

    \begin{theorem}[Multiplicity one, holomorphic version]
      Let $f$ and $g$ be primitive Hecke eigenforms of the same eigenvalue and level. Denote the Hecke eigenvalues by $\l_{f}(n)$ and $\l_{g}(n)$ respectively. If $\l_{f}(p) = \l_{g}(p)$ for all primes $p$, then $f = g$.
    \end{theorem}
    \begin{proof}
      The Hecke relations imply that $\l_{f}(n) = \l_{g}(n)$ for all $n \ge 1$. By \cref{thm:newforms_characterization_holomorphic} (ii), $f = g$.
    \end{proof}
    
    With a stronger version of multiplicity one, one can prove that the Fourier coefficients of primitive Hecke eigenforms are real. This result takes a lot of work to show (see \cite{diamond2005first} for a note and appropriate references) and while we will not need it in the following, we state it for convenience:

    \begin{theorem}
      The Fourier coefficients of primitive Hecke eigenforms are real.
    \end{theorem}

    We now require one last linear operator. Let
    \[
      W_{N} = \begin{pmatrix} 0 & -1 \\ N & 0 \end{pmatrix},
    \]
    and note that $\det(W_{N}) = N$. We define the \textbf{AtkinLehner involution}\index{AtkinLehner involution} $\w_{N}$ to be the linear operator on $\mc{S}_{k}(\G_{1}(N))$ given by
    \[
      (\w_{N}f)(z) = N^{\frac{k}{2}}j(W_{n},z)^{-k}f(W_{n}z) = (\sqrt{N}z)^{-k}f\left(-\frac{1}{Nz}\right).
    \]
    It is not too difficult to see that $\w_{N}$ is an involution on $\mc{S}_{k}(\G_{1}(N))$:

    \begin{proposition}\label{prop:Atkin_Lehner_holomorphic}
      $\w_{N}$ is an involution on $\mc{S}_{k}(\G_{1}(N))$.
    \end{proposition}
    \begin{proof}
      We first need to show that $\w_{N}$ maps $\mc{S}_{k}(\G_{1}(N))$ into itself. Holomorphy is obvious. For modularity, note that for $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{1}(N)$, we have
      \[
        W_{N}\g = \begin{pmatrix} 0 & -1 \\ N & 0 \end{pmatrix}\begin{pmatrix} a & b \\ c & d \end{pmatrix} = \begin{pmatrix} -c & -d \\ Na & Nb \\ \end{pmatrix} = \begin{pmatrix} d & -N^{-1}c \\ -Nb & a \end{pmatrix}\begin{pmatrix} 0 & -1 \\ N & 0 \end{pmatrix} = \g'W_{N},
      \]
      where $\g' = \begin{psmallmatrix} d & -N^{-1}c \\ -Nb & a \end{psmallmatrix} \in \G_{1}(N)$. It follows that
      \begin{align*}
        (\w_{N}f)(\g z) &= (\sqrt{N}\g z)^{-k}f(W_{N}\g z) \\
        &= (\sqrt{N}\g z)^{-k}f(\g'W_{N}z) \\
        &= \left(\sqrt{N}\frac{az+b}{cz+d}\right)^{-k}\left(\frac{b}{z}+a\right)^{k}f\left(-\frac{1}{Nz}\right) \\
        &= \left(\sqrt{N}\frac{az+b}{cz+d}\right)^{-k}\left(\frac{z}{az+b}\right)^{-k}f\left(-\frac{1}{Nz}\right) \\
        &= (cz+d)^{k}(\sqrt{N}z)^{-k}f\left(-\frac{1}{Nz}\right) \\
        &= j(\g,z)^{k}(\w_{N}f)(z).
      \end{align*}
      This verifies modularity of $\w_{N}f$. As for the growth condition, let $\s_{\mf{a}}$ be a scaling matrix for the cusp $\mf{a}$. Then $W_{N}\s_{\mf{a}}$ takes $\infty$ to an element of $\Q \cup \{\infty\}$ since $W_{N} \in \GL_{2}^{+}(\Q)$. In other words, $W_{N}\s_{\mf{a}}\infty = \mf{b}$ for some cusp $\mf{b}$. Then the cocycle condition implies
      \[
        j(\s_{\mf{a}},z)^{-k}(\w_{N}f)(\s_{\mf{a}}z) = N^{\frac{k}{2}}j(W_{n}\s_{\mf{a}},z)^{-k}f(W_{n}\s_{\mf{a}}z),
      \]
      and the growth condition follows from that of $f$. It is also clear that $\w_{N}f$ is a cusp form because $f$ is. Altogether, this shows $\w_{N}f \in \mc{S}_{k}(\G_{1}(N))$. Moreover, $\w_{N}$ is also an involution because $\w_{N}^{2}f = f$. 
    \end{proof}

    As $\w_{N}f$ is an involution its only possible eigenvalues are $\pm 1$. The important fact we need is how $\w_{N}$ acts on $\mc{S}_{k}(N,\chi)$. To state the result, for $f \in \mc{S}_{k}(N,\chi)$ define
    \[
      \conj{f}(z) = \conj{f(-z)}.
    \]
    Then we have the following (see \cite{cohenmodular2017} for a proof):

    \begin{proposition}\label{prop:Atkin_Lehner_conjugation_holomorphic}
      If $f \in \mc{S}_{k}(N,\chi)$ is a primitive Hecke eigenform, then
      \[
        \w_{N}f = \w_{N}(f)\conj{f},
      \]
      where $\conj{f} \in \mc{S}_{k}(N,\cchi)$ is a primitive Hecke eigenform and $\w_{N}(f) \in \C$ is nonzero with $|\w_{N}(f)| = 1$.
    \end{proposition}
  \section{The Ramanujan-Petersson Conjecture}
    We will now discuss a famous conjecture about the size of the Hecke eigenvalues of primitive Hecke eigenforms. Historically the conjecture was born from conjectures made about the \textbf{modular discriminant}\index{modular discriminant} $\D$ given by
    \[
      \Delta = \frac{1}{1728}(E_{4}^{3}-E_{6}^{2}),
    \]
    which is a weight $12$ primitive Hecke eigenform on $\G_{1}(1)\backslash\H$ (see \cite{diamond2005first}). Therefore it is natural to begin our discussion here. It can be shown that the Fourier series of the modular discriminant is
    \[
      \Delta(z) = \sum_{n \ge 1}\tau(n)e^{2\pi i nz},
    \]
    where the $\tau(n)$ are integers with $\tau(1) = 1$ and $\tau(2) = -24$ (see \cite{apostol1976introduction} for a proof). The function $\tau:\N \to \Z$ is called \textbf{Ramanujan's $\tau$ function}\index{Ramanujan's $\tau$ function}. Ramanujan himself studied this function in his 1916 paper (see \cite{ramanujan1916certain}), and computed $\tau(n)$ for $1 \le n \le 30$. From these computations he conjectured the following three properties $\tau$ should satisfy:
    \begin{enumerate}[label=(\roman*)]
      \item If $(n,m) = 1$, then $\tau(nm) = \tau(n)\tau(m)$.
      \item $\tau(p^{n}) = \tau(p^{n-1})\tau(p)-p^{11}\tau(p^{n-2})$ for all prime $p$.
      \item $|\tau(p)| \le 2p^{\frac{11}{2}}$ for all prime $p$.
    \end{enumerate}
    Note that (i) and (ii) are strikingly similar to the properties satisfied by the Hecke operators. In fact, (i) and (ii) are special cases of the properties of Hecke operators. This ends our commentary on properties (i) and (ii). Property (iii) turned out to be drastically more difficult to prove and is known as the classical \textbf{Ramanujan-Petersson conjecture}\index{Ramanujan-Petersson conjecture}. To state the Ramanujan-Petersson conjecture for holomorphic forms, suppose $f \in \mc{S}_{k}(N,\chi)$ is a primitive Hecke eigenform with Hecke eigenvalues $\l_{f}(n)$. For each prime $p$, consider the polynomial
    \[
      1-\l_{f}(p)p^{-\frac{k-1}{2}}p^{-s}+\chi(p)p^{-2s}.
    \]
    We call this the $p$-th \textbf{Hecke polynomial}\index{Hecke polynomial} of $f$. Let $\a_{1}(p)$ and $\a_{2}(p)$ denote the roots. From this quadratic, we have
    \[
      \a_{1}(p)+\a_{2}(p) = \l_{f}(p)p^{-\frac{k-1}{2}} \quad \text{and} \quad \a_{1}(p)\a_{2}(p) = \chi(p).
    \]
    The more general \textbf{Ramanujan-Petersson conjecture}\index{Ramanujan-Petersson conjecture} for holomorphic forms is following statement:

    \begin{theorem}[Ramanujan-Petersson conjecture, holomorphic version]
      Suppose $f \in \mc{S}_{k}(N,\chi)$ is a primitive Hecke eigenform with Hecke eigenvalues $\l_{f}(n)$. Let $\a_{1}(p)$ and $\a_{2}(p)$ be the roots of the $p$-th Hecke polynomial. Then for all primes $p$,
      \[
        |\l_{f}(p)| \le 2p^{\frac{k-1}{2}}.
      \]
      Moreover, if $p \nmid N$, then
      \[
        |\a_{1}(p)| = |\a_{2}(p)| = 1.
      \]
    \end{theorem}

    In the 1970's Deligne proved the Ramanujan-Petersson conjecture (see \cite{deligne1971formes} and \cite{deligne1974conjecture} for the full proof). The argument is significantly beyond the scope of this text, and in actuality follows from Deligne's work on the Weil conjectures (except in the case $k = 1$ which requires a modified argument). This requires understanding classical algebraic topology and $\ell$-acid cohomology in addition to the basic analytic number theory. As such, the proof of the Ramanujan-Petersson conjecture has been one of the biggest advances in analytic number theory in recent decades. Note that the Ramanujan-Petersson conjecture and the Hecke relations together give the bound $\l_{f}(n) \ll \s_{0}(n)n^{\frac{k-1}{2}} \ll_{\e} n^{\frac{k-1}{2}+\e}$ (recall \cref{prop:sum_of_divisors_growth_rate}).
  \section{Twists of Holomorphic Forms}
    We can also twist of holomorphic forms by Dirichlet characters. Let $f \in \mc{M}_{k}(N,\chi)$ with Fourier series
    \[
      f(z) = \sum_{n \ge 0}a_{n}(f)e^{2\pi inz},
    \]
    and let $\psi$ be a Dirichlet character modulo $M$. We define the \textbf{twisted holomorphic form}\index{twisted holomorphic form} $f \ox \psi$ of $f$ twisted by $\psi$ by the Fourier series
    \[
      (f \ox \psi)(z) = \sum_{n \ge 0}a_{n}(f)\psi(n)e^{2\pi inz}.
    \]
    In order for $f \ox \psi$ to be well-defined, we need to prove that it is a holomorphic form. The following proposition proves this and more when $\psi$ is primitive:

    \begin{proposition}\label{prop:twisted_holomorphic_forms_primitive}
      Suppose $f \in \mc{M}_{k}(N,\chi)$ and $\psi$ is a primitive Dirichlet character of conductor $q$. Then $f \ox \psi \in \mc{M}_{k}(Nq^{2},\chi\psi^{2})$. Moreover, if $f$ is a cusp form then so is $f \ox \psi$.
    \end{proposition}
    \begin{proof}
      By \cref{cor:gauss_sum_primitive_formula}, we can write
      \begin{align*}
        (f \ox \psi)(z) &= \sum_{n \ge 0}a_{n}(f)\psi(n)e^{2\pi inz} \\
        &= \sum_{n \ge 0}a_{n}(f)\left(\frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)e^{\frac{2\pi irn}{q}}\right)e^{2\pi inz} \\
        &= \frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)\sum_{n \ge 0}a_{n}(f)e^{2\pi in\left(z+\frac{r}{q}\right)} \\
        &= \frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)f\left(z+\frac{r}{q}\right).
      \end{align*}
      From this last expression, holomorphy is immediate since the sum is finite. For modularity, let $\g = \begin{psmallmatrix} a & b \\ c & d \end{psmallmatrix} \in \G_{0}(Nq^{2})$ and set $\g_{r} = \begin{psmallmatrix} 1 & \frac{r}{q} \\ 0 & 1 \end{psmallmatrix}$ for every $r$ modulo $q$. Then for $r$ and $r'$ modulo $q$, we compute
      \[
        \g_{r}\g\g_{r'}^{-1} = \begin{pmatrix} 1 & \frac{r}{q} \\ 0 & 1 \end{pmatrix}\begin{pmatrix} a & b \\ c & d \end{pmatrix}\begin{pmatrix} 1 & -\frac{r'}{q} \\ 0 & 1 \end{pmatrix} = \begin{pmatrix} a+\frac{cr}{q} & b-\frac{ar'-dr}{q}-\frac{crr'}{q^{2}} \\ c & d-\frac{cr'}{q} \end{pmatrix}.
      \]
      Since $c \equiv 0 \tmod{Nq^{2}}$, if we choose $r'$ (for each $r$) such that $ar' \equiv dr \tmod{q}$, then $\g_{r}\g\g_{r}^{-1} \in \G_{0}(N)$. Such a choice exists and is unique by B\'ezout's identity because $a$ and $d$ are relatively prime to $q$ as $ad \equiv 1 \tmod{Nq^{2}}$. Making this choice and setting $\eta_{r} = \g_{r}\g\g_{r'}^{-1}$, we compute
      \[
        f\left(\g z+\frac{r}{q}\right) = f(\g_{r}\g z) = f(\eta_{r}\g_{r'}z) = \chi(\eta_{r})j(\eta_{r},\g_{r'}z)^{k}f(\g_{r'}z) = \chi(\eta_{r})j(\eta_{r},\g_{r'}z)^{k}f\left(z+\frac{r'}{q}\right).
      \]
      Moreover,
      \[
        \chi(\eta_{r})j(\eta_{r},\g_{r'}z) = \chi\left(d-\frac{cr'}{q}\right)\left(c\g_{r'}z+d-\frac{cr'}{q}\right) = \chi(d)(cz+d) = \chi(\g)j(\g,z).
      \]
      Together these two computations imply
      \[
        f\left(\g z+\frac{r}{q}\right) = \chi(\g)j(\g,z)^{k}f\left(z+\frac{r'}{q}\right).
      \]
      Now, as $ar' \equiv dr \tmod{q}$ and $ad \equiv 1 \tmod{q}$, we have
      \[
        \conj{\psi}(r) = \conj{\psi}(a\conj{d}r') = \psi^{2}(d)\conj{\psi}(r') = \psi^{2}(\g)\conj{\psi}(r').
      \]
      Putting everything together,
      \begin{align*}
        (f \ox \psi)(\g z) &= \frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)f\left(\g z+\frac{r}{q}\right) \\
        &= \chi(\g)j(\g,z)^{k}\frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)f\left(z+\frac{r'}{q}\right) \\
        &= \chi\psi^{2}(\g)j(\g,z)^{k}\frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r')f\left(z+\frac{r'}{q}\right) \\
        &= \chi\psi^{2}(\g)j(\g,z)^{k}(f \ox \psi)(z).
      \end{align*}
      from which the modularity of $f \ox \psi$ follows. For the growth condition, let $\s_{\mf{a}}$ be a scaling matrix for the cusp $\mf{a}$ of $\G_{0}(Nq^{2})\backslash\H$. As $\g_{r} \in \GL_{2}^{+}(\Q)$, $\g_{r}\s_{\mf{a}}$ takes $\infty$ to an element of $\Q \cup \{\infty\}$. Thus $\g_{r}\s_{\mf{a}}\infty = \mf{b}$ for some cusp $\mf{b}$ of $\G_{0}(N)\backslash\H$. Then as $j(\g_{r},\s_{\mf{a}}z) = 1$, our previous work and the cocycle condition together imply
      \[
        j(\s_{\mf{a}},z)^{-k}(f \ox \psi)(\s_{\mf{a}}z) = \frac{1}{\tau(\conj{\psi})}\sum_{r \tmod{q}}\conj{\psi}(r)j(\g_{r}\s_{\mf{a}},z)^{-k}f(\g_{r}\s_{\mf{a}}z),
      \]
      and the growth condition follows from that of $f$. It is also clear that $f \ox \psi$ is a cusp form if $f$ is. This proves the claim.
    \end{proof}

    The generalization of \cref{prop:twisted_holomorphic_forms_primitive} to all characters is slightly more involved. To this end, define operators $U_{p}$ and $V_{p}$ on $\mc{M}_{k}(\G_{1}(N))$ to be the linear operators given by
    \[
      (U_{p}f)(z) = \sum_{n \ge 0}a_{np}(f)e^{2\pi inz},
    \]
    and
    \[
      (V_{p}f)(z) = \sum_{n \ge 0}a_{n}(f)e^{2\pi inpz},
    \]
    if $f$ has Fourier series
    \[
      f(z) = \sum_{n \ge 0}a_{n}(f)e^{2\pi inz}.
    \]
    We will show that both $U_{p}$ and $V_{p}$ map $\mc{M}_{k}(\G_{1}(N))$ into $\mc{M}_{k}(\G_{1}(Np))$ and more:

    \begin{lemma}\label{lem:twisted_holomorphic_lemma}
      For any prime $p$, $U_{p}$ and $V_{p}$ map $\mc{M}_{k}(\G_{1}(N))$ into $\mc{M}_{k}(\G_{1}(Np))$. In particular, $U_{p}$ and $V_{p}$ map $\mc{M}_{k}(N,\chi)$ into $\mc{M}_{k}(Np,\chi\chi_{p,0})$. Moreover, $U_{p}$ and $V_{p}$ preserve the subspace of cusp forms.
    \end{lemma}
    \begin{proof}
      In light of \cref{thm:diamond_operator_decomposition_holomorphic}, the first statement follows from the second. As $N \mid Np$, $\G_{1}(Np) \le \G_{1}(N)$ so that $f \in \mc{M}_{k}(\G_{1}(Np))$ if $f \in \mc{M}_{k}(\G_{1}(N))$. Now suppose $f \in \mc{M}_{k}(N,\chi)$. Similarly, $N \mid Np$ implies $\G_{0}(Np) \le \G_{0}(N)$ so that $f \in \mc{M}_{k}(Np,\chi\chi_{p,0})$ for the modulus $Np$ character $\chi\chi_{p,0}$. Therefore we may assume $f \in \mc{M}_{k}(Np,\chi\chi_{p,0})$. Now consider $U_{p}$. As $p \mid Np$, \cref{equ:Hecke_operator_when_p_divides_holomorphic} implies $U_{p} = T_{p}$ is the $p$-th Hecke operator on $\mc{M}_{k}(\G_{1}(Np))$ and the claim follows from the definition of the Hecke operators and \cref{prop:prime_Hecke_operators_acting_on_Fourier_coefficients_holomorphic}. Now consider $V_{p}$. We have
      \[
        (V_{p}f)(z) = f(pz),
      \]
      and the claim follows by regarding $f \in \mc{M}_{k}(Np,\chi\chi_{p,0})$ and that $\begin{psmallmatrix} p & 0 \\ 0 & p \end{psmallmatrix}$ lies in the center of $\PSL_{2}(\Z)$.
    \end{proof}

    We can now generalize \cref{prop:twisted_holomorphic_forms_primitive} to all characters:

    \begin{proposition}\label{prop:twisted_holomorphic_forms}
      Suppose $f \in \mc{M}_{k}(N,\chi)$ and $\psi$ is a Dirichlet character modulo $M$. Then $f \ox \psi \in \mc{M}_{k}(NM^{2},\chi\psi^{2})$. Moreover, if $f$ is a cusp form then so is $f \ox \psi$.
    \end{proposition}
    \begin{proof}
      Let $\wtilde{\psi}$ be the primitive character of conductor $q$ inducing $\psi$. Then $\psi = \wtilde{\psi}\psi_{\frac{M}{q},0}$. As $\psi_{\frac{M}{q},0} = \prod_{p \mid \frac{M}{q}}\psi_{p,0}$, it suffices to prove the claim when $\psi$ is primitive and when $\psi = \psi_{p,0}$. The primitive case follows from \cref{prop:twisted_holomorphic_forms_primitive}. So suppose $\psi = \psi_{p,0}$. Then
      \[
        f \ox \psi_{p,0} = f-V_{p}U_{p}f.
      \]
      Now by \cref{lem:twisted_holomorphic_lemma}, $V_{p}U_{p}f \in \mc{M}_{k}(Np^{2},\chi\psi_{p,0}^{2})$ and is a cusp form if $f$ is (where we have written $\psi_{p,0}^{2}$ in place of $\chi_{p,0}$). Since we also have $f \in \mc{M}_{k}(Np^{2},\chi\psi_{p,0}^{2})$ (because $N \mid Np^{2}$ so that $\G_{1}(Np^{2}) \le \G_{1}(N)$ and $\G_{0}(Np^{2}) \le \G_{0}(N)$ and again writing $\psi_{p,0}^{2}$ in place of $\chi_{p,0}$), it follows that $f \ox \psi_{p,0} \in \mc{M}_{k}(Np^{2},\chi\psi_{p,0}^{2})$ and is a cusp form if $f$ is. This proves the claim in the case $\psi = \psi_{p,0}$ and thus completes the proof.
    \end{proof}